---
title: включение файла
description: включение файла
services: virtual-machines
author: cynthn
ms.service: virtual-machines
ms.topic: include
ms.date: 08/14/2018
ms.author: cynthn;kareni
ms.custom: include file
ms.openlocfilehash: 130cc66831b25621cb022eb19005c624fcd71b9e
ms.sourcegitcommit: 7b845d3b9a5a4487d5df89906cc5d5bbdb0507c8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/14/2018
ms.locfileid: "40105512"
---
**Последнее обновление документа**: 14 августа 2018 года, 10:00 (по тихоокеанскому времени).

В результате обнаружения [нового класса уязвимостей ЦП](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002), известного как атаки спекулятивного выполнения команд с предсказанием ветвлений, у пользователей возникли вопросы, требующие разъяснения.  

Корпорация Майкрософт развернула по всем облачным службам средства устранения уязвимостей. Инфраструктура с изолированными друг от друга нагрузками, которая работает в Azure, является защищенной. Это означает, что потенциальному злоумышленнику с помощью той же инфраструктуры, используя эти уязвимости, не удастся осуществить атаку на ваше приложение.

Чтобы свести к минимуму последствия для пользователей и устранить необходимость перезагрузки, Azure всякий раз при возможности использует [обслуживание с сохранением памяти](https://docs.microsoft.com/azure/virtual-machines/windows/maintenance-and-updates#memory-preserving-maintenance). Azure продолжит использовать эти методы при выполнении системных обновлений на узле и для защиты своих клиентов.

Дополнительные сведения о том, как вопросы безопасности учитываются в каждом аспекте создания Azure, доступны на веб-сайте [Документация по системе безопасности Azure](https://docs.microsoft.com/azure/security/). 

> [!NOTE] 
> С тех пор как этот документ был впервые опубликован, было обнаружено несколько вариантов этого класса уязвимостей. Корпорация Майкрософт продолжает активно вкладывать средства в защиту своих клиентов и предоставлять поддержку. Эта страница будет обновляться по мере выпуска дальнейших исправлений. 
> 
> 14 августа 2018 года в отрасли была обнаружена новая уязвимость спекулятивного выполнения команд с предсказанием ветвлений, известная как [сбой терминала L1](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180018) (L1TF), которой было присвоено несколько кодов CVE ([CVE-2018-3615, CVE-2018-3620 и CVE-2018-3646](https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00161.html)). Эта уязвимость затрагивает процессоры Intel® Core® и Intel® Xeon®. Корпорация Майкрософт развернула кампанию по устранению рисков в своих облачных службах, что усилило изоляцию клиентов. Ниже приведены дополнительные рекомендации для защиты от L1TF и предыдущих уязвимостей (примеры которых указаны в статье [Windows Server guidance to protect against speculative execution side-channel vulnerabilities](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution) (Руководство по Windows Server для защиты от уязвимостей по сторонним каналам рискованного исполнения)).
>  






## <a name="keeping-your-operating-systems-up-to-date"></a>Поддержка актуальности операционной системы

Хотя обновление ОС не является обязательным требованием для изоляции приложений, запускаемых в Azure, от других клиентов Azure, настоятельно рекомендуется поддерживать актуальное состояние системы. Последние накопительные пакеты обновлений безопасности для Windows оснащены средствами устранения рисков, связанных с несколькими уязвимостями спекулятивного выполнения команд с предсказанием ветвлений. Аналогичным образом дистрибутивы Linux выпустили несколько обновлений для устранения этих уязвимостей. Ниже приведены рекомендуемые действия для обновления операционной системы.

| Предложение | Рекомендуемое действие  |
|----------|---------------------|
| Облачные службы Azure  | Включите [автоматическое обновление](https://docs.microsoft.com/azure/cloud-services/cloud-services-how-to-configure-portal) или убедитесь, что используется последняя версия гостевой ОС. |
| Виртуальные машины Linux в Azure | Устанавливайте обновления, предоставляемые поставщиками операционной системы. Дополнительные сведения см. в пункте [Linux](#linux) далее в этом документе. |
| Виртуальные машины Windows в Azure  | Установка последнего накопительного пакета обновлений безопасности.
| Прочие службы Azure PaaS | Для клиентов, использующих эти службы, дополнительные действия не требуются. Azure автоматически выполняет обновление версий операционной системы. |

## <a name="additional-guidance-if-you-are-running-untrusted-code"></a>Дополнительные рекомендации при выполнении кода без доверия 

Клиентам, позволяющим ненадежным пользователям выполнение произвольного кода, может потребоваться использование дополнительных компонентов безопасности внутри своих виртуальных машин Azure или облачных служб. Эти компоненты защищают от внутрипроцессных векторов обнаружения, описываемых несколькими уязвимостями спекулятивного выполнения команд.

Примеры сценариев, где рекомендуется использовать дополнительные компоненты безопасности.

- Вы допускаете запуск кода, которому не доверяете, на своей виртуальной машине.  
    - *Например, вы разрешаете одному из клиентов загрузить двоичный файл или сценарий, который затем будет выполнен в приложении*. 
- Вы разрешаете пользователям, которым не доверяете, входить в виртуальную машину через учетные записи с низкими разрешениями.   
    - *Например, вы разрешаете низкопривилегированному пользователю войти в одну из виртуальных машин с помощью удаленного рабочего стола или SSH*.  
- Вы разрешаете ненадежным пользователям доступ к виртуальным машинам с помощью встроенной виртуализации.  
    - *Например, вы управляете узлом Hyper-V, но выделяете виртуальные машины для ненадежных пользователей*. 

Клиентам, которые не используют сценарии с ненадежным кодом, не обязательно включать эти дополнительные компоненты безопасности. 

## <a name="enabling-additional-security"></a>Включение дополнительной защиты 

Вы можете включить дополнительные компоненты безопасности в своей виртуальной машине или облачной службе.

### <a name="windows"></a>Windows 

Чтобы включить эти дополнительные компоненты безопасности, нужно использовать последнюю версию целевой операционной системы. Несмотря на то что по умолчанию задействованы многочисленные предупреждения о спекулятивном выполнении команд с предсказанием ветвлений, дополнительные функции, описанные здесь, должны быть активированы вручную и могут отрицательно сказаться на производительности. 

**Шаг 1**. [Обратитесь в службу поддержки Azure](https://aka.ms/MicrocodeEnablementRequest-SupportTechnical) для предоставления обновленного встроенного ПО (микрокод) для виртуальных машин. 

**Шаг 2**. Включите поддержку операционной системой удаленного управления виртуальным адресом ядра (KVAS) и целевого внедрения ветви (BTI). Следуйте инструкциям обновления безопасности [KB4072698](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution) для включения защиты с помощью разделов реестра `Session Manager`. Потребуется перезагрузка. 

**Шаг 3**. Для развертываний, использующих [вложенную виртуализацию](https://docs.microsoft.com/azure/virtual-machines/windows/nested-virtualization) (только D3 и E3): эти инструкции применяются внутри виртуальной машины, используемой в качестве узла Hyper-V. 

1. Следуйте инструкциям обновления безопасности [KB4072698](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution) для включения защиты с помощью разделов реестра `MinVmVersionForCpuBasedMitigations`.  
 
1. Задайте тип планировщика низкоуровневой оболочки как **Core**, следуя инструкциям в разделе [Managing Hyper-V hypervisor scheduler types](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/manage-hyper-v-scheduler-types) (Управление типами планировщиков низкоуровневых оболочек Hyper-V). 

**Шаг 4**. Следуйте инструкциям обновления безопасности [KB4072698](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution), чтобы проверить, что средства защиты включены с помощью модуля PowerShell [SpeculationControl](https://aka.ms/SpeculationControlPS). 

> [!NOTE]
> Если этот модуль ранее уже был загружен, необходимо установить его последнюю версию.
>

Во всех виртуальных машинах должно отображаться следующее.

```
branch target injection mitigation is enabled: True

kernel VA shadow is enabled: True  

L1TFWindowsSupportEnabled: True
```


### <a name="linux"></a>Linux

<a name="linux"></a>Для включения внутреннего набора дополнительных компонентов безопасности требуется, чтобы целевая операционная система была обновлена до последней версии. Некоторые методы устранения рисков будут включены по умолчанию. В приведенном ниже разделе описаны компоненты, которые по умолчанию отключены и/или зависят от аппаратной поддержки (микрокод). Включение этих компонентов может отрицательно сказаться на производительности. Дополнительные сведения см. в справочной документации поставщика операционной системы.
 
**Шаг 1**. [Обратитесь в службу поддержки Azure](https://aka.ms/MicrocodeEnablementRequest-SupportTechnical) для предоставления обновленного встроенного ПО (микрокод) для виртуальных машин.
 
**Шаг 2**. Включите поддержку операционной системой целевого внедрения ветви (BTI), чтобы устранить риск CVE-2017-5715 (Spectre варианта 2), следуя документации поставщика операционной системы. 
 
**Шаг 3**. Включите изоляцию таблицы страниц ядра (KPTI), чтобы устранить риск CVE-2017-5754 (Meltdown варианта 3), следуя документации поставщика операционной системы. 
 
Дополнительные сведения можно получить от поставщика операционной системы:  
 
- [RedHat и CentOS](https://access.redhat.com/security/vulnerabilities/speculativeexecution) 
- [SUSE](https://www.suse.com/support/kb/doc/?id=7022512) 
- [Ubuntu](https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/SpectreAndMeltdown) 


## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения см. в разделе [Securing Azure customers from CPU vulnerability](https://azure.microsoft.com/blog/securing-azure-customers-from-cpu-vulnerability/) (Защита клиентов Azure от уязвимости ЦП).
