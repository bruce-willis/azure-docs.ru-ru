---
title: Общие сведения о безопасности Azure Service Fabric | Документация Майкрософт
description: Эта статья содержит общие сведения о безопасности Azure Service Fabric.
services: security
documentationcenter: na
author: unifycloud
manager: mbaldwin
editor: tomsh
ms.assetid: ''
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/04/2017
ms.author: tomsh
ms.openlocfilehash: 629b6fba9ced5fa2ccf22f473fe25c87d1cc4818
ms.sourcegitcommit: e0834ad0bad38f4fb007053a472bde918d69f6cb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2018
ms.locfileid: "37436816"
---
# <a name="azure-service-fabric-security-overview"></a>Общие сведения о безопасности Azure Service Fabric
[Azure Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-overview) — это платформа распределенных систем, которая дает возможность не только легко упаковывать и развертывать масштабируемые и надежные микрослужбы, но и управлять ими. Service Fabric позволяет разрешить трудности, возникающие при разработке облачных приложений и управлении ими. Получая гарантированную масштабируемость и надежность, разработчики и администраторы могут сосредоточиться на реализации критически важных и ресурсоемких рабочих нагрузок, вместо того чтобы тратить силы на решение сложных проблем с инфраструктурой.

В этой статье приведен обзор вопросов безопасности для развертывания Service Fabric.

## <a name="secure-your-cluster"></a>Обеспечение безопасности кластера
Azure Service Fabric оркестрирует службы в кластере виртуальных машин. Кластеры должны быть защищены, чтобы неавторизованные пользователи не могли к ним подключиться, особенно если на кластере выполняются рабочие нагрузки в рабочей среде. Существует возможность создания незащищенного кластера, что позволит анонимным пользователям подключаться к кластеру (если конечные точки управления кластером общедоступны через Интернет).

Для кластеров, работающих как автономно, так и в Azure, рассмотрены два сценария: безопасность обмена данными между узлами и безопасность обмена данными между узлом и клиентом. Для реализации этих сценариев можно использовать различные технологии.

### <a name="node-to-node-security"></a>безопасность обмена данными между узлами;
Безопасность обмена данными между узлами применяется для взаимодействия между виртуальными машинами и компьютерами в кластере. Такая защита гарантирует, что размещать приложения и службы в кластере смогут владельцы только тех компьютеров, которые прошли авторизацию для подключения к кластеру.

Кластеры, работающие в Azure, или автономные кластеры, работающие под управлением Windows, могут использовать [безопасность на основе сертификатов](https://msdn.microsoft.com/library/ff649801.aspx) или [безопасность Windows](https://msdn.microsoft.com/library/ff649396.aspx) для компьютеров Windows Server.

#### <a name="node-to-node-certificate-security"></a>Безопасность обмена данными между узлами на основе сертификатов

Azure Service Fabric использует сертификаты сервера X.509, указанные при создании кластера. Краткий обзор этих сертификатов и способа их получения или создания приведен в статье [Working with Certificates](https://docs.microsoft.com/dotnet/framework/wcf/feature-details/working-with-certificates) (Работа с сертификатами).

При создании кластера с помощью портала Azure, шаблона диспетчера Azure Resource Manager или автономного шаблона JSON можно настроить безопасность сертификатов. Вы можете указать основной сертификат и необязательный дополнительный сертификат, который будет использоваться для смены сертификатов. Указанные основной и дополнительный сертификаты должны отличаться от сертификатов клиента для администрирования и только для чтения, указанных для [безопасности обмена данными между клиентом и узлом](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security).

### <a name="client-to-node-security"></a>безопасность обмена данными между клиентами и узлами;
Безопасность обмена данными между клиентом и узлом настраивается с помощью удостоверений клиента. Чтобы установить отношения доверия между клиентом и кластером, необходимо настроить кластер таким образом, чтобы ему были известны удостоверения клиентов, которым можно доверять.

Служба Service Fabric поддерживает два типа контроля доступа для клиентов, подключенных к кластеру Service Fabric.

-   **Администратор**. Полный доступ к возможностям управления (включая возможности чтения и записи).
-   **Пользователь**. Доступ только для чтения возможностей управления (например, при работе с запросами) и возможность устранения приложений и служб.

С помощью управления доступом администраторы кластера могут ограничить доступ к определенным типам операций кластера. Это дает возможность обеспечить более надежную защиту кластера.

#### <a name="client-to-node-certificate-security"></a>Безопасность обмена данными между клиентами и узлами на основе сертификатов

При создании кластера безопасность обмена данными между клиентами и узлами на основе сертификатов можно настроить с помощью портала Azure, шаблонов Resource Manager или автономного шаблона JSON. Необходимо указать сертификат клиента администратора и/или пользователя. Убедитесь, что эти сертификаты отличаются от основного и дополнительного сертификатов, которые вы указали для обеспечения безопасности обмена данными между узлами.

Клиенты, подключающиеся к кластеру с помощью сертификата администрирования, получают полный доступ к возможностям управления. Клиенты, подключающиеся к кластеру с помощью сертификата клиента только для чтения, получают доступ только для чтения к возможностям управления. Иными словами, эти сертификаты используются для управления доступом на основе ролей (RBAC).

Чтобы узнать, как настроить безопасность на основе сертификатов в кластере, см. статью [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm).

#### <a name="client-to-node-azure-active-directory-security"></a>Безопасность обмена данными Azure Active Directory между клиентами и узлами

Для защиты доступа к конечным точкам управления кластеры под управлением Azure также могут использовать Azure Active Directory (AAD). Сведения о том, как создать необходимые артефакты Azure Active Directory (AAD), как их заполнить при создании кластера и как подключиться к этим кластерам, см. в статье [Создание кластера Service Fabric в Azure с помощью Azure Resource Manager](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm).

Azure AD позволяет организациям (известным как клиенты) управлять доступом пользователей к приложениям. Есть приложения с пользовательским интерфейсом входа в систему и те, в которых вход выполняется с помощью собственного клиентского приложения.

Кластеры Service Fabric предлагают несколько точек входа для управления функциями кластеров, включая веб-интерфейс Service Fabric Explorer и Visual Studio. В итоге вы создаете два приложения Azure AD для управления доступом к кластеру: одно веб-приложение и одно собственное приложение.

Чтобы обеспечить безопасность обмена данными между узлами в кластерах Azure, мы рекомендуем использовать безопасность AAD для проверки подлинности клиентов и сертификатов.

Если в рамках автономных кластеров Windows Server используется Windows Server 2012 R2 и Active Directory, рекомендуется применять безопасность Windows с помощью групповой управляемой учетной записи службы (gMSA). В противном случае используйте безопасность Windows с учетными записями Windows.

## <a name="understand-monitoring-and-diagnostics-in-service-fabric"></a>Основные сведения о мониторинге и диагностике в Service Fabric
[Мониторинг и диагностика](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-overview) крайне важны для разработки, тестирования и развертывания приложений и служб в любой среде. Оптимальная работа решений Service Fabric зависит от эффективного планирования, реализации мониторинга и диагностики, что помогает обеспечить ожидаемую работу приложений и служб в локальной среде разработки или в производственной среде.

С точки зрения безопасности основные цели мониторинга и диагностики заключаются в следующем:

-   Обнаружение и диагностика проблем оборудования и инфраструктуры, вызванных событиями безопасности.
-   Выявление проблем с программным обеспечением и приложениями, благодаря которому можно определить индикатор компрометации (IoC).
-   Оценка потребления ресурсов для предотвращения непреднамеренного отказа в обслуживании.

Рабочий процесс мониторинга и диагностики состоит из трех этапов.

1.  **Создание событий**. Сюда входят события (журналы, трассировки, пользовательские события) на уровне инфраструктуры (кластера) и на уровне приложения и службы. Ознакомьтесь с дополнительными сведениями о [событиях уровня инфраструктуры](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-infra) и [событиях уровня приложений](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-generation-app), чтобы понять, какой инструментарий уже предоставлен, а какой можно добавить дополнительно.

2.  **Агрегирование событий**. Создаваемые события должны быть собраны и агрегированы до их отображения. Как правило, мы рекомендуем использовать [систему диагностики Azure](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-wad) (похожа на коллекцию журналов на основе агентов) или [EventFlow](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow) (внутрипроцессная коллекция журналов).

3.  **Анализ**. События должны быть визуализированы и доступны в определенном формате, обеспечивающем возможность анализа и отображения. Существует несколько платформ для анализа и визуализации данных мониторинга и диагностики. Рекомендуется использовать [Azure Log Analytics](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-oms) и [Azure Application Insights](https://docs.microsoft.com/azure/service-fabric/service-fabric-diagnostics-event-analysis-appinsights), потому что они хорошо интегрируются с Service Fabric.

[Мониторинг Azure](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview) дает возможность отслеживать многие ресурсы Azure, из которых состоит кластер Service Fabric.

Модуль наблюдения — это отдельная служба, которая может отслеживать работоспособность и нагрузку в службах и сообщать о работоспособности любого элемента в иерархии модели работоспособности. Это устройство позволяет предотвратить ошибки, которые невозможно обнаружить на основе отдельной службы. 

Модули наблюдения также являются хорошим местом для размещения кода, который выполняет корректирующие действия без взаимодействия с пользователем. Примером является очистка файлов журнала в хранилище через определенные интервалы времени. С примером реализации службы устройства наблюдения можно ознакомиться в статье [Azure Service Fabric watchdog sample](https://azure.microsoft.com/resources/samples/service-fabric-watchdog-service/) (Образец устройства наблюдения Azure Service Fabric).

## <a name="secure-communication-by-using-certificates"></a>Безопасная связь с помощью сертификатов
Сертификаты дают возможность защиты взаимодействия между различными узлами автономного кластера Windows. С помощью сертификатов X.509 можно проверить подлинность клиентов, подключающихся к этому кластеру. Таким образом, доступ к кластеру имеют только авторизованные пользователи. При создании кластера мы рекомендуем включить сертификат кластера.

Цифровые сертификаты X.509 обычно используются для проверки подлинности клиентов и серверов, а также для шифрования и цифровой подписи сообщений.

В следующей таблице перечислены сертификаты, необходимые для настройки кластера:

|Параметр сведений о сертификате |ОПИСАНИЕ|
|-------------------------------|-----------|
|ClusterCertificate|    Этот сертификат нужен, чтобы защитить связь между узлами кластера. Для обновления можно использовать два сертификата кластера — основной и дополнительный.|
|ServerCertificate| Этот сертификат предоставляется клиенту при попытке подключиться к этому кластеру. Для обновления можно использовать два сертификата сервера — основной и дополнительный.|
|ClientCertificateThumbprints|  Это набор сертификатов, которые требуется установить на клиентских компьютерах, прошедших проверку подлинности.|
|ClientCertificateCommonNames|  Это обычное название первого сертификата клиента для параметра CertificateCommonName. CertificateIssuerThumbprint — это отпечаток издателя сертификата.|
|ReverseProxyCertificate|   Это необязательный сертификат, который можно указать для защиты [обратного прокси-сервера](https://docs.microsoft.com/azure/service-fabric/service-fabric-reverseproxy).|

Дополнительные сведения о защите сертификатов см. в статье [Защита изолированного кластера под управлением Windows с использованием сертификатов X.509](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-x509-security).

## <a name="understand-role-based-access-control"></a>Общие сведения об управлении доступом на основе ролей
Роли администратора и клиента задаются во время создания кластера путем предоставления отдельных удостоверений (включая сертификаты) для каждой из них. Дополнительные сведения о параметрах управления доступом по умолчанию и их изменении см. в статье [Контроль управления доступом на основе ролей для клиентов Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security-roles).

## <a name="secure-standalone-clusters-by-using-windows-security"></a>Защита автономных кластеров с помощью системы безопасности Windows
Чтобы предотвратить несанкционированный доступ к кластеру Service Fabric, его необходимо защитить. Безопасность особенно важна при выполнении в кластере производственных рабочих нагрузок. Рекомендуется настраивать безопасность обмена данными между узлами или между клиентом и узлом с помощью системы безопасности Windows и файла ClusterConfig.JSON.

Когда Service Fabric необходимо использовать групповую управляемую учетную запись службы (gMSA), безопасный обмен данными между узлами можно настроить с помощью параметра [ClustergMSAIdentity](https://docs.microsoft.com/azure/service-fabric/service-fabric-windows-cluster-windows-security). Чтобы создать отношения доверия между узлами, нужно им сообщить друг о друге.

Если вы хотите использовать группу компьютеров в домене Active Directory, настройте безопасный обмен данными между узлами с помощью параметра ClusterIdentity. Дополнительные сведения см. в статье [How to Create a Group in Active Directory](https://msdn.microsoft.com/library/aa545347) (Как создать группу в Active Directory).

Безопасность обмена данными между клиентом и узлом настраивается с помощью параметра ClientIdentities. Необходимо настроить кластер таким образом, чтобы он мог распознать идентификаторы клиентов, которым можно доверять. Установить отношения доверия можно двумя способами:

-   указать пользователей группы домена, которые могут подключаться;
-   указать пользователей узла домена, которые могут подключаться.

## <a name="configure-application-security-in-service-fabric"></a>Настройка безопасности приложений в Service Fabric.
### <a name="manage-secrets-in-service-fabric-applications"></a>Управление секретами в приложениях Service Fabric
Секретом может считаться любая конфиденциальная информации, например строка подключения к хранилищу, пароль или другое значение, которое не должно обрабатываться в виде обычного текста.

Для управления ключами и секретами можно использовать [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-whatis). Однако использование секретов в приложении не зависит от конкретной облачной платформы. Можно развертывать приложения в кластере, размещенном в любом месте. Этот поток состоит из четырех основных шагов.

1.  Получение сертификата шифрования данных.
2.  Установка сертификата на кластер.
3.  Шифрование значений секретов при развертывании приложения с помощью сертификата и их включение в файл конфигурации Settings.xml службы.
4.  Чтение зашифрованных значений из файла Settings.xml. Для их расшифровки используется тот же сертификат шифрования.

Дополнительные сведения см. в статье [Управление секретами в приложениях Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-application-secret-management).

### <a name="configure-security-policies-for-an-application"></a>Настройка политик безопасности для приложения
Платформа безопасности Azure Service Fabric помогает защищать приложения, работающие в кластере под разными учетными записями. Кроме того, Service Fabric помогает защищать ресурсы, которые используют приложения при развертывании с помощью учетных записей, например файлы, каталоги и сертификаты. Таким образом, приложения будут работать безопаснее, даже если они запущены в общей среде.

Задачи для настройки политик безопасности включают следующее.

-   Настройка политики для точки входа установки службы
-   Запуск команд PowerShell из точки входа установки
-   Использование перенаправления консоли для локальной отладки
-   Настройка политики для пакетов кода службы
-   Назначение политики безопасности доступа для конечных точек протоколов HTTPS и HTTP

## <a name="secure-communication-for-services"></a>Безопасная связь служб
Безопасность — один из самых важных аспектов взаимодействия. Платформа приложений Reliable Services предоставляет несколько готовых стеков взаимодействия и средств, которыми можно воспользоваться для повышения безопасности. Дополнительные сведения см. в статье [Безопасное удаленное взаимодействие со службой для службы](https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-services-secure-communication).

## <a name="next-steps"></a>Дополнительная информация
- Основные сведения о безопасности кластера см. в статье [Создание кластера Service Fabric с помощью Azure Resource Manager](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-arm) и [Создание кластера Service Fabric с помощью портала Azure](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-creation-via-portal).
- Дополнительные сведения о безопасности кластера Service Fabric см. в статье [Сценарии защиты кластера Service Fabric](https://docs.microsoft.com/azure/service-fabric/service-fabric-cluster-security).
