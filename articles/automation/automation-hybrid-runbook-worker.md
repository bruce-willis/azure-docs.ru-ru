---
title: Гибридные компоненты Runbook Worker в службе автоматизации Azure
description: В этой статье содержатся сведения об установке и использовании гибридной рабочей роли Runbook, которая является компонентом службы автоматизации Azure, позволяющая запускать модули Runbook на компьютерах в локальном центре обработки данных или в поставщике облачных служб.
services: automation
ms.service: automation
ms.component: process-automation
author: georgewallace
ms.author: gwallace
ms.date: 04/25/2018
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 92ebd399cea88440e0f76ee1f34cb5930d3121d9
ms.sourcegitcommit: e2ea404126bdd990570b4417794d63367a417856
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/14/2018
ms.locfileid: "45578690"
---
# <a name="automate-resources-in-your-datacenter-or-cloud-by-using-hybrid-runbook-worker"></a>Автоматизация ресурсов в центре обработки данных или в облаке с помощью использования гибридной рабочей роли Runbook

Модули Runbook в службе автоматизации Azure могут не получить доступ к ресурсам в других облаках или локальной среде, так как они выполняются на платформе облака Azure. Гибридную рабочую роль Runbook службы автоматизации Azure можно использовать для выполнения модулей runbook непосредственно на компьютере, размещающем роль, для работы с ресурсами в среде, что позволяет управлять этими локальными ресурсами. Для хранения модулей runbook и управления ими используется служба автоматизации Azure, затем они передаются на один или несколько целевых компьютеров.

Эта функция проиллюстрирована на следующем изображении.

![Обзор гибридной рабочей роли Runbook](media/automation-hybrid-runbook-worker/automation.png)

Каждый гибридный компонент Runbook Worker является членом группы гибридных компонентов Runbook Worker, которая указывается при установке агента. Группа может включать одного агента, но в нее можно установить несколько агентов для обеспечения высокого уровня доступности.

Когда вы запускаете модуль runbook в гибридной рабочей роли Runbook, вы выбираете группу для его выполнения. Каждый компонент Worker в группе опрашивает службу автоматизации, чтобы узнать, доступны ли какие-либо задания. Если задание доступно, его получает первая рабочая роль. Указание конкретной рабочей роли невозможно.

## <a name="install-a-hybrid-runbook-worker"></a>Установка гибридной рабочей роли Runbook Worker

Процесс установки гибридной рабочей роли Runbook зависит от ОС. Следующая таблица содержит ссылки на методы, которые можно использовать для установки. 

Ниже описаны два метода установки и настройки гибридной рабочей роли Runbook для Windows. Рекомендуется использовать модуль Runbook службы автоматизации для полностью автоматической настройки компьютера Windows. Второй метод заключается в пошаговом выполнении инструкций по ручной установке и настройке роли. Для компьютеров с Linux для установки агента запустите скрипт Python.

|ОС  |Типы развертывания  |
|---------|---------|
|Windows     | [PowerShell](automation-windows-hrw-install.md#automated-deployment)<br>[Вручную](automation-windows-hrw-install.md#manual-deployment)        |
|Linux     | [Python](automation-linux-hrw-install.md#installing-a-linux-hybrid-runbook-worker)        |

> [!NOTE]
> Чтобы управлять конфигурацией серверов, поддерживающих гибридную рабочую роль Runbook с настройкой требуемого состояния (DSC), добавьте такие серверы в качестве узлов DSC. Дополнительные сведения о развертывании этих узлов для управления с помощью DSC см. в статье [Подключение компьютеров для управления с помощью Azure Automation DSC](automation-dsc-onboarding.md).
>
>Если включить [решение по управлению обновлениями](automation-update-management.md), любой подключенный к рабочей области Azure Log Analytics компьютер будет автоматически настроен в качестве гибридной рабочей роли Runbook для поддержки модулей Runbook, которые входят в это решение. Тем не менее, компьютер не регистрируется в группах гибридных рабочих ролей, которые уже определены в учетной записи службы автоматизации. Его можно добавить в группу гибридных рабочих ролей Runbook в учетной записи службы автоматизации, чтобы обеспечить поддержку модулей Runbook службы автоматизации при условии, что вы используете одну и ту же учетную запись для решения и для членства в группе гибридных рабочих ролей Runbook. Эта функция добавлена в версии 7.2.12024.0 гибридной рабочей роли Runbook.

Перед началом развертывания гибридной рабочей роли Runbook ознакомьтесь со следующими [сведениями о подготовке сети](#network-planning). После успешного развертывания рабочей роли ознакомьтесь с [запуском модулей Runbook в гибридной рабочей роли Runbook](automation-hrw-run-runbooks.md), чтобы узнать, как настроить модули Runbook для автоматизации процессов в локальном центре обработки данных или в другой облачной среде.

## <a name="remove-a-hybrid-runbook-worker"></a>Удаление гибридной рабочей роли Runbook Worker

В зависимости от необходимости можно удалить одну или несколько гибридных рабочих ролей Runbook из группы либо удалить группу. Чтобы удалить гибридную рабочую роль Runbook на локальном компьютере, выполните следующие действия.

1. На портале Azure перейдите в свою учетную запись в службе автоматизации.
2. В разделе **Параметры** выберите **Ключи** и запишите значения **URL-адреса** и **Первичного ключа доступа**. Эти сведения потребуются для выполнения следующего шага.

### <a name="windows"></a>Windows

Откройте сеанс PowerShell в режиме администратора и выполните следующую команду. Получить подробный журнал процедуры удаления можно с помощью параметра **-Verbose** .

```powershell
Remove-HybridRunbookWorker -url <URL> -key <PrimaryAccessKey>
```

Чтобы удалить устаревшие машины из группы гибридной рабочей роли, используйте необязательный параметр `machineName`.

```powershell-interactive
Remove-HybridRunbookWorker -url <URL> -key <PrimaryAccessKey> -machineName <ComputerName>
```

### <a name="linux"></a>Linux

```bash
sudo python onboarding.py --deregister --endpoint="<URL>" --key="<PrimaryAccessKey>" --groupname="Example" --workspaceid="<workspaceId>"
```

> [!NOTE]
> Microsoft Monitoring Agent не удаляет код с компьютера, удаляются только функциональные возможности и настройки гибридной рабочей роли Runbook.

## <a name="remove-a-hybrid-worker-group"></a>Удаление группы гибридных рабочих ролей

Чтобы удалить группу, необходимо сначала удалить гибридную рабочую роль Runbook с помощью показанной выше процедуры с каждого компьютера, который является участником этой группы. Затем выполните указанные ниже действия для удаления группы.

1. На портале Azure откройте учетную запись службы автоматизации.
1. В разделе **Автоматизация процессов** выберите пункт **Группы гибридных рабочих ролей**. Выберите группу, которую нужно удалить. Откроется страница свойств этой группы.

   ![Страница свойств](media/automation-hybrid-runbook-worker/automation-hybrid-runbook-worker-group-properties.png)

1. На странице свойств выбранной группы выберите **Удалить**. Появится сообщение с запросом на подтверждение этого действия. Выберите **Да**, если хотите продолжить.

   ![Сообщение с подтверждением](media/automation-hybrid-runbook-worker/automation-hybrid-runbook-worker-confirm-delete.png)

   Для завершения процесса может потребоваться несколько секунд. Ход создания можно просмотреть в разделе **Уведомления** в меню.

## <a name="network-planning"></a>Настройка сети

### <a name="hybrid-worker-role"></a>Гибридная рабочая роль

Чтобы гибридная рабочая роль Runbook могла подключаться и регистрироваться в службе Log Analytics, ей нужен доступ к номерам портов и URL-адресам, описанным в этом разделе. Этот доступ является дополнением к [списку URL-адресов и портов, необходимых для подключения Microsoft Monitoring Agent](../log-analytics/log-analytics-agent-windows.md) к Log Analytics. 

При использовании прокси-сервера для обмена данными между агентом и службой Log Analytics необходимо убедиться, что соответствующие ресурсы доступны. Если доступ к Интернету ограничивается брандмауэром, вам нужно изменить его настройки, чтобы разрешить доступ к OMS. Если в качестве прокси-сервера используется шлюз OMS, он должен быть настроен для гибридных рабочих ролей. Инструкции см. в статье [Настройка шлюза OMS для гибридных рабочих ролей службы автоматизации](https://docs.microsoft.com/azure/log-analytics/log-analytics-oms-gateway#configure-for-automation-hybrid-workers).

Для обмена данными между гибридной рабочей ролью Runbook и службой автоматизации необходимы следующие порт и URL-адрес:

* порт: только исходящий трафик Интернета через TCP-порт 443.
* Глобальный URL-адрес: *.azure-automation.net.
* Глобальный URL-адрес US Gov (Вирджиния): *.azure automation.us
* Служба агента: https://\<ИД рабочей области\>.agentsvc.azure-automation.net

При определении исключений рекомендуется использовать адреса из списка. Если вам нужны IP-адреса, вы можете скачать [список диапазонов IP-адресов центров обработки данных Microsoft Azure](https://www.microsoft.com/download/details.aspx?id=41653). Файл обновляется еженедельно, и в нем отражаются развернутые в настоящее время диапазоны и все предстоящие изменения диапазонов IP-адресов.

При наличии учетной записи службы автоматизации, определенной для конкретного региона, можно ограничить обмен данными с таким региональным центром обработки данных. В таблице ниже содержатся записи DNS для каждого региона.

| **Регион** | **Запись DNS** |
| --- | --- |
| Западно-центральная часть США | wcus-jobruntimedata-prod-su1.azure-automation.net</br>wcus-agentservice-prod-1.azure-automation.net |
| Центрально-южная часть США |scus-jobruntimedata-prod-su1.azure-automation.net</br>scus-agentservice-prod-1.azure-automation.net |
| Восток США 2 |eus2-jobruntimedata-prod-su1.azure-automation.net</br>eus2-agentservice-prod-1.azure-automation.net |
| Центральная Канада |cc-jobruntimedata-prod-su1.azure-automation.net</br>cc-agentservice-prod-1.azure-automation.net |
| Западная Европа |we-jobruntimedata-prod-su1.azure-automation.net</br>we-agentservice-prod-1.azure-automation.net |
| Северная Европа |ne-jobruntimedata-prod-su1.azure-automation.net</br>ne-agentservice-prod-1.azure-automation.net |
| Юго-Восточная Азия |sea-jobruntimedata-prod-su1.azure-automation.net</br>sea-agentservice-prod-1.azure-automation.net|
| Центральная Индия |cid-jobruntimedata-prod-su1.azure-automation.net</br>cid-agentservice-prod-1.azure-automation.net |
| Восточная часть Японии |jpe-jobruntimedata-prod-su1.azure-automation.net</br>jpe-agentservice-prod-1.azure-automation.net |
| Юго-Восточная Австралия |ase-jobruntimedata-prod-su1.azure-automation.net</br>ase-agentservice-prod-1.azure-automation.net |
| Южная часть Великобритании | uks-jobruntimedata-prod-su1.azure-automation.net</br>uks-agentservice-prod-1.azure-automation.net |
| Правительство штата Вирджиния | usge-jobruntimedata-prod-su1.azure-automation.us<br>usge-agentservice-prod-1.azure-automation.us |

Для списка IP-адресов региона вместо его имен скачайте XML-файл [IP-адресов центра обработки данных Azure](https://www.microsoft.com/download/details.aspx?id=41653) из Центра загрузки Майкрософт и ознакомьтесь с ним.

> [!NOTE]
> В XML-файле IP-адресов центра обработки данных Azure приводится список диапазонов IP-адресов, используемых в центрах обработки данных Microsoft Azure. Этот файл включает диапазоны вычисления, хранения и SQL.
>
>Обновленный файл публикуется еженедельно. Он отражает развернутые в настоящее время диапазоны и все предстоящие изменения IP-адресов. Новые диапазоны, появившиеся в файле, не будут использоваться в центрах обработки данных по крайней мере одну неделю.
>
> Скачивайте новый XML-файл каждую неделю и вносите соответствующие изменения на своем сайте, чтобы правильно определять службы, выполняемые в Azure. Пользователям Azure ExpressRoute следует обратить внимание, что этот файл используется для того, чтобы обновлять протокол BGP в пространстве Azure в первую неделю каждого месяца.

### <a name="update-management"></a>управление обновлениями;

В дополнение к стандартным адресам и портам, которые требуются гибридной рабочей роли, для управления обновлениями необходимы следующие адреса. Взаимодействие с этими адресами выполняется через порт 443.

|Azure Public  |Azure Government  |
|---------|---------|
|*.ods.opinsights.azure.com     |*.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net|*.blob.core.usgovcloudapi.net|

## <a name="troubleshoot"></a>Устранение неполадок

Дополнительные сведения об устранении неполадок с гибридными рабочими ролями Runbook см. в разделе [Troubleshooting Hybrid Runbook Workers](troubleshoot/hybrid-runbook-worker.md#general) (Поиск и устранение неисправностей гибридных рабочих ролей Runbook).

## <a name="next-steps"></a>Дополнительная информация

Чтобы узнать, как настроить модули runbook для автоматизации процессов в локальном центре обработки данных или другой облачной среде, см. статью [Запуск модулей runbook в гибридной рабочей роли Runbook](automation-hrw-run-runbooks.md).
