---
title: Настройка единого входа Azure AD для приложений | Документация Майкрософт
description: Узнайте, как самостоятельно подключить приложения к Azure Active Directory с использованием SAML и единого входа на основе пароля
services: active-directory
author: barbkess
documentationcenter: na
manager: mtillman
ms.service: active-directory
ms.component: app-mgmt
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 09/09/2018
ms.author: barbkess
ms.reviewer: asmalser,luleon
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 860ca62e6e5ed544fabb1667d6e63c8221f5683e
ms.sourcegitcommit: af9cb4c4d9aaa1fbe4901af4fc3e49ef2c4e8d5e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2018
ms.locfileid: "44355506"
---
# <a name="configure-single-sign-on-to-applications-that-are-not-in-the-azure-active-directory-application-gallery"></a>Настройка единого входа для приложений, которых нет в коллекции приложений Azure Active Directory

Эта статья о функциях, с помощью которых администраторы могут настроить единый вход для приложений, не принадлежащих к коллекции приложений Azure Active Directory, *без написания кода*. Эта возможность добавлена 18 ноября 2015 года в составе технической предварительной версии и включена в [Azure Active Directory Premium](../fundamentals/active-directory-whatis.md). Если вам все же необходимо руководство для разработчиков по интеграции пользовательских приложений в Azure AD с использованием кода, см. статью [Сценарии аутентификации в Azure Active Directory](../develop/authentication-scenarios.md).

Коллекция приложений Azure Active Directory содержит список приложений, которые поддерживают единый вход с помощью Azure Active Directory. Эта функция описана в [этой статье](what-is-single-sign-on.md). Когда вы (как специалист ИТ-отдела или системный интегратор) найдете приложение, которое нужно подключить, сначала выполните пошаговые инструкции по включению единого входа, которые предложены на портале Azure.

Клиенты, у которых есть лицензия [Azure Active Directory Premium](../fundamentals/active-directory-whatis.md), также получают приведенные ниже дополнительные возможности:

* самостоятельная интеграция любого приложения, которое совместимо с поставщиками удостоверений SAML 2.0 (инициированная поставщиком услуг или поставщиком удостоверений);
* самостоятельная интеграция любого веб-приложения, где есть HTML-страница входа, с использованием функции [единого входа на основе пароля](what-is-single-sign-on.md#password-based-single-sign-on)
* Самостоятельное подключение приложений, которые используют протокол SCIM для подготовки пользователей ([процесс описан здесь](use-scim-to-provision-users-and-groups.md))
* Возможность добавлять ссылки на любые приложения в [Средство запуска приложений Office 365](https://blogs.office.com/2014/10/16/organize-office-365-new-app-launcher-2/) или [Панель доступа Azure AD](what-is-single-sign-on.md#deploying-azure-ad-integrated-applications-to-users).

Подключать можно не только приложения SaaS, которых еще нет в коллекции приложений Azure AD, но и любые сторонние веб-приложения, которые ваша организация развернула на локальных или облачных серверах, к управлению которыми вы имеете доступ.

Эти преимущества также известны как *шаблоны интеграции приложений*. Они предоставляют точки подключения на основе стандартов для приложений с поддержкой аутентификации на основе SAML, SCIM или форм и предусматривают гибкие параметры и настройки для совместимости с широким спектром приложений. 

## <a name="adding-an-unlisted-application"></a>Добавление приложений, которые отсутствуют в списке
Чтобы подключить приложение с помощью шаблона интеграции приложений, войдите на портал Azure, используя свою учетную запись администратора Azure Active Directory. Выберите **Active Directory > Корпоративные приложения > Новое приложение > Приложение не из коллекции**, щелкните **Добавить**, а затем — **Добавить приложение из коллекции**.

  ![Добавить приложение](./media/configure-single-sign-on-non-gallery-applications/customapp1.png)

В коллекции приложений вы можете добавить приложение, которое отсутствует в списке, выбрав элемент **Приложение не из коллекции**, который отображается в результатах поиска, если нужное приложение не найдено. После ввода имени приложения можно настроить параметры и поведение функции единого входа. 

**Совет**. Сначала воспользуйтесь поиском. Возможно, нужное приложение уже существует в коллекции приложений. Если приложение найдено и в его описании упомянут единый вход, это означает, что для этого приложения уже поддерживается федеративный единый вход.

  ![поиска](./media/configure-single-sign-on-non-gallery-applications/customapp2.png)

После добавления приложения таким способом его можно будет использовать аналогично предварительно интегрированным приложениям. Чтобы начать работу, в расположенном слева меню навигации приложения щелкните **Настроить единый вход** или **Единый вход**. На снимке экрана ниже показаны варианты настройки единого входа. Эти варианты описаны в следующих разделах этой статьи.
  
![Варианты настройки](./media/configure-single-sign-on-non-gallery-applications/customapp3.png)

## <a name="saml-based-single-sign-on"></a>Единый вход на основе SAML
Этот метод нужен, чтобы настроить для приложения проверку подлинности на основе SAML. Для этого требуется, чтобы приложение поддерживало SAML 2.0. Прежде чем продолжить работу, изучите сведения о том, как использовать возможности SAML вашего приложения. Сведения о том, как настроить единый вход между приложением и Azure AD см. в разделах ниже.

### <a name="enter-basic-saml-configuration"></a>Ввод базовой конфигурации SAML

Чтобы настроить Azure AD, введите базовую конфигурацию SAML. Вы можете вручную ввести значения или отправить файл метаданных, чтобы извлечь значения полей.

  ![Домен и URL-адреса Litware](./media/configure-single-sign-on-non-gallery-applications/customapp4.png)

- **URL-адрес входа (только инициированный поставщиком услуг)** , по которому пользователь переходит для входа в это приложение. Если приложение настроено для выполнения единого входа, инициированного поставщиком услуг, то переходе пользователя на этот URL-адрес поставщик услуг выполнит необходимое перенаправление в Azure AD для аутентификации и входа пользователя. Если это поле заполнено, Azure AD будет использовать этот URL-адрес для запуска приложения из Office 365 и панели доступа Azure AD. Если это поле пропускается, Azure AD выполнит единый вход, инициированный поставщиком удостоверений, при запуске приложения из Office 365, панели доступа Azure AD или URL-адреса единого входа Azure AD (отображается на вкладке "Панель мониторинга").
- **Идентификатор**. Должен однозначно определять приложение, для которого выполняется настройка единого входа. Это значение можно найти в элементе Issuer (Издатель) в запросе AuthRequest (запросе SAML), отправленном приложением. Это значение также отображается как **идентификатор сущности** во всех метаданных SAML, предоставленных приложением. Сведения о значениях параметров "Идентификатор сущности" и "Аудитория" см. в документации по SAML для приложения. 

    В примере ниже показано, как значение Identifier (Идентификатор) или Issuer (Издатель) используется в запросе SAML, отправленном приложением в Azure AD.

    ```
    <samlp:AuthnRequest
    xmlns="urn:oasis:names:tc:SAML:2.0:metadata"
    ID="id6c1c178c166d486687be4aaf5e482730"
    Version="2.0" IssueInstant="2013-03-18T03:28:54.1839884Z"
    xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <Issuer xmlns="urn:oasis:names:tc:SAML:2.0:assertion">https://www.contoso.com</Issuer>
    </samlp:AuthnRequest>
    ```

- **URL-адрес ответа**. URL-адрес ответа указывает место, где приложение ожидает токен SAML. Он также называется URL-адресом службы обработчика утверждений (ACS). Сведения об URL-адресе ответа токена SAML или URL-адресе ACS см. в документации по SAML приложения. 

    Настроить несколько значений replyURL можно с помощью указанного ниже скрипта PowerShell.

    ```PowerShell
    $sp = Get-AzureADServicePrincipal -SearchString "<Exact App  name>"
    $app = Get-AzureADApplication -SearchString "<Exact app name>"
    Set-AzureADApplication -ObjectId $app.ObjectId -ReplyUrls "<ReplyURLs>"
    Set-AzureADServicePrincipal -ObjectId $sp.ObjectId -ReplyUrls "<ReplyURLs>"
    ```

Дополнительные сведения см. в статье [Запросы на аутентификацию согласно SAML 2.0 и соответствующие отклики, которые поддерживает Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-single-sign-on-protocol-reference?/?WT.mc_id=DOC_AAD_How_to_Debug_SAML).


### <a name="review-or-customize-the-claims-issued-in-the-saml-token"></a>Проверка и настройка утверждений, созданных в токене SAML

Когда пользователь проходит проверку подлинности для приложения, Azure AD выдает токен SAML для приложения. В токене собрана информация (утверждения), которая однозначно идентифицирует пользователя. По умолчанию здесь указаны имя для входа, адрес электронной почты, имя и фамилия пользователя. 

На вкладке **атрибуты** вы можете просмотреть или изменить утверждения, которые передаются приложению в токене SAML.

  ![Атрибуты](./media/configure-single-sign-on-non-gallery-applications/customapp7.png)

Ниже указаны две причины, по которым может потребоваться изменить утверждения, созданные в токене SAML.

- Приложение требует другого набора URI утверждений или значений утверждений.
- Приложение развернуто таким образом, что утверждение NameIdentifier должно содержать данные, отличные от имени пользователя (также называемого именем участника-пользователя), которое хранится в Azure Active Directory. 

Дополнительные сведения см. в статье [Настройка утверждений, выпущенных в токене SAML для корпоративных приложений](./../develop/../develop/active-directory-saml-claims-customization.md). 



### <a name="review-certificate-expiration-data-status-and-email-notification"></a>Проверьте дату истечения срока действия сертификата, его состояние и параметры уведомления по электронной почте

При создании приложения из коллекции или не из коллекции Azure AD создает сертификат, зависящий от приложения, со сроком действия 3 года с даты создания сертификата. Этот сертификат понадобится вам, чтобы настроить доверие между Azure AD и приложением. Дополнительные сведения о формате сертификата см. в документации по SAML приложения. 

Вы можете скачать сертификат в формате Base64 или в виде необработанных данных из Azure AD. Кроме того, сертификат можно получить, скачав XML-файл метаданных приложения или воспользовавшись URL-адресом метаданных федерации приложения.

  ![Сертификат](./media/configure-single-sign-on-non-gallery-applications/certificate.png)

Убедитесь, что у сертификата есть указанные ниже элементы.

- Нужный срок действия. Вы можете настроить срок действия длительностью не более 3 лет.
- Активное состояние. Если сертификат находится в неактивном состоянии, переведите его в активное состояние. Чтобы изменить состояние, установите флажок **Активный** и сохраните конфигурацию. 
- Правильные параметры уведомления по электронной почте. Если приближается дата окончания срока действия активного сертификата, Azure AD отправляет соответствующее уведомление на электронный адрес, указанный в этом поле.  

Дополнительные сведения см. в статье [Управление сертификатами для федеративного единого входа в Azure Active Directory](manage-certificates-for-federated-single-sign-on.md).

### <a name="set-up-target-application"></a>Настройка конечного приложения

Сведения о том, как настроить приложение для использования единого входа, см. в документации к приложению. Чтобы найти документацию, прокрутите страницу конфигурации единого входа на основе SAML вниз до конца и щелкните **Настроить <application name>**. 

Необходимые значения зависят от приложения. Дополнительные сведения см. в документации к SAML приложения. URL-адреса входа и выхода указывают на одну конечную точку, то есть на конечную точку обработки запроса SAML для вашего экземпляра Azure AD. Идентификатор сущности SAML — это значение, которое указано в поле Issuer (Издатель) в токене SAML, созданном приложением.


### <a name="assign-users-and-groups-to-your-saml-application"></a>Назначение пользователей и групп приложению SAML

Когда приложение будет готово к использованию Azure AD в качестве поставщика удостоверений на основе SAML, останется сделать совсем немного. Из соображений безопасности Azure AD не создает токен, с помощью которого пользователь может войти в приложение. Исключение составляют случаи, когда Azure AD предоставил права на доступ пользователю. Пользователь может получить такие права либо непосредственно, либо с помощью членства в группе. 

Чтобы назначить для приложения пользователей или группы, нажмите кнопку **Назначить пользователей** . Выберите нужного пользователя или группу, а затем нажмите кнопку **Назначить** .

  ![Назначение пользователей](./media/configure-single-sign-on-non-gallery-applications/customapp6.png)

После назначения пользователя Azure AD сможет создать токен для пользователя. Кроме того, в результате этого действия на панели доступа появится плитка этого приложения. Если пользователь работает в Office 365, плитка приложения появится и в средстве запуска приложений Office 365. 

> [!NOTE] 
> Вы можете загрузить логотип, который будет отображаться на плитке приложения. Для этого нажмите кнопку **Загрузить логотип** на вкладке **Настройка** для этого приложения. 


### <a name="test-the-saml-application"></a>Тестирование приложения SAML

Прежде чем тестировать приложение SAML, необходимо настроить его в Azure AD и назначить ему пользователей или группы. Дополнительные сведения о тестировании приложения SAML см. в статье [Отладка единого входа на основе SAML в приложениях в Azure Active Directory](../develop/howto-v1-debug-saml-sso-issues.md).

## <a name="password-single-sign-on"></a>Единый вход по паролю

Выберите этот вариант, чтобы настроить [единый вход с помощью пароля](what-is-single-sign-on.md) для веб-приложения, у которого есть HTML-страница входа. Единый вход с помощью пароля (хранение пароля в хранилище) позволяет управлять доступом и паролями для веб-приложений, которые не поддерживают федерацию удостоверений. Также он полезен в ситуациях, когда несколько пользователей работают под одной учетной записью (например, с корпоративными страницами в социальных сетях). 

Когда вы нажмете кнопку **Далее**, вам будет предложено ввести URL-адрес веб-страницы входа в приложение. Обратите внимание, что здесь нужно указать страницу с полями ввода имени пользователя и пароля. После ввода информации Azure AD запускает процесс синтаксического анализа страницы входа, чтобы найти поля для ввода имени пользователя и пароля. Если поиск не будет успешным, вам будет предложен альтернативный процесс с установкой расширения браузера (поддерживаются Internet Explorer, Chrome и Firefox). Вы сможете вручную выбрать и указать поля ввода.

Когда страница входа будет определена, вы сможете назначить для приложения пользователей и группы, а также установить политики учетных данных, как и для обычных [приложений с единым входом по паролю](what-is-single-sign-on.md).

> [!NOTE] 
> Вы можете загрузить логотип, который будет отображаться на плитке приложения. Для этого нажмите кнопку **Загрузить логотип** на вкладке **Настройка** для этого приложения. 
>

## <a name="existing-single-sign-on"></a>Существующий единый вход
Выберите этот вариант, чтобы добавить ссылку на ваше приложение в панель доступа Azure AD или на портал Office 365. Этот метод подходит для добавления ссылок на пользовательские веб-приложения, которые используют для проверки подлинности службы федерации Active Directory Azure (или другую службу федерации), а не Azure AD. Еще он позволяет просто добавить глубокие ссылки на определенные страницы SharePoint или другие веб-сайты. Они появятся на панели доступа пользователя. 

Когда вы нажмете кнопку **Далее**, вам будет предложено ввести URL-адрес приложения. После завершения процесса вы сможете назначить для приложения пользователей и группы. У этих пользователей появится элемент приложения в [средстве запуска приложений Office 365](https://blogs.office.com/2014/10/16/organize-office-365-new-app-launcher-2/) или на [панели доступа Azure AD](what-is-single-sign-on.md#deploying-azure-ad-integrated-applications-to-users).

> [!NOTE] 
> Вы можете загрузить логотип, который будет отображаться на плитке приложения. Для этого нажмите кнопку **Загрузить логотип** на вкладке **Настройка** для этого приложения. 
>

## <a name="related-articles"></a>Связанные статьи

- [Указатель статьей по управлению приложениями в Azure Active Directory](../active-directory-apps-index.md)
- [Настройка утверждений, выпущенных в маркере SAML для предварительно интегрированных приложений](../develop/active-directory-saml-claims-customization.md)
- [Отладка единого входа на основе SAML в приложения в Azure Active Directory](../develop/howto-v1-debug-saml-sso-issues.md)

