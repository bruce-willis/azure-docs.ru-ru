---
title: Сравнение конечной точки Azure AD версии 2.0 с конечной точкой версии 1.0 | Документация Майкрософт
description: Пояснение различий между конечной точкой Azure AD версии 2.0 и конечной точкой версии 1.0
services: active-directory
documentationcenter: ''
author: andretms
manager: mtillman
editor: ''
ms.assetid: 5060da46-b091-4e25-9fa8-af4ae4359b6c
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/21/2018
ms.author: andret
ms.reviewer: hirsin, celested
ms.custom: aaddev
ms.openlocfilehash: 02c7edc84d2ac3a91c33d8f266d022db5cd5cb40
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46948966"
---
# <a name="comparing-the-azure-ad-v20-endpoint-with-v10-endpoint"></a>Сравнение конечной точки Azure AD версии 2.0 с конечной точкой версии 1.0

При разработке нового приложения важно понимать различия между конечными точками версии 1.0 и версии 2.0. Ниже приведены основные различия, а также некоторые существующие ограничения для конечной точки версии 2.0.

> [!NOTE]
> Не все сценарии и компоненты Azure AD поддерживаются конечной точкой версии 2.0. Чтобы определить, следует ли вам использовать конечную точку 2.0, ознакомьтесь с [ограничениями версии 2.0](#limitations).

## <a name="who-can-sign-in"></a>Каким учетным записям разрешен вход

![Кто может входить в систему с помощью конечных точек версии 1.0 и версии 2.0](media/azure-ad-endpoint-comparison/who-can-sign-in.png)

* Конечная точка версии 1.0 позволяет входить в приложение (Azure AD) только с рабочими и учебными учетными записями.

* Конечная точка версии 2.0 позволяет выполнять вход с рабочими и учебными учетными записями Azure Active Directory, а также с личными учетными записями (MSA), такими как hotmail.com, outlook.com и msn.com.

* Конечные точки как версии 1.0, так и версии 2.0 также принимают вход *[гостевых пользователей](https://docs.microsoft.com/azure/active-directory/b2b/what-is-b2b)* каталога Azure AD для приложений, настроенных как *[однотенантные](single-and-multi-tenant-apps.md)* или *мультитенантные*, а также для мультитенантных приложений, указывающих на конечную точку конкретного клиента (`https://login.microsoftonline.com/{TenantId_or_Name}`).

Конечная точка версии 2.0 позволяет создавать приложения, принимающие вход с использованием как личных, так и рабочих и учебных учетных записей, что дает возможность создать приложение без учета типа учетной записи. Например, если приложение вызывает [Microsoft Graph](https://graph.microsoft.io), пользователям с рабочими учетными записями будут доступны некоторые дополнительные функции и данные, такие как сайты SharePoint или данные каталога. Но для многих действий, таких как [чтение почты пользователя](https://graph.microsoft.io/docs/api-reference/v1.0/resources/message), тот же код сможет получить доступ к электронной почте как для личных, так и для рабочих и учебных учетных записей.

Для конечной точки версии 2.0 можно воспользоваться единой библиотекой (MSAL) для получения доступа к потребительской, образовательной и корпоративной средам.

 Конечная точка Azure AD версии 1.0 принимает вход только с рабочими и учебными учетными записями.

## <a name="incremental-and-dynamic-consent"></a>Добавочное и динамическое согласие

В приложениях, где используется конечная точка Azure AD версии 1.0, необходимо указывать необходимые разрешения OAuth 2.0 заранее, например:

![Пользовательский интерфейс регистрации разрешений](./media/azure-ad-endpoint-comparison/app_reg_permissions.png)

Разрешения, задаваемые непосредственно при регистрации приложения, являются **статическими**. Статические разрешения для приложения задавались на портале Azure и позволяли упростить код, но при этом они представляли определенные сложности для разработчиков:

* Приложению должны были быть известны все разрешения, которые могли понадобиться во время создания приложения. Добавить разрешения в дальнейшем было не так просто.

* Приложению заранее должны были быть известны все ресурсы, к которым оно будет обращаться. Было трудно создавать приложения, использующие произвольное количество ресурсов.

* Приложение должно было запрашивать все разрешения, которые могли потребоваться при первом входе пользователя в систему. В некоторых случаях это приводило к большому списку разрешений, из-за чего пользователи не разрешали приложению доступ при первоначальном входе.

С конечной точкой версии 2.0 можно игнорировать статически заданные разрешения, определенные в регистрационных данных приложения на портале Azure, и указывать необходимые приложению разрешения **динамически** во время выполнения, при обычном использовании приложения, независимо от разрешений, статически заданных в регистрационных данных приложения.

Для этого можно указать области, необходимые приложению в любой момент времени его работы, включив новые области в параметр `scope` при запросе маркера доступа — без необходимости предварительно определять их в регистрационных данных приложения.

Если пользователь еще не предоставил согласие на новые области, добавленные в запрос, ему будет предложено принять только новые разрешения. Дополнительные сведения см. в статье [Области, разрешения и предоставление согласия для конечной точки версии 2.0](v2-permissions-and-consent.md).

Возможность приложения динамически запрашивать разрешения с помощью параметра `scope` дает разработчикам полный контроль над взаимодействием с пользователями. При желании можно также предварительно загрузить страницу согласия и запросить все разрешения в едином первоначальном запросе авторизации. Или же, если приложению требуется множество разрешений, вы можете запрашивать их у пользователей постепенно, когда они попытаются применять некоторые функции приложения с течением времени.

Обратите внимание, что при согласии администратора от имени организации по-прежнему используются статические разрешения, зарегистрированные для приложения. Поэтому рекомендуется задавать такие разрешения для приложений с помощью конечной точки версии 2.0, если требуется, чтобы администратор дал согласие от имени всей организации. Это позволяет сократить циклические действия, необходимые администратору организации для настройки приложения.

## <a name="scopes-not-resources"></a>Области, а не ресурсы

Приложение, в котором используется конечная точка версии 1.0, может вести себя как **ресурс** или получатель маркеров. Ресурс может определить несколько **областей** или **разрешений oAuth2**, которые он распознает, позволяя клиентским приложениям запрашивать маркеры к этому ресурсу для определенного набора областей. Рассмотрим API Azure AD Graph в качестве примера ресурса.

* Идентификатор ресурса или `AppID URI`: `https://graph.windows.net/`

* Области или `OAuth2Permissions`: `Directory.Read`, `Directory.Write` и т. д.

Все это справедливо и для конечной точки версии 2.0. Приложение по-прежнему может вести себя как ресурс, определять области и идентифицироваться по URI. Клиентские приложения по-прежнему могут запрашивать доступ к этим областям. Однако способ запроса клиентами этих разрешений изменился. Для конечной точки версии 1.0 запрос авторизации OAuth 2.0 в Azure AD выглядел так:

```text
GET https://login.microsoftonline.com/common/oauth2/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e
&resource=https://graph.windows.net/
...
```

где параметр **resource** указывает, к какому ресурсу клиентское приложение запрашивает авторизацию. Служба Azure AD определяла разрешения, необходимые приложению, на основе статической конфигурации на портале Azure и выдавала маркеры соответствующим образом. Для приложений, использующих конечную точку версии 2.0, такой же запрос авторизации OAuth 2.0 выглядит следующим образом:

```text
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e
&scope=https://graph.windows.net/directory.read%20https://graph.windows.net/directory.write
...
```

Здесь параметр **scope** указывает, для каких ресурсов и разрешений приложение запрашивает авторизацию. Нужный ресурс по-прежнему присутствует в запросе — просто он состоит из каждого значения параметра области. Используя параметр области таким образом, конечная точка версии 2.0 обладает улучшенной совместимостью со спецификацией OAuth 2.0 и улучшенной поддержкой отраслевых стандартов. Это также позволяет приложениям реализовать [добавочное согласие](#incremental-and-dynamic-consent), описанное ранее.

## <a name="well-known-scopes"></a>Хорошо известные области

### <a name="offline-access"></a>Автономный доступ

Приложениям, использующим конечную точку версии 2.0, могут потребоваться новые хорошо известные разрешения для приложений — область `offline_access`. Всем приложения требуется запросить это разрешение, если им необходимо доступ к ресурсам от имени пользователя в течение длительного времени, даже если пользователь не работает с приложением активно. Область `offline_access` отображается в диалоговых окнах запроса согласия как разрешение **Доступ к вашим данным в любое время**, которое пользователь должен принять. Запрос разрешения `offline_access` позволит веб-приложению получать маркеры обновления OAuth 2.0 от конечной точки версии 2.0. У маркеров обновления длительный срок действия, и их можно заменить на новые маркеры доступа OAuth 2.0 на значительные периоды доступа.

Если приложение не запросит область `offline_access`, оно не получит маркеры обновления. Это значит, что при использовании кода авторизации в потоке кода авторизации OAuth 2.0 вы получите только маркер доступа из конечной точки `/token`. Маркер доступа будет действительным в течение короткого времени (обычно один час), но в конечном итоге срок его действия истечет. В этот момент приложению будет необходимо перенаправить пользователя обратно в конечную точку `/authorize`, чтобы получить новый код авторизации. При этом пользователю может потребоваться повторно ввести учетные данные или повторно предоставить разрешения в зависимости от типа приложения.

Дополнительные сведения об OAuth 2.0, `refresh_tokens` и `access_tokens` см. в [справочнике по протоколу версии 2.0](active-directory-v2-protocols.md).

### <a name="openid-profile-and-email"></a>OpenID, профиль и электронная почта

Исторически самый простой процесс входа в OpenID Connect с помощью Azure AD содержит массу информации о пользователе в результирующем маркере идентификации *id_token*. Утверждения в *id_token* могут содержать имя пользователя, предпочтительное имя пользователя, адрес электронной почты, идентификатор объекта и другие сведения.

Сейчас сведения, доступные вашему приложению с помощью области `openid`, ограничены. Теперь область `openid` позволит пользователю только войти в приложение и получить соответствующий идентификатор. Чтобы получить личные сведения о пользователе в приложении, приложение должно запросить дополнительные разрешения у пользователя. Чтобы запросить дополнительные разрешения, используйте две новые области — `email` и `profile`.

С помощью области `email` приложение получает доступ к основному адресу электронной почты пользователя через утверждение `email` в маркере id_token. С помощью области `profile` приложение может получить другие основные сведения о пользователе: имя, предпочтительное имя пользователя, идентификатор объекта и т. д.

Это позволяет создать код приложения с минимальным разглашением сведений. Вы можете запросить у пользователя только те сведения, которые необходимы приложению для выполнения задания. Дополнительные сведения об этих областях см. в [справочнике по областям версии 2.0](v2-permissions-and-consent.md).

## <a name="token-claims"></a>Утверждения маркера

Утверждения в токенах, выданные конечной точкой версии 2.0, не будут идентичны токенам, выданным общедоступными конечными точками Azure AD. Приложения, переносимые на новую службу, не должны полагаться на определенное утверждение в маркерах id_token или access_token. Дополнительные сведения о различных типах маркеров, используемых в конечной точке версии 2.0, можно найти в справочнике по [маркерам доступа](access-tokens.md) и [справочнике по `id_token`](id-tokens.md).

## <a name="limitations"></a>Ограничения

Существует ряд ограничений, которые следует учитывать при использовании версии 2.0.

При создании приложений, которые интегрируются с платформой удостоверений Майкрософт, необходимо решить, соответствуют ли вашим требованиям конечная точка версии 2.0 и протоколы проверки подлинности. Конечная точка и платформа версии 1.0 по-прежнему полностью поддерживаются и в некоторых отношениях являются более функциональными, чем версия 2.0. Однако версия 2.0 [предоставляет значительные преимущества](azure-ad-endpoint-comparison.md) для разработчиков.

Ниже приведены упрощенные рекомендации для разработчиков по состоянию на текущий момент.

* Если в приложении требуется поддержка личных учетных записей Майкрософт, используйте версию 2.0. Но перед этим убедитесь, что вы понимаете ограничения, которые описаны в этой статье.

* Если приложению требуется только поддержка рабочих и учебных учетных записей Майкрософт, не используйте версию 2.0. Вместо этого обратитесь к [руководству по версии 1.0](azure-ad-developers-guide.md).

Со временем для конечной точки версии 2.0 будут устранены все эти ограничения, и тогда вы сможете использовать только ее. А пока воспользуйтесь этой статьей и решите, подходит ли вам конечная точка версии 2.0. Мы продолжим обновлять эту статью, чтобы отражать текущее состояние конечной точки версии 2.0. Вы можете проверить ее на наличие изменений, чтобы повторно оценить свои требования и возможности версии 2.0.

### <a name="restrictions-on-app-types"></a>Ограничения для типов приложений

Перечисленные ниже типы приложений в настоящее время не поддерживаются конечной точкой версии 2.0. Описание поддерживаемых типов приложений см. в статье о [типах приложений в версии 2.0](v2-app-types.md).

#### <a name="standalone-web-apis"></a>Автономные веб-API

Можно использовать конечную точку версии 2.0 для [создания веб-API, защищенного с помощью OAuth 2.0](v2-app-types.md#web-apis). Однако такой веб-API может получать маркеры только от приложения с тем же идентификатором приложения. Невозможно получить доступ к веб-API из клиента с другим идентификатором приложения. Этот клиент не сможет запрашивать или получать разрешения для веб-API.

Чтобы узнать, как создать веб-API, принимающий маркеры от клиента с тем же идентификатором приложения, ознакомьтесь с примерами веб-API конечной точки версии 2.0 в разделе о [начале работы](v2-overview.md#getting-started) статьи, посвященной версии 2.0.

### <a name="restrictions-on-app-registrations"></a>Ограничения регистрации приложений

В настоящее время для каждого приложения, которое нужно интегрировать с конечной точкой версии 2.0, необходимо создать регистрацию на новом [портале регистрации приложений Майкрософт](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList). Существующие приложения Azure AD или учетной записи Майкрософт не совместимы с конечной точкой версии 2.0. Приложения, которые зарегистрированы на любом другом портале, кроме портала регистрации приложений, несовместимы с конечной точкой версии 2.0.

Кроме того, имеются следующие замечания к регистрациям приложений, созданным на [портале регистрации приложений](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList).

* Для идентификатора приложения можно использовать только два секрета приложения.

* Просматривать регистрацию приложения (зарегистрированного пользователем с личной учетной записью Майкрософт) и управлять ею можно только с помощью одной учетной записи разработчика. Регистрацию не могут совместно использовать несколько разработчиков. Если вы хотите совместно использовать регистрацию приложения с несколькими разработчиками, можно создать приложение, выполнив вход на портал регистрации с учетной записью Azure AD.

* К формату URL-адреса перенаправления применяется несколько ограничений. Дополнительные сведения об URL-адресе перенаправления см. в следующем разделе.

### <a name="restrictions-on-redirect-urls"></a>Ограничения для URL-адресов перенаправления

Приложения, зарегистрированные на портале регистрации приложений, ограничены определенным набором значений URL-адресов перенаправления. URL-адрес перенаправления для веб-приложений и служб должен начинаться со схемы `https`, и во всех его значениях должен использоваться один домен DNS. Например, невозможно зарегистрировать веб-приложение с одним из следующих URL-адресов перенаправления:

* `https://login-east.contoso.com`  
* `https://login-west.contoso.com`

Система регистрации сравнивает полное DNS-имя существующего URL-адреса перенаправления и DNS-имя добавляемого URL-адреса перенаправления. Запрос на добавление DNS-имени завершится ошибкой при выполнении любого из следующих условий.  

* Если полное DNS-имя нового URL-адреса перенаправления не соответствует DNS-имени существующего URL-адреса перенаправления.

* Если полное DNS-имя нового URL-адреса перенаправления не является поддоменом существующего URL-адреса перенаправления.

Например, в приложении используется следующий URL-адрес перенаправления:

`https://login.contoso.com`

Можно добавить его следующим образом.

`https://login.contoso.com/new`

В этом случае DNS-имя полностью совпадает. Или же можно сделать следующее.

`https://new.login.contoso.com`

В этом случае используется ссылка на поддомен DNS, login.contoso.com. Если требуется, чтобы в приложении использовались URL-адреса перенаправления `login-east.contoso.com` и `login-west.contoso.com`, необходимо добавить эти URL-адреса в таком порядке:

`https://contoso.com`  
`https://login-east.contoso.com`  
`https://login-west.contoso.com`  

Два последних значения являются поддоменами первого URL-адреса перенаправления (contoso.com), поэтому их можно добавить. Это ограничение будет снято в следующей версии.

Также обратите внимание, что у вас есть только 20 URL-адресов ответа для конкретного приложения.

Чтобы узнать, как зарегистрировать приложение на портале регистрации приложений, ознакомьтесь с разделом [Как зарегистрировать приложение с использованием конечной точки версии 2.0](quickstart-v2-register-an-app.md).

### <a name="restrictions-on-libraries-and-sdks"></a>Ограничения для библиотек и пакетов SDK

Сейчас поддержка библиотек для конечной точки версии 2.0 ограничена. Если требуется использовать конечную точку версии 2.0 в рабочем приложении, доступны приведенные ниже варианты.

* Если вы создаете веб-приложение, то для выполнения входа и проверки маркеров можно спокойно использовать общедоступную версию серверного ПО промежуточного слоя Майкрософт. В нее входит ПО промежуточного слоя OWIN OpenID Connect для ASP.NET и подключаемый модуль NodeJS Passport. Примеры кода с использованием ПО промежуточного слоя Майкрософт доступны в разделе о [начале работы](v2-overview.md#getting-started) статьи, посвященной версии 2.0.

* При создании классического или мобильного приложения можно использовать одну из библиотек проверки подлинности Майкрософт в предварительной версии. Эти библиотеки находятся на стадии предварительной версии с поддержкой рабочей среды, поэтому использовать их в рабочих приложениях безопасно. Дополнительные сведения об условиях предварительной версии и доступных библиотеках см. в статье [Библиотеки проверки подлинности Azure Active Directory версии 2.0](reference-v2-libraries.md).

* Для платформ, не поддерживаемых библиотеками Майкрософт, можно выполнять интеграцию с конечной точкой версии 2.0, непосредственно отправляя и принимая сообщения протокола в коде приложения. Чтобы помочь вам выполнить такую интеграцию, [мы добавили детальную информацию](active-directory-v2-protocols.md) о протоколах OpenID Connect и OAuth для версии 2.0.

* Наконец, для интеграции с конечной точкой версии 2.0 вы можете использовать библиотеки с открытым кодом OpenID Connect и OAuth. Протокол версии 2.0 должен быть совместим со многими другими библиотеками протоколов с открытым кодом без существенных изменений. Наличие этих библиотек зависит от языка и платформы. На веб-сайтах [Open ID Connect](http://openid.net/connect/) и [OAuth 2.0](http://oauth.net/2/) можно ознакомиться со списком популярных реализаций. Дополнительные сведения, список клиентских библиотек с открытым кодом и примеры, проверенные с конечной точкой версии 2.0, доступны в статье [Azure Active Directory (AD) версии 2.0 и библиотеки аутентификации](reference-v2-libraries.md).

* Примером для конечной точки `.well-known` для общей конечной точки версии 2.0 является `https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration`.  Замените `common` идентификатором вашего клиента, чтобы получить данные, относящиеся к вашему клиенту.  

### <a name="restrictions-on-protocols"></a>Ограничения для протоколов

Конечная точка версии 2.0 не поддерживает SAML или WS-Federation. Она поддерживает только Open ID Connect и OAuth 2.0. В ней реализованы не все функции и возможности протоколов OAuth.

В настоящее время в конечной версии 2.0 *недоступны* перечисленные ниже функции и возможности протокола.

* В настоящее время утверждение `email` возвращается только в том случае, если настроено дополнительное утверждение и в запросе указана область действия для электронной почты (scope=email). Но это поведение будет изменено по мере доработки конечной точки версии 2.0 для более полного соответствия стандартам Open ID Connect и OAuth 2.0.

* Конечная точка версии 2.0 не поддерживает выдачу утверждений ролей или групп в маркерах идентификации.

* Она не поддерживает [предоставление учетных данных владельца ресурса OAuth 2.0](https://tools.ietf.org/html/rfc6749#section-4.3).

Кроме того, конечная точка версии 2.0 не поддерживает протоколы SAML или WS-Federation ни в какой форме.

Чтобы лучше понять область действия функций протоколов, поддерживаемых в конечной точке версии 2.0, ознакомьтесь со [справочником по протоколам OpenID Connect и OAuth 2.0](active-directory-v2-protocols.md).

#### <a name="saml-restrictions"></a>Ограничения SAML

При использовании библиотеки проверки подлинности Active Directory (ADAL) в приложениях для Windows вы могли воспользоваться преимуществом встроенной проверки подлинности Windows, которая использует предоставление утверждения языка разметки заявлений системы безопасности (SAML). С его помощью пользователи федеративных клиентов Azure AD могут проходить аутентификацию в локальном экземпляре Active Directory автоматически, без необходимости ввода учетных данных. На данный момент предоставление утверждения SAML не поддерживается в конечной точке версии 2.0.
