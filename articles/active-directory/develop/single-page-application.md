---
title: Одностраничные приложения в Azure Active Directory
description: В этой статье описываются одностраничные приложения (SPA) и основные понятия, касающиеся потока протокола, регистрации и срока действия маркеров для приложений такого типа.
services: active-directory
documentationcenter: ''
author: CelesteDG
manager: mtillman
editor: ''
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 09/24/2018
ms.author: celested
ms.reviewer: saeeda, jmprieur, andret
ms.custom: aaddev
ms.openlocfilehash: 8b06f43522cd9c93be16de19036de65b69b07941
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46967784"
---
# <a name="single-page-applications"></a>Одностраничные приложения

Одностраничные приложения (SPA) обычно состоят из интерфейсной части на JavaScript, выполняемой в браузере, и серверной части веб-API, которая выполняется на сервере и реализует бизнес-логику приложения. Дополнительные сведения о неявном предоставлении авторизации и о том, насколько оно подходит для вашего приложения, см. в статье [Общие сведения о неявном потоке предоставления OAuth2 в Azure Active Directory (AD)](v1-oauth2-implicit-grant-flow.md).

В этом сценарии при входе пользователя в систему интерфейсная часть JavaScript использует [библиотеку проверки подлинности Active Directory для JavaScript (ADAL.JS)](https://github.com/AzureAD/azure-activedirectory-library-for-js) и неявное предоставление авторизации для получения маркера идентификатора (id_token) из Azure AD. Маркер кэшируется, а клиент присоединяет его к запросу как маркер носителя при отправке вызовов в свою серверную часть веб-API, для защиты которого применяется ПО промежуточного слоя OWIN.

## <a name="diagram"></a>Схема

![Схема одностраничного приложения](./media/authentication-scenarios/single_page_app.png)

## <a name="protocol-flow"></a>Поток протокола

1. Пользователь переходит в веб-приложение.
1. Приложение возвращает браузеру интерфейс (уровень представления данных) JavaScript.
1. Пользователь выполняет вход, например щелкает ссылку входа. Браузер отправляет инструкцию GET в конечную точку авторизации Azure AD для запроса идентификатора маркера. Этот запрос содержит идентификатор приложения и URL-адрес ответа.
1. Azure AD проверяет URL-адрес ответа путем его сравнения с зарегистрированным URL-адресом ответа, который указан на портале Azure.
1. Пользователь выполняет вход на странице входа.
1. В случае успешной проверки подлинности Azure AD создает маркер идентификатора и возвращает его в виде фрагмента URL-адреса (#) по URL-адресу ответа приложения. В рабочем приложении для этого URL-адреса ответа должен использоваться протокол HTTPS. Возвращаемый маркер содержит утверждения о пользователе и системе Azure AD, которые требуются приложению для проверки маркера.
1. Клиентский код JavaScript, выполняемый в браузере, извлекает маркер из ответа для использования при защите вызовов, отправляемых в серверную часть веб-интерфейса API приложения.
1. Браузер вызывает серверную часть веб-интерфейса API приложения с помощью маркера идентификатора в заголовке авторизации. Служба проверки подлинности Azure AD выдает маркер идентификатора, который можно использовать в качестве маркера носителя, если ресурс совпадает с идентификатором клиента (в таком случае это возможно, так как веб-API является серверной частью приложения).

## <a name="code-samples"></a>Примеры кода

Ознакомьтесь с [примерами кода для сценариев одностраничного приложения](sample-v1-code.md#single-page-applications). Периодически проверяйте этот раздел, так как он регулярно пополняется новыми примерами.

## <a name="app-registration"></a>Регистрация приложения

* Однотенантное приложение. Если создаваемое приложение предназначено только для вашей организации, его необходимо зарегистрировать в каталоге организации с помощью портала Azure.
* Мультитенантное приложение. Если создаваемое приложение предназначено для пользователей за пределами вашей организации, его необходимо зарегистрировать как в каталоге вашей организации, так и в каталогах каждой организации, пользователи из которой будут использовать приложение. Чтобы ваше приложение сделать доступным в чужом каталоге, можно реализовать процесс входа для клиентов, с помощью которого они смогут предоставлять вашему приложению требуемые разрешения. При входе клиентов в приложение для них будет отображаться диалоговое окно с разрешениями, которые требуются приложению. В этом окне также можно будет предоставить требуемые разрешения. В зависимости от необходимых разрешений может потребоваться, чтобы их предоставил администратор из другой организации. Если пользователь или администратор предоставляет требуемые разрешения, приложение регистрируется в их каталоге.

После регистрации приложения его необходимо настроить для использования протокола неявного предоставления разрешения OAuth 2.0. По умолчанию для приложений этот протокол отключен. Чтобы включить для приложения протокол неявного предоставления разрешения OAuth2, измените манифест приложения на портале Azure, установив для параметра oauth2AllowImplicitFlow значение true. Дополнительные сведения см. в статье [Манифест приложения Azure Active Directory](reference-app-manifest.md).

## <a name="token-expiration"></a>Срок действия маркера

Использование ADAL.js поможет вам:

* обновить просроченный маркер;
* запросить маркер доступа для вызова ресурса веб-API.

После успешной проверки подлинности Azure AD записывает файл cookie в браузере пользователя, чтобы установить сеанс. Обратите внимание, что сеанс устанавливается между пользователем и Azure AD, а не между пользователем и веб-приложением. По истечении срока действия маркера файл ADAL.js использует этот сеанс для автоматического получения другого маркера. ADAL.js использует скрытый элемент iFrame, чтобы отправлять и получать запросы по протоколу неявного предоставления разрешения OAuth. ADAL.js также может использовать такой же механизм для автоматического получения маркеров доступа для других ресурсов веб-API, которые приложение может вызывать, пока эти ресурсы поддерживают функцию общего доступа к ресурсам независимо от источника (CORS) и зарегистрированы в каталоге пользователя и пока все необходимые разрешения предоставляются пользователем при входе в систему.

## <a name="next-steps"></a>Дополнительная информация

* Дополнительные сведения см. в статье [о других типах приложений и сценариях](app-types.md)
* Ознакомьтесь с основными понятиями аутентификации в статье [Сценарии проверки подлинности в Azure AD](authentication-scenarios.md)
