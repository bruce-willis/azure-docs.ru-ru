---
title: Интеграция приложений с Azure Active Directory
description: Узнайте как обновить приложение в Azure Active Directory (Azure AD).
services: active-directory
documentationcenter: ''
author: CelesteDG
manager: mtillman
editor: ''
ms.service: active-directory
ms.component: develop
ms.devlang: na
ms.topic: quickstart
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 09/24/2018
ms.author: celested
ms.custom: aaddev
ms.reviewer: lenalepa, sureshja
ms.openlocfilehash: f311f951e09e064b8eac779b1082c666fe029479
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46977253"
---
# <a name="quickstart-update-an-application-in-azure-active-directory"></a>Краткое руководство по обновлению приложения в Azure Active Directory

Корпоративным разработчикам и поставщикам программного обеспечения как услуги (SaaS), которые зарегистрировали приложения в Azure Active Directory (Azure AD), возможно, потребуется настроить приложения для доступа к другим ресурсам, таким как веб-API, сделать его доступным в других организациях и многое другое.

В этом кратком руководстве вы узнаете о различных способах настройки или обновления приложения для удовлетворения ваших потребностей и потребностей других организаций.

## <a name="prerequisites"></a>Предварительные требования

Перед началом работы убедитесь, что выполнено все приведенное ниже.

* Прочтите общие сведения в разделе [Как действует согласие для приложения](consent-framework.md). Для создания приложений, которые будут использовать другие пользователи или приложения, это важно понимать.
* У вас установлен клиент Azure AD, содержащий зарегистрированные приложения.
  * Если клиента нет, [узнайте, как его получить](quickstart-create-new-tenant.md).
  * Если у вас нет приложений, зарегистрированных в клиенте, [узнайте, как добавить приложение в Azure AD](quickstart-v1-integrate-apps-with-azure-ad.md).

## <a name="configure-a-client-application-to-access-web-apis"></a>Настройка клиентского приложения для доступа к веб-API

Чтобы клиентское конфиденциальное или веб-приложение могло участвовать в потоке предоставления кода авторизации, требующего проверки подлинности (и получения маркера доступа), ему необходимо установить безопасные учетные данные. По умолчанию на портале Azure используется метод аутентификации "идентификатор клиента + секретный ключ". В этом разделе рассматриваются шаги настройки, необходимые для предоставления секретного ключа с учетными данными клиента.

Чтобы клиент смог получить доступ к веб-API, предоставляемому приложением ресурсов (например, API Microsoft Graph), платформа согласия должна позволить ему получить требуемое разрешение в зависимости от запрошенных разрешений. По умолчанию все приложения могут выбирать разрешения из **Azure Active Directory** (Graph API) и классической модели развертывания Azure. [Разрешение API Graph "Вход в систему и чтение профиля пользователя"](https://msdn.microsoft.com/Library/Azure/Ad/Graph/howto/azure-ad-graph-api-permission-scopes#PermissionScopeDetails) также будет выбрано по умолчанию. Если клиентское приложение регистрируется в клиенте, в котором есть учетные записи, подписанные на Office 365, можно выбрать интерфейсы веб-API и разрешения для SharePoint и Exchange Online. Вы можете выбрать один из двух типов разрешений для каждого требуемого веб-API.

- Разрешения приложения. Вашему клиентскому приложению требуется доступ к веб-API от своего имени (без контекста пользователя). Этот тип разрешения требует согласия администратора и недоступен для собственных клиентских приложений.
- Делегированное разрешение. Вашему приложению требуется доступ к веб-API от лица выполнившего вход пользователя, но с ограничением доступа по выбранному разрешению. Этот тип разрешения может быть предоставлен пользователем, если только для разрешения не требуется согласие администратора.

  > [!NOTE]
  > Когда вы добавляете в приложение делегированные разрешения, согласие не предоставляется автоматически для всех пользователей в клиенте. Пользователи должны по-прежнему вручную предоставлять согласие на дополнительные делегированные разрешения в среде выполнения, если администратор не дает согласие от имени всех пользователей.

### <a name="add-application-credentials-or-permissions-to-access-web-apis"></a>Добавление учетных данных приложения или разрешений для доступа к веб-API

1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ нескольким клиентам, выберите свою учетную запись в правом верхнем углу и нужный клиент Azure AD для этого сеанса портала.
3. В области навигации слева выберите службу **Azure Active Directory**, выберите **Регистрация приложений**, а затем найдите и выберите приложение, которое необходимо настроить.

   ![Обновление регистрации приложения](./media/quickstart-v1-integrate-apps-with-azure-ad/update-app-registration.png)

4. Вы перейдете на главную страницу регистрации приложения, в которой содержится страница **Параметры** приложения. Чтобы добавить учетные данные для веб-приложения, сделайте следующее:
  1. Выберите раздел **Ключи** на странице **Параметры**.
  2. Чтобы добавить сертификат, сделайте следующее:
    - Выберите **Отправить открытый ключ**.
    - Выберите файл, который вы хотите отправить. Он должен быть одного из следующих типов файлов: CER, PEM, CRT.
  - Чтобы добавить пароль, сделайте следующее:
    - Добавьте описание ключа.
    - Выберите длительность.
    - Щелкните **Сохранить**. Когда вы сохраните изменения конфигурации, значение ключа отобразится в крайнем правом столбце. **Не забудьте скопировать ключ** для использования в коде клиентского приложения, так как он станет недоступен после выхода со страницы.

5. Добавление разрешений для доступа к API ресурсов из клиента
  1. На странице **Параметры** выберите **Необходимые разрешения** и выберите **Добавить**.
  1. Щелкните **Выбрать API**, чтобы выбрать требуемый тип ресурсов.
  1. Просмотрите список доступных API-интерфейсов или используйте поле поиска, чтобы выбрать доступные ресурсы приложений в каталоге, предоставляющие веб-интерфейс API. Выберите нужный ресурс, а затем щелкните **Выбрать**.
  1. На странице **Разрешить доступ** выберите разрешение приложения или делегированные разрешения, необходимые приложению для доступа к API.
   
  ![Обновление регистрации приложения: API разрешений](./media/quickstart-v1-integrate-apps-with-azure-ad/update-app-registration-settings-permissions-api.png)

  ![Обновление регистрации приложения: разрешения](./media/quickstart-v1-integrate-apps-with-azure-ad/update-app-registration-settings-permissions-perms.png)

6. По завершении выберите **Выбрать** на странице **Разрешить доступ**, а затем нажмите кнопку **Готово** на странице **Добавить доступ через API**. Откроется страница **Необходимые разрешения**, на которой новый ресурс будет добавлен в список API.

## <a name="configuring-a-resource-application-to-expose-web-apis"></a>Настройка приложения ресурсов для предоставления веб-API

Вы можете разработать веб-API и сделать его доступным для клиентских приложений, предоставив [области доступа](developer-glossary.md#scopes) и [роли](developer-glossary.md#roles). Доступ к правильно настроенному веб-API предоставляется по аналогии с другими веб-API корпорации Майкрософт, включая API Graph и API Office 365. Области доступа и роли задаются с помощью [манифеста приложения](developer-glossary.md#application-manifest), JSON-файла, который представляет собой конфигурацию удостоверения приложения.

Ниже показано, как задать области доступа, изменив манифест приложения ресурсов.

### <a name="add-access-scopes-to-your-resource-application"></a>Добавление областей доступа в приложение ресурсов

1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ нескольким клиентам, выберите свою учетную запись в правом верхнем углу и нужный клиент Azure AD для этого сеанса портала.
3. В области навигации слева выберите **Azure Active Directory > Регистрация приложений**, а затем найдите и выберите приложение, которое необходимо настроить.

   ![Обновление регистрации приложения](./media/quickstart-v1-integrate-apps-with-azure-ad/update-app-registration.png)

4. Вы перейдете на главную страницу регистрации приложения, в которой откроется страница **Параметры** приложения. Чтобы перейти на страницу **Изменение манифеста**, щелкните **Манифест** на странице регистрации приложения. Откроется веб-редактор манифеста, который позволяет **изменить** манифест на портале. При необходимости можно щелкнуть **Скачать** и выполнить изменение локально, а затем повторно применить его для приложения с помощью команды **Отправить**.
5. В этом примере предоставляется новая область с именем `Employees.Read.All` в ресурсе или API путем добавления следующего элемента JSON в коллекцию `oauth2Permissions`. Имеющаяся область `user_impersonation` предоставляется по умолчанию во время регистрации. `user_impersonation` позволяет приложению клиента запрашивать разрешения для доступа к ресурсу, используя удостоверение пользователя, выполнившего вход. Обязательно добавьте запятую после имеющегося элемента области `user_impersonation` и измените значения свойств в соответствии с потребностями ресурса. 

  ```json
  {
    "adminConsentDescription": "Allow the application to have read-only access to all Employee data.",
    "adminConsentDisplayName": "Read-only access to Employee records",
    "id": "2b351394-d7a7-4a84-841e-08a6a17e4cb8",
    "isEnabled": true,
    "type": "User",
    "userConsentDescription": "Allow the application to have read-only access to your Employee data.",
    "userConsentDisplayName": "Read-only access to your Employee records",
    "value": "Employees.Read.All"
  }
  ```

  > [!NOTE]
  > В качестве значения `id` должен выступать новый GUID, созданный программным путем или с помощью инструмента создания [guidgen](https://msdn.microsoft.com/library/ms241442%28v=vs.80%29.aspx). Значение `id` представляет уникальный идентификатор для области в качестве предоставляемого веб-API. Когда клиент соответствующим образом настроен и имеет разрешения на доступ к веб-API, Azure AD выдает маркер доступа OAuth 2.0. Во время вызова веб-API клиент предоставляет маркер доступа с утверждением области (scp), для которого заданы разрешения, запрашиваемые в его регистрации приложения.
  >
  > Позднее вы можете по мере необходимости предоставлять дополнительные области доступа. Помните о том, что веб-API может предоставлять несколько областей, связанных с множеством разных функций. Ресурс может управлять доступом к веб-API в среде выполнения, вычисляя утверждения области (`scp`) в полученном маркере доступа OAuth 2.0.

6. По завершении щелкните **Сохранить**. Теперь веб-интерфейс API настроен для использования другими приложениями в каталоге.

  ![Обновление регистрации приложения](./media/quickstart-v1-integrate-apps-with-azure-ad/update-app-registration-manifest.png)

### <a name="verify-the-web-api-is-exposed-to-other-applications-in-your-tenant"></a>Для проверки доступности веб-API другим приложениям клиента

1. Вернитесь к клиенту Azure AD, выберите **Регистрация приложений** еще раз, а затем найдите и выберите приложение клиента, которое необходимо настроить.

   ![Обновление регистрации приложения](./media/quickstart-v1-integrate-apps-with-azure-ad/update-app-registration.png)

2. Повторите шаг 5, как описано в разделе [Настройка клиентского приложения для доступа к веб-API](#configure-a-client-application-to-access-web-apis). По достижении шага **Выбор API** найдите свой ресурс, введя имя его приложения в поле поиска, и щелкните **Выбрать**.

3. На странице **Разрешить доступ** отобразится новая область, доступная для запросов разрешений клиента.

  ![Отображение новых разрешений](./media/quickstart-v1-integrate-apps-with-azure-ad/update-app-registration-settings-permissions-perms-newscopes.png)

### <a name="more-on-the-application-manifest"></a>Дополнительная информация о манифесте приложения

Манифест приложения является механизмом обновления сущности приложения, который определяет все атрибуты конфигурации удостоверения приложения Azure AD, в том числе области доступа API, рассмотренные выше. Дополнительные сведения см. в разделе, посвященном сущности "Приложение" и ее схеме (в [документации по сущности "Приложение API Graph"](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity)). В этой статье вы найдете полную информацию об элементах сущности "Приложение", которые используются при указании разрешений для API, включая:  

- элемент appRoles — коллекция сущностей [AppRole](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#approle-type), которые используются при определении [разрешений приложения](developer-glossary.md#permissions) для веб-API; 
- элемент oauth2Permissions — коллекция сущностей [OAuth2Permission](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#oauth2permission-type), которые используются при определении [делегированных разрешений](developer-glossary.md#permissions) для веб-API.

Дополнительные сведения о концепциях манифеста приложений в целом см. в разделе [Манифест приложения Azure Active Directory](reference-app-manifest.md).

## <a name="accessing-the-azure-ad-graph-and-office-365-via-microsoft-graph-apis"></a>Доступ к Azure AD Graph и Office 365 с помощью API Microsoft Graph  

Как упоминалось ранее, наряду с предоставлением доступа к API в приложениях можно зарегистрировать клиентское приложение для доступа к API, которые предоставляются ресурсами Майкрософт. Microsoft Graph API, называемый "Microsoft Graph" в списке ресурсов и API на портале, доступно всем приложениям, зарегистрированным в Azure AD. При регистрации клиентского приложения в клиенте, который содержит учетные записи, зарегистрированные в подписке Office 365, можно получить доступ к областям, предоставляемым различными ресурсами Office 365.

Полное описание областей, предоставляемых API Microsoft Graph, приведено в статье [Справочник по разрешениям Microsoft Graph](https://developer.microsoft.com/en-us/graph/docs/concepts/permissions_reference).

> [!NOTE]
> Из-за имеющихся в данный момент ограничений собственные клиентские приложения могут вызывать API Graph Azure AD только при использовании разрешения Access your organization's directory (Доступ к каталогу организации). Это ограничение не распространяется на веб-приложения.

## <a name="configuring-multi-tenant-applications"></a>Настройка мультитенантных приложений

При регистрации приложения в Azure AD вам может потребоваться предоставить доступ к этому приложению только пользователям в вашей организации. Кроме того, может также потребоваться, чтобы доступ к приложению могли получить пользователи из других организаций. Два этих типа приложений называются однотенантными и мультитенантными. В этом разделе описывается, как можно изменить конфигурацию отдельного однотенантного приложения, чтобы сделать его мультитенантным.

Следует отметить различия между однотенантным и мультитенантным приложением:  

- Однотенантное (для одного клиента) приложение предназначено для использования в одной организации. Обычно это бизнес-приложения, которые создает разработчик компании. Доступ к однотенантному приложению могут получить только пользователи с учетными записями в том же клиенте, где зарегистрировано приложение. В результате его достаточно подготовить в одном каталоге.
- Мультитенантное (для нескольких клиентов) приложение предназначено для использования в нескольких организациях. Это веб-приложение категории "программное обеспечение как услуга" (SaaS) обычно создается независимым поставщиком программного обеспечения (ISV). В каждом клиенте, к которому пользователям требуется доступ, необходимо подготовить мультитенантные приложения. Для клиентов, отличных от того, где было зарегистрировано приложение, требуется согласие пользователя или администратора для их регистрации. Обратите внимание, что собственные клиентские приложения являются мультитенантными по умолчанию, так как они установлены на устройстве владельца ресурсов. Дополнительные сведения о платформе согласия см. в разделе [Обзор инфраструктуры согласия](#overview-of-the-consent-framework) выше.

Чтобы сделать приложение мультитенантным, необходимо изменение регистрации приложения, а также изменения в самом веб-приложении. В следующих разделах описываются оба требования.

### <a name="changing-the-application-registration-to-support-multi-tenant"></a>Изменение регистрации приложения для поддержки нескольких клиентов

Если вы создаете приложение, которое будет доступно для сторонних клиентов или партнеров, следует обновить определение приложения на портале Azure.

> [!IMPORTANT]
> Для Azure AD необходимо, чтобы универсальный код ресурса (URI) идентификатора приложения для мультитенантного приложения был глобально уникальным. URI кода приложения является одним из способов идентификации приложения в сообщениях протокола. Для приложения с одним клиентом достаточно, чтобы URI кода приложения был уникальным в рамках клиента. Для мультитенантного приложения он должен быть глобально уникальным, чтобы служба Azure AD могла найти приложение по всем клиентам.
> Глобальная уникальность обеспечивается за счет требования, чтобы URI кода приложения имел имя узла, соответствующее проверенному домену клиента Azure AD. Например, если имя клиента — contoso.onmicrosoft.com, то допустимым URI кода приложения будет https://contoso.onmicrosoft.com/myapp. Если у клиента есть проверенный домен contoso.com, тогда допустимый URI идентификатора приложения также будет https://contoso.com/myapp. Если URI идентификатора приложения не соответствует этому шаблону, вы не сможете сделать приложение мультитенантным.

Чтобы предоставить внешним пользователям возможность доступа к приложению:

1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.
3. В области навигации слева щелкните службу **Azure Active Directory**, выберите **Регистрация приложений**, а затем найдите и щелкните приложение, которое необходимо настроить. Вы перейдете на главную страницу регистрации приложения, в которой откроется страница **Параметры** приложения.
4. На странице **Параметры** выберите **Свойства** и переведите переключатель **Мультитенантное** в положение **Да**.

После внесения изменений пользователи и администраторы в других организациях смогут предоставлять своим пользователям возможность входа в приложение, позволяя приложению получать доступ к ресурсам, которые защищены их клиентом.

### <a name="changing-the-application-to-support-multi-tenant"></a>Изменение приложения для поддержки нескольких клиентов

Поддержка мультитенантных приложений в значительной степени зависит от платформы согласия Azure AD. Согласие — это механизм, позволяющий пользователям из другого клиента предоставлять приложению доступ к ресурсам, защищаемым клиентом пользователя. Это называется согласием пользователя.

Веб-приложения также могут предлагать:

- Возможность зарегистрировать свою организацию для администраторов. Эта возможность называется согласием администратора и позволяет ему предоставить согласие от имени *всех пользователей* организации. Только пользователь, выполняющий проверку подлинности с помощью учетной записи, принадлежащей роли глобального администратора, может предоставить согласие администратора. Остальные пользователи увидят сообщение об ошибке.
- Возможность входа для пользователей. Предполагается, что пользователю будет предоставлена кнопка "Регистрация", которая перенаправит браузер в конечную точку `/authorize` Azure AD OAuth 2.0 или в конечную точку `/userinfo` OpenID Connect. Эти конечные точки позволяют приложению получить сведения о новом пользователе путем проверки id_token. На следующем этапе регистрации пользователя появится запрос на согласие, как показано в разделе [Обзор платформы согласия](#overview-of-the-consent-framework).

Дополнительные сведения об изменениях приложения, необходимых для поддержки мультитенантного доступа и регистрации или входа, см. в следующих ресурсах:

- [Как реализовать вход любого пользователя Azure Active Directory (AD) с помощью шаблона мультитенантного приложения](howto-convert-app-to-be-multi-tenant.md)
- Список [примеров кода мультитенантных приложений](https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multi-tenant).
- [Краткое руководство по добавлению фирменной символики организации на страницу входа в Azure Active Directory](../fundamentals/customize-branding.md)

## <a name="enabling-oauth-20-implicit-grant-for-single-page-applications"></a>Включение неявного предоставления авторизации OAuth 2.0 для одностраничных приложений

В одностраничных приложениях (SPA) обычно используется клиент с большим объемом кода на JavaScript, который выполняется в браузере и вызывает веб-API серверного приложения для выполнения своих операций бизнес-логики. Для одностраничных приложений, размещенных в Azure AD, проверка подлинности пользователя в Azure AD выполняется с помощью протокола OAuth 2.0 Implicit Grant. После этого пользователь получает маркер, который можно использовать для безопасных вызовов серверного веб-API из клиентского кода JavaScript приложения.

После того как пользователь предоставил свое согласие, этот же протокол проверки подлинности можно использовать для получения маркеров для защиты вызовов между клиентом и другими ресурсами веб-API, которые настроены для приложения. Дополнительные сведения о процессе неявного предоставления авторизации и его совместимости с вашим приложением см. в статье [Общие сведения о неявном потоке предоставления OAuth2 в Azure Active Directory (AD)](v1-oauth2-implicit-grant-flow.md).

По умолчанию неявное предоставление авторизации OAuth 2.0 для приложений отключено. Чтобы включить неявное разрешение OAuth 2.0 для приложения, необходимо установить значение `oauth2AllowImplicitFlow` в [манифесте приложения](reference-app-manifest.md).

### <a name="to-enable-oauth-20-implicit-grant"></a>Чтобы включить неявное предоставление авторизации OAuth 2.0, выполните следующие действия.

> [!NOTE]
> Дополнительные сведения о том, как изменять манифест приложения, см. в предыдущем разделе [Настройка приложения ресурсов для предоставления веб-API](#configuring-a-resource-application-to-expose-web-apis).

1. Войдите на [портале Azure](https://portal.azure.com).
2. Если учетная запись предоставляет доступ к нескольким клиентам, щелкните учетную запись в правом верхнем углу и выберите нужного клиента Azure AD для этого сеанса портала.
3. В области навигации слева щелкните службу **Azure Active Directory**, выберите **Регистрация приложений**, а затем найдите и щелкните приложение, которое необходимо настроить. Вы перейдете на главную страницу регистрации приложения, в которой откроется страница **Параметры** приложения.
4. Щелкните **Манифест** на странице регистрации приложения, чтобы перейти на страницу **Изменение манифеста**. Откроется веб-редактор манифеста, который позволяет **изменить** манифест на портале. Найдите параметр oauth2AllowImplicitFlow и установите для него значение true. По умолчанию установлено значение false.
   
  ```json
  "oauth2AllowImplicitFlow": true,
  ```
5. Сохраните обновленный манифест. Теперь этот веб-интерфейс API будет использовать для аутентификации пользователей протокол OAuth 2.0 Implicit Grant.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о других кратких руководствах по управлению приложениями с помощью конечной точки Azure AD версии 1.0 см. в следующих разделах.
- [Интеграция приложений с Azure Active Directory](quickstart-v1-integrate-apps-with-azure-ad.md)
- [Quickstart: Remove an application from Azure Active Directory](quickstart-v1-remove-azure-ad-app.md) (Краткое руководство по удалению приложения с Azure AD)

Дополнительные сведения о двух объектах Azure AD, представляющих зарегистрированное приложение, и о взаимосвязи между ними см. в разделе [Объекты приложения и субъекта-службы в Azure Active Directory (Azure AD)](app-objects-and-service-principals.md).

Дополнительные сведения о фирменной символике, которой следует пользоваться при разработке приложений в среде Azure Active Directory (Azure AD) см. в разделе [Рекомендации по фирменной символике для приложений](howto-add-branding-in-azure-ad-apps.md).