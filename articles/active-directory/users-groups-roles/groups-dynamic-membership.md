---
title: Справочник по правилам автоматического назначения динамического членства в группах в Azure Active Directory | Документация Майкрософт
description: Сведения о создании правил членства для автоматического заполнения групп и о ссылках на эти правила.
services: active-directory
documentationcenter: ''
author: curtand
manager: mtillman
editor: ''
ms.service: active-directory
ms.workload: identity
ms.component: users-groups-roles
ms.topic: article
ms.date: 08/01/2018
ms.author: curtand
ms.reviewer: krbain
ms.custom: it-pro
ms.openlocfilehash: 9c0bb676cc59820d3ae83612893c8920d5d0aebe
ms.sourcegitcommit: 1d850f6cae47261eacdb7604a9f17edc6626ae4b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/02/2018
ms.locfileid: "39424377"
---
# <a name="dynamic-membership-rules-for-groups-in-azure-active-directory"></a>Правила динамического членства в группах для Azure Active Directory

В Azure Active Directory (Azure AD) можно создать сложные, основанные на атрибутах правила динамического членства в группах. Динамическое членство в группах позволяет оптимизировать административную работу по добавлению и удалению пользователей. В этой статье подробно описываются свойства и синтаксис для создания правил динамического членства пользователей и (или) устройств. Вы можете настроить правило динамического членства для групп безопасности или групп Office 365.

Когда изменяются любые атрибуты пользователя, система оценивает все правила динамических групп в каталоге, чтобы определить, приведет ли это изменение к добавлению или удалению в группах. Если пользователь или устройство отвечает правилу, установленному для группы, они добавляются в эту группу. Они удаляются из группы, когда перестают отвечать этому правилу.

* Вы можете создать динамическую группу как для устройств, так и для пользователей, но невозможно создать правило, которое включает пользователей и устройства одновременно.
* Вы не можете создать группу устройств на основе атрибутов их владельцев. Правила членства для устройств могут ссылаться только на атрибуты этих устройств.

> [!NOTE]
> Этот компонент требует наличия лицензии Azure AD Premium P1 для каждого уникального пользователя, добавленного хотя бы в одну из динамических групп. Вам необязательно назначать лицензии пользователям, чтобы внести их в динамическую группу. Но минимальное число лицензий в клиенте должно быть достаточным для всех пользователей. Например, если общее число уникальных пользователей во всех динамических группах в клиенте составляет 1000, чтобы обеспечить соответствие требованиям лицензирования, необходимо не менее 1000 лицензий для Azure AD Premium P1.
>

## <a name="constructing-the-body-of-a-membership-rule"></a>Создание текста для правила членства

Правило членства, которое автоматически добавляет в группу пользователей или устройства, представляет собой выражение с двоичным результатом, то есть оно возвращает значение true или false. Простейшее правило состоит из трех частей:

* Свойство
* Оператор
* Значение

Чтобы избежать синтаксических ошибок, следует соблюдать определенный порядок частей в этом выражении.

### <a name="rules-with-a-single-expression"></a>Правила с одним выражением

Одно выражение — это минимально возможная форма для правил членства, не содержащая только упомянутые выше три части. Правило с одним выражением выглядит примерно так: `Property Operator Value`, где свойства указываются в формате "объект.свойство".

Ниже приведен пример правила членства с одним выражением в правильном формате:

```
user.department -eq "Sales"
```

Круглые скобки для одного выражения не обязательны. Общая длина текста для правила членства не может превышать 2048 символов.

## <a name="supported-properties"></a>Поддерживаемые свойства

Существует три типа свойств, которые можно использовать для создания правил членства.

* Логическое
* Строка
* Коллекция строк

Ниже приведены свойства пользователя, которые можно использовать для создания одного выражения.

### <a name="properties-of-type-boolean"></a>Свойства логического типа

| properties | Допустимые значения | Использование |
| --- | --- | --- |
| AccountEnabled |true, false |user.accountEnabled -eq true |
| dirSyncEnabled |true, false |user.dirSyncEnabled -eq true |

### <a name="properties-of-type-string"></a>Свойства строкового типа

| properties | Допустимые значения | Использование |
| --- | --- | --- |
| city |Любое строковое значение или *null*. |(user.city -eq "value") |
| country |Любое строковое значение или *null*. |(user.country -eq "value") |
| companyName | Любое строковое значение или *null*. | (user.companyName -eq "value") |
| department |Любое строковое значение или *null*. |(user.department -eq "value") |
| displayName |Любое строковое значение. |(user.displayName -eq "value") |
| employeeId |Любое строковое значение. |(user.employeeId -eq "value")<br>(user.employeeId -ne *null*) |
| facsimileTelephoneNumber |Любое строковое значение или *null*. |(user.facsimileTelephoneNumber -eq "value") |
| givenName |Любое строковое значение или *null*. |(user.givenName -eq "value") |
| jobTitle |Любое строковое значение или *null*. |(user.jobTitle -eq "value") |
| mail |Любое строковое значение или *null* (SMTP-адрес пользователя). |(user.mail -eq "value") |
| mailNickName |Любое строковое значение (псевдоним электронной почты пользователя) |(user.mailNickName -eq "value") |
| mobile |Любое строковое значение или *null*. |(user.mobile -eq "value") |
| objectId |GUID объекта пользователя. |(user.objectId -eq "11111111-1111-1111-1111-111111111111") |
| onPremisesSecurityIdentifier; | Локальный идентификатор безопасности (SID) для пользователей, которые были синхронизированы из локальной среды в облако. |(user.onPremisesSecurityIdentifier -eq "S-1-1-11-1111111111-1111111111-1111111111-1111111") |
| passwordPolicies |None, DisableStrongPassword, DisablePasswordExpiration, DisablePasswordExpiration, DisableStrongPassword |(user.passwordPolicies -eq "DisableStrongPassword") |
| physicalDeliveryOfficeName |Любое строковое значение или *null*. |(user.physicalDeliveryOfficeName -eq "value") |
| postalCode |Любое строковое значение или *null*. |(user.postalCode -eq "value") |
| preferredLanguage |Код ISO 639-1. |(user.preferredLanguage -eq "en-US") |
| sipProxyAddress |Любое строковое значение или *null*. |(user.sipProxyAddress -eq "value") |
| state |Любое строковое значение или *null*. |(user.state -eq "value") |
| streetAddress |Любое строковое значение или *null*. |(user.streetAddress -eq "value") |
| surname |Любое строковое значение или *null*. |(user.surname -eq "value") |
| TelephoneNumber |Любое строковое значение или *null*. |(user.telephoneNumber -eq "value") |
| usageLocation |Двухбуквенный код страны. |(user.usageLocation -eq "US") |
| userPrincipalName |Любое строковое значение. |(user.userPrincipalName -eq "alias@domain") |
| userType |member, guest, *null* |(user.userType -eq "Member") |

### <a name="properties-of-type-string-collection"></a>Свойства типа коллекции строк

| properties | Допустимые значения | Использование |
| --- | --- | --- |
| otherMails |Любое строковое значение. |(user.otherMails -contains "alias@domain") |
| proxyAddresses |SMTP: alias@domain, smtp: alias@domain |(user.proxyAddresses -contains "SMTP: alias@domain") |

Свойства, используемые для правил устройств, описаны в разделе [Правила для устройств](#rules-for-devices).

## <a name="supported-operators"></a>Поддерживаемые операторы

В следующей таблице перечислены все поддерживаемые операторы и их синтаксис для одного выражения. Все операторы можно использовать с дефисом в качестве префикса или без него.

| Оператор | Синтаксис |
| --- | --- |
| Не равно |-ne |
| Равно |-eq |
| Не начинается с |-notStartsWith |
| Начинается с |-startsWith |
| Не содержит |-notContains |
| Содержит |-contains |
| Не соответствует |-notMatch |
| Соответствует |-match |
| В | -in |
| Не входит | -notIn |

### <a name="using-the--in-and--notin-operators"></a>Использование операторов -In и -notIn

Чтобы сравнить значение атрибута пользователя с рядом различных значений, можно использовать оператор -In или -notIn. Символы скобок [ и ] обозначают начало и конец списка значений.

 Выражение в следующем примере принимает значение true, если значение user.department равно любому значению из списка.

```
   user.department -In ["50001","50002","50003",“50005”,“50006”,“50007”,“50008”,“50016”,“50020”,“50024”,“50038”,“50039”,“51100”]
```

## <a name="supported-values"></a>Поддерживаемые значения

Используемые в выражении значения могут состоять из нескольких типов, включая следующие:

* строк
* логическое (true или false);
* Числа
* массивы (чисел или строк).

Включая значение в выражение, важно использовать правильный синтаксис, чтобы избежать ошибок. Вот несколько советов по синтаксису:

* Двойные кавычки использовать не обязательно, если значение не является строкой.
* В операциях со строками и регулярными выражениями не учитывается регистр знаков.
* Если строковое значение содержит двойные кавычки, обе кавычки следует экранировать символом \`, например так: user.department -eq \`"Sales\`". Это правильный синтаксис, если Sales является строковым выражением.
* Можно также выполнить проверку наличия значений NULL, используя значение NULL, например так: `user.department -eq null`.

### <a name="use-of-null-values"></a>Использование значений Null

Чтобы указать значение NULL в правиле, можно использовать значение *null*. 

* Используйте -eq или -ne при сравнении значения *null* в выражении.
* Используйте кавычки вокруг *null*, если это значение нужно интерпретировать как литеральное строковое значение.
* Оператор -not не может использоваться в качестве оператора сравнения со значением null. В противном случае при использовании значения null или $null произойдет ошибка.

Ниже показано, как правильно указывать значение NULL.

```
   user.mail –ne null
```

## <a name="rules-with-multiple-expressions"></a>Правила с несколькими выражениями

Правило членства в группе может состоять из нескольких двоичных выражений, разделенных логическими операторами -and, -or и (или) -not. Логические операторы можно комбинировать друг с другом. 

Ниже приведены примеры правильно составленных правил с несколькими выражениями:

```
(user.department -eq "Sales") -or (user.department -eq "Marketing")
(user.department -eq "Sales") -and -not (user.jobTitle -contains "SDE")
```

### <a name="operator-precedence"></a>Приоритет операторов

Все операторы перечислены в порядке убывания приоритета. Операторы в одной строке имеют одинаковый приоритет.

```
-eq -ne -startsWith -notStartsWith -contains -notContains -match –notMatch -in -notIn
-not
-and
-or
-any -all
```

Для объяснения приоритетности операторов приведен пример, в котором для пользователя вычисляются два выражения:

```
   user.department –eq "Marketing" –and user.country –eq "US"
```

Скобки требуются только в том случае, если приоритет не соответствует вашим требованиям. Например, если сначала нужно проверить отдел, можно задать такой порядок с помощью круглых скобок:

```
   user.country –eq "US" –and (user.department –eq "Marketing" –or user.department –eq "Sales")
```

## <a name="rules-with-complex-expressions"></a>Правила со сложными выражениями

Правило членства может состоять из более сложных выражений, содержащих свойства, операторы и значения. Выражения считаются сложными, если выполняется любое из следующих условий:

* свойство состоит из коллекции значений (например, свойство с несколькими значениями);
* в выражениях используются операторы -any и (или) -all;
* значение выражения может представлять собой одно или несколько выражений.

## <a name="multi-value-properties"></a>Многозначные свойства

Многозначные свойства являются коллекциями объектов того же типа. Их можно использовать для создания правил членства с помощью логических операторов -any и (или) -all.

| properties | Значения | Использование |
| --- | --- | --- |
| assignedPlans | Каждый объект в коллекции предоставляет следующие строковые параметры: capabilityStatus, service, servicePlanId |user.assignedPlans -any (assignedPlan.servicePlanId -eq "efb87545-963c-4e0d-99df-69c6916d9eb0" -and assignedPlan.capabilityStatus -eq "Enabled") |
| proxyAddresses| SMTP: alias@domain, smtp: alias@domain | (user.proxyAddresses -any (\_ -contains "contoso")) |

### <a name="using-the--any-and--all-operators"></a>Использование операторов -any и -all

Вы можете использовать операторы -any и -all для применения условия к одному или ко всем элементам в коллекции соответственно.

* -any (выполняется, когда условию соответствует хотя бы один элемент в коллекции)
* -all (выполняется, когда условию соответствуют все элементы в коллекции)

#### <a name="example-1"></a>Пример 1

assignedPlans — это многозначное свойство, которое перечисляет все сервисные планы, назначенные пользователю. Представленное ниже выражение отбирает пользователей, которым назначен план обслуживания Exchange Online (план 2), то есть присвоен идентификатор этого плана, и этот план находится в состоянии Enabled:

```
user.assignedPlans -any (assignedPlan.servicePlanId -eq "efb87545-963c-4e0d-99df-69c6916d9eb0" -and assignedPlan.capabilityStatus -eq "Enabled")
```

Правила подобного вида позволяют сгруппировать всех пользователей, для которых включен компонент Office 365 (или другая служба Microsoft Online). После этого вы сможете применить к этой группе набор политик.

#### <a name="example-2"></a>Пример 2

Следующее выражение выбирает всех пользователей, которым назначен любой план обслуживания, связанный со службой Intune (это определяется по имени службы "SCO").

```
user.assignedPlans -any (assignedPlan.service -eq "SCO" -and assignedPlan.capabilityStatus -eq "Enabled")
```

### <a name="using-the-underscore--syntax"></a>Использование синтаксической конструкции с символом подчеркивания (\_)

Символ подчеркивания (\_) позволяет сопоставить вхождения определенного значения одного из свойств в коллекции многозначных строк, чтобы добавить пользователей или устройства в динамическую группу. Он используется в сочетании с оператором -any или -all.

Ниже приведен пример использования символа подчеркивания (\_) в правиле для добавления участников в зависимости от значения user.proxyAddress (это правило также подходит для свойства user.otherMails). Это правило добавляет в группу любого пользователя, адрес прокси-сервера которого содержит "contoso".

```
(user.proxyAddresses -any (_ -contains "contoso"))
```

## <a name="other-properties-and-common-rules"></a>Другие свойства и типичные примеры правил

### <a name="create-a-direct-reports-rule"></a>Создание правила "Непосредственные подчиненные"

Вы можете создать группу, в которую войдут все непосредственные подчиненные определенного руководителя. Если в будущем состав подчиненных этого руководителя изменится, членство в группе скорректируется автоматически.

Правило "Непосредственные подчиненные" создается с помощью следующего синтаксиса:

```
Direct Reports for "{objectID_of_manager}"
```

Вот пример допустимого правила, в котором 62e19b97-8b3d-4d4a-a106-4ce66896a863 является идентификатором объекта руководителя:

```
Direct Reports for "62e19b97-8b3d-4d4a-a106-4ce66896a863"
```

Следующие советы помогут вам правильно использовать правило.

* **Идентификатор менеджера** содержит идентификатор объекта руководителя. Его можно найти в параметрах **профиля** руководителя.
* Чтобы такое правило работало, следует правильно заполнить свойство **Manager ID** для всех пользователей в клиенте. Вы можете проверить текущее значение в **профиле** пользователя.
* Это правило находит только непосредственных подчиненных руководителя. Другими словами, вы не сможете создать группу, включающую прямых подчиненных руководителя *и* их подчиненных.
* Это правило нельзя объединять с любыми другими правилами членства.

### <a name="create-an-all-users-rule"></a>Создание правила "Все пользователи"

С помощью правила членства вы можете создать группу, содержащую всех пользователей в клиенте. Если в будущем пользователи будут добавлены в клиент или удалены из него, членство в группе скорректируется автоматически.

Правило "Все пользователи" создается с помощью одного выражения с оператором -ne и значением null. Это правило добавляет в группу гостевых пользователей B2B, а также пользователей-участников.

```
user.objectid -ne null
```

### <a name="create-an-all-devices-rule"></a>Создание правила "Все устройства"

С помощью правила членства вы можете создать группу, содержащую все устройства в клиенте. Если в будущем устройства будут добавлены в клиент или удалены из него, членство в группе скорректируется автоматически.

Правило "Все устройства" создается с помощью одного выражения с оператором -ne и значением null.

```
device.objectid -ne null
```

### <a name="extension-properties-and-custom-extension-properties"></a>Свойства расширения и пользовательские свойства расширения

В правилах динамического членства поддерживаются атрибуты расширения и пользовательские свойства расширения в виде строковых свойств. Атрибуты расширения синхронизируются из локального каталога Windows Server AD и принимают формат ExtensionAttributeX, где X равно 1–15. Вот пример правила, которое использует в качестве свойства атрибут расширения:

```
(user.extensionAttribute15 -eq "Marketing")
```

Пользовательские свойства расширения синхронизируются из локальной службы Windows Server AD или из подключенного приложения SaaS и имеют формат `user.extension_[GUID]__[Attribute]`, где:

* [GUID] — уникальный идентификатор Azure AD для приложения, которое создало это свойство в Azure AD;
* [Attribute] — имя свойства, с которым оно было создано.

Пример правила, которое использует пользовательское свойство расширения:

```
user.extension_c272a57b722d4eb29bfe327874ae79cb__OfficeNumber -eq "123"
```

Имя пользовательского свойства можно найти в каталоге, запросив свойство пользователя из обозревателя графов и выполнив поиск по имени свойства.

## <a name="rules-for-devices"></a>Правила для устройств

Можно также создать правило, которое выбирает объекты устройств для членства в группе. Членами одной группы не могут являться одновременно пользователи и устройства. Можно использовать следующие атрибуты устройства.

 Атрибут устройства  | Значения | Пример
 ----- | ----- | ----------------
 AccountEnabled | true, false | (device.accountEnabled -eq true)
 displayName | Любое строковое значение |(device.displayName -eq "Rob Iphone”)
 deviceOSType | Любое строковое значение | (device.deviceOSType -eq "iPad") -or (device.deviceOSType -eq "iPhone")
 deviceOSVersion | Любое строковое значение | (device.OSVersion -eq "9.1")
 deviceCategory | Допустимое имя категории устройств. | (device.deviceCategory -eq "BYOD")
 deviceManufacturer | Любое строковое значение | (device.deviceManufacturer -eq "Samsung")
 deviceModel | Любое строковое значение | (device.deviceModel -eq "iPad Air")
 deviceOwnership | Personal, Company, Unknown | (device.deviceOwnership -eq "Company")
 domainName | Любое строковое значение | (device.domainName -eq "contoso.com")
 enrollmentProfileName | Имя профиля регистрации устройства Apple или профиля Windows Autopilot | (device.enrollmentProfileName -eq "DEP iPhones")
 isRooted | true, false | (device.isRooted -eq true)
 managementType | MDM (для мобильных устройств).<br>PC (для компьютеров, управляемых агентом Intune PC). | (device.managementType -eq "MDM")
 organizationalUnit | Любое строковое значение, соответствующее имени подразделения, заданному в локальном каталоге Active Directory. | (device.organizationalUnit -eq "US PCs")
 deviceId | Допустимый идентификатор устройства Azure AD. | (device.deviceId -eq "d4fe7726-5966-431c-b3b8-cddc8fdb717d")
 objectId | Допустимый идентификатор объекта Azure AD. |  (device.objectId -eq 76ad43c9-32c5-45e8-a272-7b58b58f596d")

## <a name="next-steps"></a>Дополнительная информация

В следующих статьях содержатся дополнительные сведения о группах в Azure Active Directory.

* [Просмотр существующих групп](../fundamentals/active-directory-groups-view-azure-portal.md)
* [Создание группы и добавление участников](../fundamentals/active-directory-groups-create-azure-portal.md)
* [Управление параметрами группы](../fundamentals/active-directory-groups-settings-azure-portal.md)
* [Управление членством в группе](../fundamentals/active-directory-groups-membership-azure-portal.md)
* [Управление динамическими правилами для пользователей в группе](groups-dynamic-membership.md)
