---
title: Масштабирование ресурсов отдельной базы данных SQL Azure | Документация Майкрософт
description: В этой статье описано масштабирование вычислительных ресурсов и ресурсов хранилища, предоставляемых отдельной базе данных в Базе данных SQL Azure.
services: sql-database
author: CarlRabeler
manager: craigg
ms.service: sql-database
ms.custom: DBs & servers
ms.topic: conceptual
ms.date: 08/03/2018
ms.author: carlrab
ms.openlocfilehash: 8ddeedcde142a01cca9efa79ab08029aec798ceb
ms.sourcegitcommit: 9819e9782be4a943534829d5b77cf60dea4290a2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2018
ms.locfileid: "39525296"
---
# <a name="scale-single-database-resources-in-azure-sql-database"></a>Масштабирование ресурсов отдельной базы данных в Базе данных SQL Azure

В этой статье описано масштабирование вычислительных ресурсов и ресурсов хранилища, предоставляемых отдельной базе данных в Базе данных SQL Azure. 

## <a name="vcore-based-purchasing-model-change-storage-size"></a>Модель приобретения на основе виртуальных ядер: изменение размера хранилища

- Хранилище может быть расширено до максимально возможного размера с шагом приращения в 1 ГБ. Минимальный настраиваемый размер хранилища данных составляет 5 ГБ. 
- Хранилище для отдельной базы данных можно подготовить, увеличив или уменьшив ее максимальный размер с помощью [портала Azure](https://portal.azure.com), [Transact-SQL](/sql/t-sql/statements/alter-database-transact-sql?r#examples), [PowerShell](/powershell/module/azurerm.sql/set-azurermsqldatabase), [Azure CLI](/cli/azure/sql/db#az_sql_db_update) или [REST API](/rest/api/sql/databases/update).
- База данных SQL автоматически выделяет 30 % доступного места для хранения файлов журнала и 32 ГБ на виртуальное ядро для базы данных tempdb, но при этом их суммарный объем не должен превышать 384 ГБ. База данных tempdb находится на подключенном диске SSD на всех уровнях служб.
- Стоимость хранилища для отдельной базы данных равна суммарному объему хранилища данных и журналов, умноженному на цену единицы хранения для этого уровня служб. Стоимость базы данных tempdb включена в стоимость виртуального ядра. Сведения о цене на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Дополнительные сведения см. в статье об [управлении файловым пространством в Базе данных SQL Azure](sql-database-file-space-management.md).

## <a name="vcore-based-purchasing-model-change-compute-resources"></a>Модель приобретения на основе виртуальных ядер: изменение вычислительных ресурсов

После выбора числа виртуальных ядер отдельную базу данных можно динамически масштабировать в сторону увеличения или уменьшения, исходя из фактического использования, с помощью [портала Azure](sql-database-single-database-scale.md#azure-portal-manage-logical-servers-and-databases), [Transact-SQL](/sql/t-sql/statements/alter-database-azure-sql-database#examples), [PowerShell](/powershell/module/azurerm.sql/set-azurermsqldatabase), [Azure CLI](/cli/azure/sql/db#az_sql_db_update) или [REST API](/rest/api/sql/databases/update). 

При изменении уровня службы или уровня производительности базы данных создается реплика исходной базы данных с новым уровнем производительности, после чего устанавливаются подключения к реплике. Во время этого процесса данные не теряются, но в течение короткого периода, когда производится переподключение к реплике, соединения с базой данных становятся неактивны, поэтому некоторые текущие транзакции могут откатиться. Интервал времени для переключения не фиксирован, но в 99 % случаев он находится в пределах 4 секунд до показателя в 30 секунд. Если в момент разрыва подключений выполняется большое число транзакций, период переключения может быть продолжительнее. 

Длительность всего процесса вертикального масштабирования зависит от размера и уровня службы базы данных до и после изменения. Например, если база данных размером 250 ГБ переводится с уровня службы "Общего назначения", на этот уровень или в его пределах, процесс должен завершиться в течение шести часов. Если уровень производительности базы данных того же размера меняется в пределах уровня служб "Критически важный для бизнеса", то увеличение масштаба должно завершиться в течение трех часов.

> [!TIP]
> Чтобы отслеживать выполняемые операции см. статью [Operations — List](/rest/api/sql/Operations/List) (Список операций), [az sql db op](/cli/azure/sql/db/op), [sys.dm_operation_status (Azure SQL Database)](/sql/relational-databases/system-dynamic-management-views/sys-dm-operation-status-azure-sql-database) (sys.dm_operation_status (база данных SQL Azure)) и эти две команды PowerShell: [Get-AzureRmSqlDatabaseActivity](/powershell/module/azurerm.sql/get-azurermsqldatabaseactivity) и [Stop-AzureRmSqlDatabaseActivity](/powershell/module/azurerm.sql/stop-azurermsqldatabaseactivity).

* При переходе к более высокому уровню служб или производительности максимальный размер базы данных не увеличивается, если явно не указать для него большее значение (maxsize).
* При понижении уровня базы данных используемое ею пространство не должно превышать максимальный допустимый размер целевых уровня служб и уровня производительности. 
* Если вы повышаете уровень базы данных с включенной [георепликацией](sql-database-geo-replication-portal.md), перед повышением уровня базы данных-источника сначала обновите базы данных-получатели до требуемого уровня производительности (общая рекомендация для оптимальной производительности). Чтобы выполнить обновление до другого выпуска, сначала необходимо обновить базу данных-получатель.
* Если вы понижаете уровень базы данных с включенной [георепликацией](sql-database-geo-replication-portal.md), перед понижением уровня базы данных-получателя сначала понизьте категорию ее базы данных-источника до требуемого уровня производительности (общая рекомендация для оптимальной производительности). Чтобы понизить уровень до другого выпуска, сначала необходимо понизить уровень базы данных-получателя.
* Новые свойства базы данных не применяются до тех пор, пока изменение не завершится.

## <a name="dtu-based-purchasing-model-change-storage-size"></a>Модель приобретения на основе единиц DTU: изменение размера хранилища

- Цена DTU для отдельной базы данных включает в себя определенный объем хранилища, не требующий дополнительной платы. Дополнительный объем хранилища, сверх включенного, можно подготовить за дополнительную плату в пределах максимального допустимого размера с шагом в 250 ГБ при объеме хранилища до 1 ТБ и с шагом в 256 ГБ — при объеме более 1 ТБ. Сведения о включенном объеме хранилища и ограничениях максимального размера см. в разделе [Отдельная база данных: размеры хранилища и уровни производительности](#single-database-storage-sizes-and-performance-levels).
- Дополнительное хранилище для отдельной базы данных можно подготовить, увеличив ее максимальный размер с помощью портала Azure, [Transact-SQL](/sql/t-sql/statements/alter-database-azure-sql-database#examples), [PowerShell](/powershell/module/azurerm.sql/set-azurermsqldatabase), [Azure CLI](/cli/azure/sql/db#az_sql_db_update) или [REST API](/rest/api/sql/databases/update).
- Стоимость дополнительного хранилища для отдельной базы данных равна его объему, умноженному на цену единицы хранения этого хранилища для уровня служб. Сведения о цене на дополнительное хранилище см. на [странице цен на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/).

> [!IMPORTANT]
> Иногда требуется сжать базу данных, чтобы освободить неиспользуемое пространство. Дополнительные сведения см. в статье об [управлении файловым пространством в Базе данных SQL Azure](sql-database-file-space-management.md).

## <a name="dtu-based-purchasing-model-change-compute-resources-dtus"></a>Модель приобретения на основе DTU: изменение вычислительных ресурсов (DTU)

После выбора первоначального уровня служб, уровня производительности и объема хранилища можно масштабировать отдельную базу данных динамически, исходя из ее фактического использования, с помощью портала Azure, [Transact-SQL](/sql/t-sql/statements/alter-database-azure-sql-database#examples), [PowerShell](/powershell/module/azurerm.sql/set-azurermsqldatabase), [Azure CLI](/cli/azure/sql/db#az_sql_db_update) или [REST API](/rest/api/sql/databases/update). 

В следующем видео показано динамическое изменение уровня производительности для увеличения количества доступных DTU для отдельной базы данных.

> [!VIDEO https://channel9.msdn.com/Blogs/Azure/Azure-SQL-Database-dynamically-scale-up-or-scale-down/player]
>

При изменении уровня службы или уровня производительности базы данных создается реплика исходной базы данных с новым уровнем производительности, после чего устанавливаются подключения к реплике. Во время этого процесса данные не теряются, но в течение короткого периода, когда производится переподключение к реплике, соединения с базой данных становятся неактивны, поэтому некоторые текущие транзакции могут откатиться. Интервал времени для переключения не фиксирован, но в 99 % случаев он находится в пределах 30 секунд. Если в момент разрыва подключений выполняется большое число транзакций, период переключения может быть продолжительнее. 

Длительность всего процесса вертикального масштабирования зависит от размера и уровня службы базы данных до и после изменения. Например, если база данных размером 250 ГБ переводится с уровня службы "Стандартный", на этот уровень или в его пределах, процесс должен завершиться в течение шести часов. Если уровень производительности базы данных того же размера меняется в пределах уровня службы "Премиум", то увеличение масштаба должно завершиться в течение трех часов.

> [!TIP]
> Чтобы отслеживать выполняемые операции см. статью [Operations — List](/rest/api/sql/Operations/List) (Список операций), [az sql db op](/cli/azure/sql/db/op), [sys.dm_operation_status (Azure SQL Database)](/sql/relational-databases/system-dynamic-management-views/sys-dm-operation-status-azure-sql-database) (sys.dm_operation_status (база данных SQL Azure)) и эти две команды PowerShell: [Get-AzureRmSqlDatabaseActivity](/powershell/module/azurerm.sql/get-azurermsqldatabaseactivity) и [Stop-AzureRmSqlDatabaseActivity](/powershell/module/azurerm.sql/stop-azurermsqldatabaseactivity).

* При переходе к более высокому уровню служб или производительности максимальный размер базы данных не увеличивается, если явно не указать для него большее значение (maxsize).
* При понижении уровня базы данных используемое ею пространство не должно превышать максимальный допустимый размер целевых уровня служб и уровня производительности. 
* При понижении уровня **Премиум** до уровня **Стандартный** дополнительная плата взимается, если максимальный размер базы данных поддерживается в целевом уровне производительности и превышает объем включенного хранилища целевого уровня производительности. Например, если уровень базы данных P1 с максимальным размером в 500 ГБ понижается до уровня S3, то взимается плата за дополнительное хранилище, так как S3 поддерживает максимальный размер в 500 ГБ, а его включенный объем хранилища составляет только 250 ГБ. Поэтому дополнительный объем хранилища равен 500 – 250 = 250 ГБ. Чтобы узнать о ценах на дополнительное хранилище, ознакомьтесь с [ценами на Базу данных SQL](https://azure.microsoft.com/pricing/details/sql-database/). Если фактический объем пространства, которое используется, меньше, чем включенный объем хранилища, то этих дополнительных затрат можно избежать, уменьшив максимальный размер базы данных до включенного объема. 
* Если вы повышаете уровень базы данных с включенной [георепликацией](sql-database-geo-replication-portal.md), перед повышением уровня базы данных-источника сначала обновите базы данных-получатели до требуемого уровня производительности (общая рекомендация для оптимальной производительности). Чтобы выполнить обновление до другого выпуска, сначала необходимо обновить базу данных-получатель.
* Если вы понижаете уровень базы данных с включенной [георепликацией](sql-database-geo-replication-portal.md), перед понижением уровня базы данных-получателя сначала понизьте категорию ее базы данных-источника до требуемого уровня производительности (общая рекомендация для оптимальной производительности). Чтобы понизить уровень до другого выпуска, сначала необходимо понизить уровень базы данных-получателя.
* Предложения службы восстановления отличаются для разных уровней служб. При понижении до уровня **Базовый** уменьшится период удержания резервной копии. Прочитайте раздел [Подробнее об автоматически создаваемых резервных копиях в Базе данных SQL](sql-database-automated-backups.md).
* Новые свойства базы данных не применяются до тех пор, пока изменение не завершится.

## <a name="dtu-based-purchasing-model-limitations-of-p11-and-p15-when-the-maximum-size-greater-than-1-tb"></a>Модель приобретения на основе DTU: ограничения P11 и P15 при максимальном размере, превышающем 1 ТБ

Максимальный размер больше 1 ТБ, для базы данных P11 и P15 поддерживается в следующих регионах: US Gov (Вирджиния), Восточная Австралия, Восточная Канада, восточная часть США 2, Восточная Япония, Западная Европа, западная часть Соединенного Королевства, западная часть США, Западная Япония, Республика Корея (центральный регион), Северная Европа, центрально-северная часть США, Центральная Германия, Центральная Канада, Центральная Франция, центральная часть США, Юго-Восточная Австралия, Юго-Восточная Азия, центрально-южная часть США, Южная Бразилия и южная часть Соединенного Королевства. Ниже приведены рекомендации и ограничения для баз данных P11 и P15 с максимальным размером, превышающим 1 ТБ.

- Если при создании базы данных выбрать максимальный размер больше 1 ТБ (указав значение 4 ТБ или 4096 ГБ), то выполнение команды create завершится ошибкой, если база данных подготавливается в неподдерживаемом регионе.
- Для существующих баз данных P11 или P15, расположенных в одном из поддерживаемых регионов, можно увеличить максимальный размер хранилища до 4 ТБ с шагом в 256 ГБ. Чтобы узнать, поддерживается ли в вашем регионе больший размер, используйте функцию [DATABASEPROPERTYEX](/sql/t-sql/functions/databasepropertyex-transact-sql) или проверьте размер базы данных на портале Azure. Обновление существующей базы данных P11 или P15 может выполнить только учетная запись субъекта уровня сервера или участники роли базы данных dbmanager. 
- При выполнении операции в поддерживаемом регионе конфигурация будет обновлена немедленно. Во время обновления база данных остается подключенной к сети. Тем не менее вы не сможете использовать весь объем хранилища больше 1 ТБ, пока файлы базы данных не будут обновлены до нового максимального размера. Требуемая продолжительность зависит от размера обновляемой базы данных. 
- При создании или обновлении базы данных P11 или P15 можно выбрать максимальный размер хранилища только в пределах 1–4 ТБ с шагом в 256 ГБ. При создании базы данных уровня производительности P11 или P15 уже выбран размер хранилища по умолчанию — 1 ТБ. Для баз данных, расположенных в одном из поддерживаемых регионов, можно увеличить максимальный размер хранилища до 4 ТБ для новой или существующей отдельной базы данных. Для всех других регионов максимальный размер не может превышать 1 ТБ. При выборе хранилища объемом в 4 ТБ цена не меняется.
- Если максимальный размер базы данных имеет значение больше 1 ТБ, то его нельзя изменить на 1 ТБ, даже если для базы данных фактически используется меньше 1 ТБ. Таким образом невозможно понизить базу данных уровня P11 или P15 с максимальным размером более 1 ТБ до базы данных с максимальным размером в 1 ТБ уровня P11 или P15 либо более низкого уровня производительности, например P1–P6. Это ограничение также применяется в сценариях восстановления и копирования, включая восстановление до точки во времени, геовосстановление, долгосрочное хранение резервных копий и копирование базы данных. После настройки максимального размера базы данных больше 1 ТБ все операции восстановления этой базы данных должны выполняться на уровне P11 или P15 с максимальным размером больше 1 ТБ.
- Для сценариев активной георепликации:
   - Настройка отношения георепликации. Если используется база данных-источник P11 или P15, уровень баз данных-получателей также должен быть P11 или P15. Базы данных более низкого уровня производительности отклоняются, так как они не поддерживают максимальный размер больше 1 ТБ.
   - Обновление базы данных-источника в отношениях георепликации. При изменении максимального размера и указании значения больше 1 ТБ в базе данных-источнике такие же изменения произойдут в базе данных-получателе. Чтобы изменения в базе данных-источнике вступили в силу, оба обновления должны быть успешными. При этом применяются ограничения по регионам для максимального размера больше 1 ТБ. Если база данных-получатель находится в регионе, не поддерживающем максимальный размер больше 1 TB, то база данных-источник не обновляется.
- Использование службы импорта и экспорта для загрузки баз данных P11 и P15 с максимальным размером больше 1 ТБ не поддерживается. Для [импорта](sql-database-import.md) и [экспорта](sql-database-export.md) данных используйте файл SqlPackage.exe.


## <a name="next-steps"></a>Дополнительная информация

Сведения об общих ограничениях ресурсов см. в статьях [Ограничения ресурсов для отдельной базы данных в Базе данных SQL Azure при использовании модели приобретения на основе виртуальных ядер (предварительная версия)](sql-database-vcore-resource-limits-single-databases.md) и [SQL Database DTU-based resource limits - elastic pools](sql-database-dtu-resource-limits-single-databases.md) (Ограничения ресурсов для эластичных пулов в Базе данных SQL при использовании модели приобретения на основе единиц DTU).
