---
title: Сетевая архитектура SAP HANA в Azure (крупные экземпляры) | Документация Майкрософт
description: Сетевая архитектура развертывания SAP HANA в Azure (крупные экземпляры).
services: virtual-machines-linux
documentationcenter: ''
author: RicksterCDN
manager: jeconnoc
editor: ''
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 09/04/2018
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 1262ed841fe8f6f9c2d5339d79abf06c1ab15a25
ms.sourcegitcommit: d1aef670b97061507dc1343450211a2042b01641
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2018
ms.locfileid: "47392879"
---
# <a name="sap-hana-large-instances-network-architecture"></a>Сетевая архитектура SAP HANA в Azure (крупные экземпляры)

Архитектура сетевых служб Azure является ключевым компонентом для успешного развертывания приложений SAP в крупных экземплярах HANA. Как правило, развернутое решение "SAP HANA в Azure (крупные экземпляры)" отличается большим ландшафтом SAP, который включает в себя несколько разных решений SAP с различными размерами баз данных, а также показателями потребления ресурсов ЦП и памяти. Скорее всего, не все из этих систем SAP основаны на SAP HANA. Ваш ландшафт SAP, вероятно, будет гибридным, и в нем будут использоваться следующие системы.

- Системы SAP, развернутые локально. Из-за размеров эти системы в настоящее время не могут размещаться в Azure. Классический пример — рабочая система SAP ERP, выполняемая в Microsoft SQL Server (как база данных), для которой требуется больше ресурсов ЦП и памяти, чем могут предоставить виртуальные машины.
- Системы SAP на основе SAP HANA, развернутые локально.
- Системы SAP, развернутые на виртуальных машинах. Это могут быть экземпляры разработки, тестирования, песочницы или рабочие экземпляры для всех приложений на основе SAP NetWeaver, которые можно развернуть в Azure (на виртуальных машинах) с учетом требований к ресурсам и памяти. Эти системы могут быть созданы на основе баз данных, например SQL Server. Дополнительные сведения см. в [примечании SAP № 1928533 о поддерживаемых продуктах и типах виртуальных машин Azure для приложений SAP в Azure](https://launchpad.support.sap.com/#/notes/1928533/E). Эти системы могут быть созданы на основе баз данных, например SAP HANA. Дополнительные сведения см. на странице [сертифицированных платформ IaaS SAP HANA](http://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html).
- Серверы приложений SAP, развернутые в Azure (на виртуальных машинах), которые используют SAP HANA в Azure (крупные экземпляры) в стеках крупных экземпляров Azure.

Хотя гибридный ландшафт SAP (с четырьмя или более разными сценариями развертывания) — обычное явление. Зачастую в Azure может быть развернут полный ландшафт SAP. По мере увеличения производительности виртуальных машин число решений SAP, развертываемых в Azure, будет расти.

Сети Azure в контексте систем SAP, развернутых в Azure, не сложные. Это связано со следующими аспектами.

- Виртуальные сети должны быть подключены к каналу Azure ExpressRoute, который подключается к локальной сети.
- Канал ExpressRoute для подключения локальной среды к Azure обычно должен иметь пропускную способность 1 Гбит/с или выше. Это позволяет обеспечить достаточную пропускную способность для передачи данных между локальными системами и системами, запущенными на виртуальных машинах, а также подключение к системам Azure из локальной среды конечных пользователей.
- Для взаимодействия друг с другом все системы SAP в Azure должны быть настроены в виртуальных сетях.
- Службы Active Directory и DNS, размещенные локально, можно использовать в Azure через локальный ExpressRoute.


> [!NOTE] 
> С точки зрения выставления счетов одну подписку Azure можно привязать только к одному клиенту в стеке крупных экземпляров в определенном регионе Azure. И наоборот, клиент в стеке крупных экземпляров можно связать только с одной подпиской Azure. Этот факт не отличается от любых других объектов в Azure, которые подлежат оплате.

Развертывание SAP HANA в Azure (крупные экземпляры) в нескольких разных регионах Azure приведет к тому, что другой клиент будет развернут в стеке крупных экземпляров. Оба клиента могут выполняться в одной подписке Azure, если эти экземпляры являются частью одного ландшафта SAP. 

> [!IMPORTANT] 
> Для SAP HANA в Azure (крупные экземпляры) поддерживается только модель развертывания Azure Resource Manager.

 

## <a name="additional-virtual-network-information"></a>Дополнительные сведения о виртуальной сети

Чтобы подключить виртуальную сеть Azure к ExpressRoute, необходимо создать шлюз Azure. Дополнительные сведения см. в статье [Сведения о шлюзах виртуальных сетей ExpressRoute](../../../expressroute/expressroute-about-virtual-network-gateways.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

Шлюз Azure можно использовать для подключения ExpressRoute к инфраструктуре за пределами Azure или к стеку крупных экземпляров Azure. Его также можно использовать для установки подключения между виртуальными сетями. Дополнительные сведения см. в статье [Настройка подключения VPN-шлюза между виртуальными сетями с помощью PowerShell](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Шлюз Azure можно подключить максимум к четырем разным соединениям ExpressRoute при условии, что они поступают из различных конечных маршрутизаторов MSEE. Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

> [!NOTE] 
> В обоих случаях шлюз Azure обеспечивает разную пропускную способность. Дополнительные сведения см. в статье [Основные сведения о VPN-шлюзах Azure](../../../vpn-gateway/vpn-gateway-about-vpngateways.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Максимальная пропускная способность, которой можно достичь с использованием шлюза виртуальной сети, — 10 Гбит/с при подключении ExpressRoute. При копировании файлов между виртуальной машиной, расположенной в виртуальной сети, и локальной системой (в рамках одного потока копирования) невозможно достичь полной пропускной способности шлюза с разными номерами SKU. Чтобы получить максимальную пропускную способность шлюза виртуальной сети, нужно использовать несколько потоков. Также можно копировать разные файлы с помощью параллельных потоков одного файла.


## <a name="networking-architecture-for-hana-large-instance"></a>Архитектура сети для крупных экземпляров HANA
Архитектуру сети для крупных экземпляров HANA можно разделить на четыре части:

- Локальная сеть и подключение ExpressRoute к Azure. Эта часть является доменом пользователей и подключается к Azure через ExpressRoute. См. правый нижний угол на схеме ниже.
- Сетевые службы Azure, описанные выше, состоят из виртуальных сетей со шлюзами. В этой области необходимо определить подходящую структуру в соответствии с требованиями приложений, безопасности и нормативных требований. При использовании крупных экземпляров HANA также необходимо выбрать число виртуальных сетей и SKU шлюзов Azure. См. правый верхний угол на схеме.
- Подключение крупных экземпляров HANA к Azure с помощью технологии ExpressRoute. Эту часть развертывает и обслуживает корпорация Майкрософт. Вам достаточно предоставить диапазоны IP-адресов и после развертывания ресурсов в крупных экземплярах HANA подключить канал ExpressRoute к виртуальным сетям. Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 
- Сетевое взаимодействие в крупных экземплярах HANA, которое в основном прозрачно для вас.

![Виртуальная сеть подключена к SAP HANA в Azure (крупные экземпляры) и к локальной сети](./media/hana-overview-architecture/image3-on-premises-infrastructure.png)

Использование крупных экземпляров HANA не отменяет требование подключать локальные ресурсы к Azure через ExpressRoute. Также требуется иметь одну или несколько виртуальных сетей с виртуальными машинами, на которых размещен уровень приложений, который подключается к экземплярам HANA, размещенным в единицах крупных экземпляров HANA. 

Отличия развертываний SAP только в Azure заключаются в следующем:

- Единицы крупных экземпляров HANA пользовательского клиента соединены через другой канал ExpressRoute с виртуальными сетями. Для разделения условий нагрузки локальные подключения ExpressRoute к виртуальным сетям и подключения между виртуальными сетями и крупными экземплярами HANA не могут совместно использовать те же маршрутизаторы.
- Профиль рабочей нагрузки между уровнем приложений SAP и крупным экземпляром HANA является другой причиной возникновения множества небольших запросов и пиков передачи данных (результирующие наборы) между SAP HANA и уровнем приложений.
- Архитектура приложения SAP более чувствительна к задержкам в сети, чем в типичных сценариях, где обмен данными происходит между локальной средой и Azure.
- Шлюз виртуальной сети имеет по крайней мере два подключения ExpressRoute. Они будут обеспечивать максимальную пропускную способность для входящих данных шлюза виртуальной сети.

Сетевая задержка между виртуальными машинами и единицами крупных экземпляров HANA может быть выше, чем обычная задержка приема-передачи между виртуальными машинами. В зависимости от региона Azure значения задержки приема-передачи могут превышать 0,7 мс. Такие значения классифицируются как значения ниже среднего в [примечании к SAP № 1100926 с часто задаваемыми вопросами к производительности сети](https://launchpad.support.sap.com/#/notes/1100926/E). Измеренная задержка может достигать до 2 миллисекунд. Этот показатель зависит от региона Azure и средства измерения задержки приема-передачи в сети между виртуальной машиной Azure и единицей крупного экземпляра HANA. Тем не менее клиенты успешно развертывают производственные приложения SAP на основе SAP HANA в крупных экземплярах SAP HANA. Следует тщательно протестировать бизнес-процессы в крупных экземплярах HANA в Azure.
 
Чтобы обеспечить детерминированную сетевую задержку между виртуальными машинами и крупными экземплярами HANA, важно выбрать правильный номер SKU шлюза виртуальной сети. В отличие от шаблонов трафика между локальными и виртуальными машинами, шаблон трафика между виртуальными машинами и крупными экземплярами HANA может показывать короткий, но высокий пик запросов и объемов передаваемых данных. Для нормальной обработки таких пиков рекомендуется использовать шлюз с номером SKU UltraPerformance. Для номеров SKU крупных экземпляров HANA 2 класса использование номера SKU шлюза UltraPerformance в качестве шлюза виртуальной сети является обязательным.

> [!IMPORTANT] 
> Учитывая общий сетевой трафик между уровнями базы данных и приложений SAP, для подключения виртуальных сетей к SAP HANA в Azure (крупные экземпляры) поддерживается только шлюз с номером SKU HighPerformance или UltraPerformance. Для номеров SKU крупных экземпляров HANA 2 класса в качестве шлюза виртуальной сети поддерживается только шлюз UltraPerformance.



## <a name="single-sap-system"></a>Одна система SAP

Локальная инфраструктура, показанная выше, подключена к Azure через канал ExpressRoute. Канал ExpressRoute, в свою очередь, подключен к конечному маршрутизатору Microsoft Enterprise. Дополнительные сведения см. в статье [Обзор ExpressRoute](../../../expressroute/expressroute-introduction.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). После установки этот маршрут подключается к магистральной сети Azure, и все регионы Azure становятся доступными.

> [!NOTE] 
> Для работы с ландшафтом SAP в Azure выполните подключение к маршрутизатору MSEE, который расположен ближе других к региону Azure в пределах ландшафта SAP. Стеки крупных экземпляров Azure подключаются с помощью специальных устройств MSEE для минимизации сетевой задержки между виртуальными машинами в Azure IaaS и стеками крупных экземпляров.

Шлюз виртуальной сети для виртуальных машин, где размещены экземпляры приложений SAP, подключен к этому каналу ExpressRoute. Та же виртуальная сеть подключена к отдельному маршрутизатору MSEE, предназначенному для подключения к стекам крупных экземпляров.

Это простой пример отдельной системы SAP. В ней уровень приложений SAP размещен в Azure. База данных SAP HANA выполняется в SAP HANA в Azure (крупные экземпляры). Предполагается, что пропускная способность шлюза виртуальной сети 2 Гбит/с или 10 Гбит/с не подразумевает узкое место производительности.

## <a name="multiple-sap-systems-or-large-sap-systems"></a>Несколько обычных или крупных систем SAP

Если несколько обычных или крупных систем SAP подключены к SAP HANA в Azure (крупные экземпляры), целесообразно предположить, что пропускная способность шлюза виртуальной сети может стать узким местом. В этом случае необходимо разбить уровни приложений на несколько виртуальных сетей. Также рекомендуется создать специальные виртуальные сети, которые подключаются к крупным экземплярам HANA в таких случаях:

- Выполнение архивации непосредственно из экземпляров HANA в крупных экземплярах HANA на виртуальную машину в Azure, где размещаются общие ресурсы NFS.
- Копирование больших резервных копий и других файлов из крупных экземпляров HANA на диск, управляемый в Azure.

Используйте отдельную виртуальную сеть для размещения виртуальных машин, управляющих хранилищем. В таком случае передача крупных файлов или большого объема данных из крупных экземпляров HANA в Azure на шлюзе виртуальной сети, обслуживающем виртуальные машины, на которых выполняется уровень приложений SAP, никак не повлияет на работу. 

Для более масштабируемой сетевой архитектуры:

- Используйте несколько виртуальных сетей для одного большего уровня приложений SAP.
- Вместо объединения систем SAP из разных подсетей в одну виртуальную сеть разверните отдельную виртуальную сеть для каждой развернутой системы SAP.

 Более масштабируемая сетевая архитектура для SAP HANA в Azure (крупные экземпляры):

![Развертывание уровня приложений SAP в нескольких виртуальных сетях](./media/hana-overview-architecture/image4-networking-architecture.png)

На рисунке выше показана конфигурация, в которой уровень приложений SAP или его компоненты развернуты в нескольких виртуальных сетях. Такая конфигурация неизбежно вызовет дополнительные задержки, возникающие во время обмена данными между приложениями, размещенными в разных виртуальных сетях. По умолчанию трафик между виртуальными машинами, расположенными в разных виртуальных сетях, проходит через маршрутизаторы MSEE. Чтобы повысить эффективность и сократить задержки в взаимодействии между двумя виртуальными сетями, следует сделать их одноранговыми виртуальными сетями в одном регионе. Этот метод работает, даже если эти виртуальные сети относятся к разным подпискам. Пиринг виртуальных сетей позволяет виртуальным машинам в двух разных виртуальных сетях напрямую взаимодействовать друг с другом через магистральную сеть. В этом случае задержка будет такая же, как если бы эти виртуальные машины находились в одной виртуальной сети. Если же взаимодействие выполняется между диапазонами IP-адресов, соединенными через шлюз виртуальной сети Azure, весь трафик направляется через этот конкретный шлюз виртуальной сети. 

Дополнительные сведения о пиринге виртуальных сетей см. в [этой статье](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview).


## <a name="routing-in-azure"></a>Маршрутизация в Azure

Существует три важные рекомендации относительно сетевой маршрутизации для SAP HANA в Azure (крупные экземпляры).

* К SAP HANA в Azure (крупные экземпляры) могут получать доступ только виртуальные машины через выделенное подключение ExpressRoute (нельзя получить доступ напрямую из локальной среды). Прямой доступ из локальной среды к единицам крупных экземпляров HANA, поставляемым корпорацией Майкрософт, сразу невозможен. Это ограничения переходной маршрутизации текущей архитектуры сети Azure, используемой для крупных экземпляров SAP HANA. Таким образом, клиенты администрирования и любые приложения, требующие прямого доступа, например запущенный локально SAP Solution Manager, не могут подключиться к базе данных SAP HANA.

* Если модули HANA (крупные экземпляры) развернуты в двух разных регионах Azure с целью аварийного восстановления, применяются те же ограничения на переходные маршруты. Другими словами, IP-адреса модуля HANA (крупные экземпляры) в одном регионе (например, западная часть США) не будут направляться в модуль HANA (крупные экземпляры), развернутый в другом регионе (например, восточная часть США). Это не зависит от использования пиринга сетей Azure по регионам или перекрестных соединений каналов ExpressRoute, по которым модули HANA (крупные экземпляры) подключаются к виртуальным сетям. См. рисунок в разделе "Использование единиц крупных экземпляров HANA в нескольких регионах". Из-за такого ограничения развернутой архитектуры невозможно немедленно использовать функцию репликации системы HANA как функцию аварийного восстановления.

* Единицам SAP HANA в Azure (крупные экземпляры) назначается IP-адрес из диапазона IP-адресов пула серверов, указанного вами. Дополнительные сведения см. в статье [Инфраструктура и возможности подключения SAP HANA в Azure (крупные экземпляры)](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). Доступ к этому IP-адресу можно получить с помощью подписки Azure и канала ExpressRoute, по которому виртуальные сети подключаются к HANA в Azure (крупные экземпляры). IP-адрес, назначенный из этого диапазона IP-адресов пула серверов, напрямую присваивается аппаратной единице. NAT больше *не* используется, как это имело место в первых развертываниях этого решения. 

> [!NOTE] 
> Чтобы преодолеть ограничения переходной маршрутизации, как описано выше в двух первых пунктах списка, необходимо использовать дополнительные компоненты для маршрутизации. Такими компонентами могут быть:

> * Обратный прокси-сервер для маршрутизации входных и выходных данных. Например, F5 BIG-IP, NGINX с диспетчером трафика, развернутый в Azure как решение для маршрутизации трафика и реализации виртуального брандмауэра.
> * Используйте [правила IPTables](http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_%3a_Ch14_%3a_Linux_Firewalls_Using_iptables#.Wkv6tI3rtaQ) на виртуальной машине Linux для маршрутизации между локальным расположением и единицами HANA (крупные экземпляры) или между единицами HANA (крупные экземпляры) в разных регионах.

> Имейте в виду, что внедрение и поддержка пользовательских решений с использованием сетевых устройств сторонних производителей или утилиты IPTables не предоставляется корпорацией Майкрософт. Поддержка должна предоставляться поставщиком используемого компонента или интегратором. 

## <a name="internet-connectivity-of-hana-large-instance"></a>Подключение крупных экземпляров HANA к Интернету
Крупные экземпляры HANA *не* подключены к Интернету напрямую. Это ограничивает ваши возможности, например зарегистрировать образ ОС напрямую с использованием поставщика ОС. Вам может потребоваться поработать с локальным сервером средства для управления подписками SUSE Linux Enterprise Server или Red Hat Enterprise Linux Subscription Manager.

## <a name="data-encryption-between-vms-and-hana-large-instance"></a>Шифрование данных между виртуальными машинами и крупными экземплярами HANA
Данные, передаваемые между виртуальными машинами и крупными экземплярами HANA, не шифруются. Однако исключительно для обмена между СУБД HANA и приложениями на основе JDBC/ODBC вы можете включить шифрование трафика. Дополнительные сведения см. в этой [документации по SAP](http://help-legacy.sap.com/saphelp_hanaplatform/helpdata/en/db/d3d887bb571014bf05ca887f897b99/content.htm?frameset=/en/dd/a2ae94bb571014a48fc3b22f8e919e/frameset.htm&current_toc=/en/de/ec02ebbb57101483bdf3194c301d2e/plain.htm&node_id=20&show_children=false).

## <a name="use-hana-large-instance-units-in-multiple-regions"></a>Использование единиц крупных экземпляров HANA в нескольких регионах

У вас могут быть другие причины для развертывания SAP HANA в Azure (крупные экземпляры) в нескольких регионах Azure помимо аварийного восстановления. Возможно, вам необходимо получить доступ к крупным экземплярам HANA из каждой виртуальной машины, развернутой в разных виртуальных сетях в регионах. IP-адреса, назначенные разным единицам крупных экземпляров HANA, не распространяются за пределы виртуальных сетей, которые напрямую подключены к экземплярам через шлюз. В результате в структуру виртуальной сети внесено некоторое изменение. Шлюз виртуальной сети может обрабатывать четыре различных канала ExpressRoute из разных маршрутизаторов MSEE. Каждая виртуальная сеть, подключенная к одному из стеков крупных экземпляров, может быть подключена к стеку крупных экземпляров в другом регионе Azure.

![Виртуальные сети, подключенные к стекам крупных экземпляров Azure в разных регионах Azure](./media/hana-overview-architecture/image8-multiple-regions.png)

На рисунке показано, как разные виртуальные сети в обоих регионах подключены к двум разным каналам ExpressRoute, используемым для подключения к SAP HANA в Azure (крупные экземпляры) в обоих регионах Azure. Новые подключения представлены прямоугольными красными линиями. При такой схеме подключений из виртуальных сетей виртуальные машины, работающие в одной из этих виртуальных сетей, могут получать доступ к каждому из разных единиц крупных экземпляров HANA, развернутых в двух регионах. Как видно на рисунке выше, предполагается, что имеется два подключения ExpressRoute между локальной системой и двумя регионами Azure. Это рекомендуется в целях аварийного восстановления.

> [!IMPORTANT] 
> Если используется несколько каналов ExpressRoute, чтобы обеспечить правильную маршрутизацию трафика, следует использовать атрибут AS PATH и настройки локального предпочтения BGP.

**Дальнейшие действия**
- Дополнительные сведения см. в статье [Архитектура хранилища SAP HANA (крупные экземпляры)](hana-storage-architecture.md).