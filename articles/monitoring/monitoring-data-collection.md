---
title: Данные мониторинга, собираемые службой Azure Monitor | Microsoft Docs
description: Данные мониторинга, которые собирает Azure Monitor, делятся на метрики и журналы. Метрики занимают малый объем, их можно использовать в сценариях, предусматривающих работу в режиме практически реального времени. Журналы хранятся в службе Log Analytics для расширенного анализа.
documentationcenter: ''
author: bwren
manager: carmonm
editor: tysonn
ms.service: monitoring
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/27/2018
ms.author: bwren
ms.openlocfilehash: 19a611ca88310f06503bea2b8606699fe3e1c709
ms.sourcegitcommit: b7e5bbbabc21df9fe93b4c18cc825920a0ab6fab
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2018
ms.locfileid: "47406046"
---
# <a name="monitoring-data-collected-by-azure-monitor"></a>Данные мониторинга, собираемые службой Azure Monitor
[Azure Monitor](../azure-monitor/overview.md) — это служба, которая позволяет отслеживать приложения и ресурсы, используемые этими приложениями. Основное назначение этой функции — хранение данных телеметрии и других данных, получаемых из отслеживаемых ресурсов. В этой статье подробно описано, как служба Azure Monitor хранит и использует эти данные.

Все данные, собираемые службой Azure Monitor, соответствуют одному из двух основных типов, то есть представляют собой [метрики](#metrics) или [журналы](#logs). Метрики — это числовые значения, которые описывают конкретный аспект системы в определенный момент времени. Они занимают небольшой объем, и их можно использовать в сценариях, предусматривающих работу в режиме практически реального времени. Журналы содержат различные типы данных, упорядоченных в записи с разными наборами свойств для каждого типа. Помимо данных производительности в системе (в виде журналов) хранятся данные телеметрии, например события и трассировки, так что можно объединить все эти данные для анализа.

![Общие сведения о службе Azure Monitor](../azure-monitor/media/overview/overview.png)

## <a name="metrics"></a>Метрики
Метрики — это числовые значения, которые описывают конкретный аспект системы в определенный момент времени. Они занимают небольшой объем, и их можно использовать в сценариях, предусматривающих работу в режиме практически реального времени. Метрики собираются через регулярные промежутки времени независимо от того, изменяется ли значение. Метрики удобно использовать для создания оповещений, так можно часто делать их выборку и быстро создавать оповещения с использованием относительно простой логики. 

Например, вы можете собирать данные об использовании процессоров с виртуальной машины каждую минуту или данные о количестве пользователей, зарегистрированных в вашем приложении, каждые 10 минут. Вы можете активировать оповещение, когда одно из этих полученных значений либо даже разница между двумя значениями превосходит заданное пороговое значение.

Ниже перечислены некоторые атрибуты метрик в Azure.

* Сбор выполняется с частотой раз в минуту, если иное не указано в определении метрики.
* Для уникальной идентификации метрики используется имя метрики и пространство имен, которое выступает в качестве категории.
* Метрики хранятся 93 дня. Метрики можно скопировать в службу Log Analytics для отслеживания долгосрочных тенденций.

У каждого значения метрики есть следующие свойства:
* время получения значения;
* тип измерения, представляемый значением;
* ресурс, с которым сопоставлено значение;
* само значение.
* Некоторые метрики могут иметь несколько измерений, как будет рассказано в следующем разделе. Пользовательские метрики могут иметь до 10 измерений.

### <a name="multi-dimensional-metrics"></a>Многомерные метрики
Измерения метрики — это пары имя-значение, которые используются для передачи дополнительных данных с описаниями значения метрики. Например, метрика _Доступное место на диске_ может иметь измерение с названием _Диск_ со значениями _C:_ и _D:_. Это позволяет просматривать сведения о доступном месте на всех дисках или на отдельных дисках. 

В примере ниже показаны два набора данных для гипотетической метрики с названием _Пропускная способность сети_. В первом наборе данных нет измерений. Во втором наборе данных показаны значения с двумя измерениями, "IP-адрес" и _Направление_:

### <a name="network-throughput"></a>Пропускная способность сети

 |Timestamp        | Значение метрики | 
   | ------------- |:-------------| 
   | 8/9/2017 8:14 | 1331,8 Кбит/с | 
   | 8/9/2017 8:15 | 1141,4 Кбит/с |
   | 8/9/2017 8:16 | 1110,2 Кбит/с |

Такая метрика без измерений поможет найти ответ только на простые вопросы, например о том, какой была пропускная способность в определенный момент времени.

### <a name="network-throughput--two-dimensions-ip-and-direction"></a>Пропускная способность сети и два измерения ("IP-адрес" и "Направление")

| Timestamp          | Измерение "IP-адрес" | Измерение "Направление" | Значение метрики| 
   | ------------- |:-----------------|:------------------- |:-----------|  
   | 8/9/2017 8:14 | IP-адрес — 192.168.5.2 | Направление — отправка    | 646,5 Кбит/с |
   | 8/9/2017 8:14 | IP-адрес — 192.168.5.2 | Направление — получение | 420,1 Кбит/с |
   | 8/9/2017 8:14 | IP-адрес — 10.24.2.15  | Направление — отправка    | 150,0 Кбит/с | 
   | 8/9/2017 8:14 | IP-адрес — 10.24.2.15  | Направление — получение | 115,2 Кбит/с |
   | 8/9/2017 8:15 | IP-адрес — 192.168.5.2 | Направление — отправка    | 515,2 Кбит/с |
   | 8/9/2017 8:15 | IP-адрес — 192.168.5.2 | Направление — получение | 371,1 Кбит/с |
   | 8/9/2017 8:15 | IP-адрес — 10.24.2.15  | Направление — отправка    | 155,0 Кбит/с |
   | 8/9/2017 8:15 | IP-адрес — 10.24.2.15  | Направление — получение | 100,1 Кбит/с |

Эта метрика поможет найти ответ на вопросы о том, какая пропускная способность для каждого IP-адреса и сколько данных было отправлено и получено. Многомерные метрики имеют дополнительные значения аналитики и диагностики в отличие от метрик без измерений.

### <a name="value-of-metrics"></a>Значения метрик
Индивидуальные метрики, как правило, представляют мало полезных сведений. Они предоставляют одно значение без какого-либо контекста, кроме сравнения с простым порогом. Они ценны в сочетании с другими метриками для определения шаблонов и тенденций или в сочетании с журналами, предоставляя контекст для определенных значений. 

Например, исходя из определенного количества пользователей приложения в определенный момент времени можно понять состояние работоспособности приложения. Резкое уменьшение числа пользователей хотя и обозначено несколькими значениями одной и той же метрики, может указывать на проблему. Чрезмерные исключения, вызванные приложением и обозначенные отдельной метрикой, могут указывать на проблему приложения, вызывающую спад в использовании. События, которые приложение создает для выявления сбоев в своих компонентах, могут помочь определить первопричину.

### <a name="sources-of-metric-data"></a>Источники данных метрик
Существует три основных источника метрик, собираемых службой Azure Monitor. Все эти метрики доступны в хранилище метрик, в котором их можно оценивать вместе независимо от их источников.

**Метрики платформы** создаются ресурсами Azure и наглядно отображают работоспособность и производительность этих ресурсов. Каждый тип ресурсов создает [отдельный набор метрик](../monitoring-and-diagnostics/monitoring-supported-metrics.md), который не нужно настраивать. 

**Метрики приложений** создаются службой Application Insights для отслеживаемых приложений и помогают обнаруживать проблемы производительности и отслеживать тенденции использования приложений. Сюда входит ряд значений, в том числе значения _Время отклика сервера_ и _Исключения браузера_.

**Пользовательские метрики** — это метрики, которые вы определяете в дополнение к стандартной метрике, которая доступна автоматически. Пользовательские метрики необходимо создавать для одного ресурса в той же области, в которой находится этот ресурс. Вы можете создавать пользовательские метрики указанными ниже способами.
    - [Определять пользовательские метрики в своих приложениях](../application-insights/app-insights-api-custom-events-metrics.md), отслеживаемых службой Application Insights. Эти метрики — дополнение к стандартному набору метрик приложения.
    - Публиковать пользовательские метрики из виртуальных машин с ОС Windows, используя средство [Windows Diagnostic Extension (WAD)](../monitoring-and-diagnostics/azure-diagnostics.md).
    - Публиковать пользовательские метрики из виртуальных машин с ОС Linux, используя средство [InfluxData Telegraf Agent](https://www.influxdata.com/time-series-platform/telegraf/).
    - Создавать пользовательские метрики в службе Azure с помощью API пользовательских метрик.
    
![Общие сведения о метриках](media/monitoring-data-collection/metrics-overview.png)

### <a name="what-can-you-do-with-metrics"></a>Что можно делать с помощью метрик
Ниже перечислены задачи, которые можно выполнить с помощью метрик.

- С помощью [обозревателя метрик](../monitoring-and-diagnostics/monitoring-metric-charts.md) можно анализировать собранные метрики и отображать их на диаграмме. Отслеживать производительность ресурса (например, виртуальной машины, веб-сайта или логического приложения), закрепляя диаграммы на [панели мониторинга Azure](../azure-portal/azure-portal-dashboards.md).
- Настроить [правило оповещения метрики](../monitoring-and-diagnostics/monitor-alerts-unified-usage.md), которое отправляет уведомление или выполняет [автоматическое действие](../monitoring-and-diagnostics/monitoring-action-groups.md), когда метрика переходит пороговое значение.
- С помощью [автомасштабирования](../monitoring-and-diagnostics/monitoring-overview-autoscale.md) можно увеличивать или уменьшать ресурсы, когда метрика переходит пороговое значение.
- Маршрутизировать метрики в службу Log Analytics для анализа данных метрик совместно с данными журнала и для хранения значений метрик более 93 дней. 
- Выполнять потоковую передачу метрик в [концентратор событий](../monitoring-and-diagnostics/monitor-stream-monitoring-data-event-hubs.md), чтобы маршрутизировать их в службу [Azure Stream Analytics](../stream-analytics/stream-analytics-introduction.md) или во внешние системы.
- [Архивация](../monitoring-and-diagnostics/monitor-tutorial-archive-monitoring-data.md) журнала производительности и работоспособности ресурса в целях соответствия требованиям, аудита или автономной отчетности.
- Получать доступ к значениям метрик из командной строки или пользовательского приложения с помощью [командлетов PowerShell](https://docs.microsoft.com/powershell/module/azurerm.insights/?view=azurermps-6.7.0) или [REST API](../monitoring-and-diagnostics/monitoring-rest-api-walkthrough.md).



### <a name="viewing-metrics"></a>Просмотр метрик
В Azure собранные метрики попадают в хранилище метрик Azure Monitor. Это база данных временных рядов, оптимизированная для быстрого извлечения данных и хранения значений метрик в течение 93 дней. Копировать метрики в службу Log Analytics для анализа и отслеживания долгосрочных тенденций.

Как было сказано выше, данные метрик используется различными способами. С помощью [обозревателя метрик](../monitoring-and-diagnostics/monitoring-metric-charts.md) можно анализировать данные непосредственно в хранилище метрик и отображать на диаграмме изменение значений нескольких метрик во времени. Вы можете просматривать графики в интерактивном режиме или закрепить их на панели мониторинга, чтобы просматривать их вместе с другими визуализациями. Кроме того, вы можете извлечь метрики с помощью [REST API мониторинга Azure](../monitoring-and-diagnostics/monitoring-rest-api-walkthrough.md).

![Обозреватель метрик](media/monitoring-data-collection/metrics-explorer.png)





## <a name="logs"></a>Журналы
Журналы содержат различные типы данных, упорядоченных в записи с разными наборами свойств для каждого типа. Журналы могут содержать числовые значения, например метрики, но обычно они содержат текстовые данные с подробными описаниями. Кроме того, они отличаются от метрик по своей структуре. Часто данные журналов не собираются через регулярные промежутки времени.

Стандартный тип записи журнала — событие, сведения о котором система собирает время от времени. Они создаются приложением или службой и обычно содержат достаточно сведений для самостоятельного предоставления полного контекста. Например, событие может указывать на то, что определенный ресурс был создан или изменен, новый узел был запущен в ответ на увеличение трафика или в работе приложения была обнаружена ошибка.

Журналы особенно удобно использовать для объединения данных из разных источников, для сложного анализа и для определения тенденций во времени. Так как формат данных может различаться, приложения могут создавать пользовательские журналы, используя необходимую структуру. Можно даже реплицировать метрики в журналы, чтобы объединить их с другими данными мониторинга для определения тенденций и анализа других данных.



### <a name="log-analytics"></a>Log Analytics
Журналы, собранные службой Azure Monitor, хранятся в службе Log Analytics, которая собирает данные телеметрии и другие данные из разных источников. Эта служба использует полнофункциональный язык запросов и модуль аналитики, позволяющие анализировать работу приложений и ресурсов. Другие службы Azure, например [центр безопасности Azure](../security-center/security-center-intro.md), хранят свои данные в службе Log Analytics, чтобы обеспечить общую платформу данных в системе управления Azure.

> [!IMPORTANT]
> Как и другие данные журналов, данные из службы Application Insights хранятся в службе Log Analytics, только для их хранения используется другой раздел. Это позволяет использовать такие же функции, что и для других данных в службе Log Analytics, но для доступа к этим данным необходимо использовать [консоль Application Insights](/application-insights/app-insights-analytics.md) или [API Application Insights](https://dev.applicationinsights.io/). Для анализа данных приложений вместе с другими данными журналов можно использовать [межресурсный запрос](../log-analytics/log-analytics-cross-workspace-search.md).


### <a name="sources-of-log-data"></a>Источники данных журналов
Служба Log Analytics может собирать данные из различных источников, размещенных как в Azure, так и в локальных ресурсах. Ниже перечислены некоторые источники данных, записываемых в службу Log Analytics.

- [Журналы действий](../log-analytics/log-analytics-activity.md) из ресурсов Azure, которые включают информацию о конфигурации и работоспособности ресурсов, и [журналы диагностики](../monitoring-and-diagnostics/monitor-stream-diagnostic-logs-log-analytics.md), предоставляющие аналитические данные о работе ресурсов.
- Агенты в виртуальных машинах с ОС [Windows](../log-analytics/log-analytics-windows-agent.md) и [Linux](../log-analytics/log-analytics-linux-agents.md), которые отправляют данные телеметрии из операционных систем на виртуальных машинах и приложений в службу Log Analytics согласно настроенным [источникам данных](../log-analytics/log-analytics-data-sources.md).
- Данные приложений, собранные службой [Application Insights](https://docs.microsoft.com/azure/application-insights/).
- Данные аналитики для определенных приложений или служб, полученные из [решений для мониторинга](../monitoring/monitoring-solutions.md) или функций, например Container Insights, VM Insights или Resource Group Insights.
- Данные о безопасности, собираемые [центром безопасности Azure](https://docs.microsoft.com/azure/security-center/).
- [Метрики](#metrics) из ресурсов Azure. Это позволяет хранить метрики дольше 93 дней и анализировать их вместе с другими данными журналов.
- Данные телеметрии, записываемые в [службу хранилища Azure](../log-analytics/log-analytics-azure-storage-iis-table.md).
- Пользовательские данные из любого клиента REST API, использующего клиент [API HTTP Data Collector](../log-analytics/log-analytics-data-collector-api.md), или из рабочего процесса [Azure Logic App](https://docs.microsoft.com/azure/logic-apps/).

![Компоненты службы Log Analytics](media/monitoring-data-collection/logs-overview.png)




### <a name="what-can-you-do-with-logs"></a>Что можно делать с журналами
Ниже перечислены задачи, которые можно выполнить над журналами.

- На [странице Log Analytics](../log-analytics/query-language/get-started-analytics-portal.md) на портале Azure можно создавать запросы для анализа данных журнала.  Закреплять результаты, отображаемые в виде таблиц или диаграмм, на [панели мониторинга Azure](../azure-portal/azure-portal-dashboards.md).
- Настраивать [правила оповещения журнала](../monitoring-and-diagnostics/alert-log.md), которые отправляют уведомления или выполняют [автоматические действия](../monitoring-and-diagnostics/monitoring-action-groups.md), когда результаты запроса соответствуют определенному результату.
- С помощью [Logic Apps]() можно создать рабочий процесс на основании данных в службе Log Analytics.
- Экспортировать результаты запроса в [Power BI](../log-analytics/log-analytics-powerbi.md), чтобы можно было использовать разные типы визуализации и делиться этими результатами с пользователями за пределами Azure.
- Получать доступ к значениям метрик из командной строки или пользовательского приложения с помощью [командлетов PowerShell](https://docs.microsoft.com/powershell/module/azurerm.operationalinsights/?view=azurermps-6.8.1) или [REST API](https://dev.loganalytics.io/).

### <a name="viewing-log-data"></a>Просмотр данных журналов
Для получения любых данных из службы Log Analytics используют [запрос журнала](../log-analytics/log-analytics-queries.md), в котором указан определенный набор данных. Для создания запросов используется [язык запросов Log Analytics](../log-analytics/query-language/get-started-queries.md), который представляет собой полнофункциональный язык запросов, с помощью которого можно быстро получать, консолидировать и анализировать собранные данные. На [странице Log Analytics](../log-analytics/log-analytics-log-search-portals.md) на портале Azure можно непосредственно анализировать данные в хранилище метрик и отображать на диаграмме изменение значений нескольких метрик со временем. Вы можете просматривать графики в интерактивном режиме или закрепить их на панели мониторинга, чтобы просматривать их вместе с другими визуализациями. Кроме того, вы можете извлечь метрики с помощью [REST API мониторинга Azure](../monitoring-and-diagnostics/monitoring-rest-api-walkthrough.md).

![Журналы](media/monitoring-data-collection/logs.png)

## <a name="convert-monitoring-data"></a>Преобразование данных мониторинга

### <a name="metrics-to-logs"></a>Передача метрик в журналы
Вы можете копировать метрики в службу Log Analytics, чтобы выполнять сложный анализ данных других типов, используя имеющийся в этой службе полнофункциональный язык запросов. Кроме того, вы можете сохранять данные журнала на более длительные периоды, чем метрики, что позволяет определять тенденции с течением времени. Если метрики или любые другие данные о производительности хранятся в Log Analytics, они выступают в роли журнала. Метрики позволяют поддерживать анализ и создание оповещений в режиме реального времени при использовании журналов для определения тенденций и анализа с другими данными.

Рекомендации по сбору метрик из ресурсов Azure см. в статье [Сбор журналов и метрик для служб Azure для использования в Log Analytics](../log-analytics/log-analytics-azure-storage.md). Сведения о сборе метрик из ресурсов PaaS в Azure см. в статье [Сбор метрик ресурсов PaaS в Azure с помощью Log Analytics](../log-analytics/log-analytics-collect-azurepass-posh.md).

### <a name="logs-to-metrics"></a>Передача журналов в метрики
Как было сказано выше, метрики реагируют быстрее, чем журналы, позволяя создавать оповещения с меньшими задержками и затратами. Служба Log Analytics собирает значительное количество числовых данных, которые подходят для метрик, но не хранятся в хранилище метрик Azure.  Распространенным примером являются данные о производительности, полученные от агентов и решений по управлению. Некоторые из этих значений можно скопировать в хранилище метрик, где они будут доступны для оповещений и анализа с помощью обозревателя метрик.

Описание этой возможности приведено в статье [Создание оповещений о метриках для журналов в Azure Monitor](../monitoring-and-diagnostics/monitoring-metric-alerts-logs.md). Со списком поддерживаемых значений можно ознакомиться в статье [Метрики, поддерживаемые Azure Monitor](../monitoring-and-diagnostics/monitoring-supported-metrics.md#microsoftoperationalinsightsworkspaces).

## <a name="stream-data-to-external-systems"></a>Потоковая передача данных во внешние системы
Помимо анализа данных мониторинга с помощью средств Azure вам может потребоваться перенаправлять их во внешнее средство, например продукт для управления информационной безопасностью и событиями безопасности (SIEM). Такое перенаправление обычно выполняют непосредственно из отслеживаемых ресурсов через [Центры событий Azure](https://docs.microsoft.com/azure/event-hubs/). 

Сведения о различных типах данных мониторинга см. в статье [Потоковая передача данных мониторинга Azure в концентратор событий для потребления внешним инструментом](../monitoring-and-diagnostics/monitor-stream-monitoring-data-event-hubs.md).

## <a name="next-steps"></a>Дополнительная информация

- Узнайте о [доступных данных мониторинга](monitoring-data-sources.md) для различных источников в Azure.