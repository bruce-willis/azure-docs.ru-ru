---
title: Просмотр зависимостей приложений с помощью службы Azure Monitor для виртуальных машин | Microsoft Docs
description: "\"Схема\" — это функция службы Azure Monitor для виртуальных машин, которая автоматически обнаруживает компоненты приложений в системах Windows и Linux и отображает связи между службами. В этой статье рассказывается о том, как использовать эту функцию в различных сценариях."
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: tysonn
ms.assetid: ''
ms.service: azure-monitor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/17/2018
ms.author: magoedte
ms.openlocfilehash: e75409e791c00dc0a5bec591aecfbaa019df8f81
ms.sourcegitcommit: ad08b2db50d63c8f550575d2e7bb9a0852efb12f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/26/2018
ms.locfileid: "47225168"
---
# <a name="using-azure-monitor-for-vms-map-to-understand-application-components"></a>Использование функции "Схема" в Azure Monitor для виртуальных машин для анализа структуры приложения
Обнаруженные компоненты приложений на виртуальных машинах под управлением Windows и Linux, работающих в вашей среде Azure, можно просматривать с помощью Azure Monitor для виртуальных машин двумя способами: непосредственно из виртуальной машины либо в группах виртуальных машин в Azure Monitor. 

Благодаря этой статье вы поймете разницу между этими двумя способами и узнаете, как использовать функцию "Схема". Сведения о настройке Azure Monitor для виртуальных машин, см. в [этой статье](monitoring-vminsights-onboard.md).

## <a name="sign-in-to-azure"></a>Вход в Azure
Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

## <a name="introduction-to-map-experience"></a>Общие сведения о функции "Схема"
Прежде чем углубляться в функцию "Схема" для одной виртуальной машины или группы виртуальных машин, важно изложить общие сведения для понимания представляемой информации и визуализаций.  

Независимо от того, выбираете ли вы функцию "Схема" непосредственно в виртуальной машине или в Azure Monitor, интерфейс и поведение функции будут одинаковыми в обоих случаях.  Единственное отличие заключается в том, что в Azure Monitor на одной схеме отображаются все элементы многоуровневого приложения или кластера.

Функция "Схема" визуализирует зависимости виртуальных машин, обнаруживая выполняющиеся процессы с активными подключениями к сети между серверами, задержку во входящих и исходящих подключениях и порты в любых подключенных по протоколу TCP архитектурах в заданном интервале времени.  Если развернуть виртуальную машину, отобразятся сведения о процессах, при этом будут отображены только те процессы, которые обмениваются данными с виртуальной машиной. Количество клиентов внешнего интерфейса, подключающихся к виртуальной машине, указано в поле "Группа клиентов". Количество тыловых серверов, к которым подключается виртуальная машина, указано в поле "Группы портов серверов". Разверните поле "Группы портов серверов", чтобы отобразить подробный список серверов, подключенных через этот порт.  

Если щелкнуть виртуальную машину, справа будет развернута область **Свойства**, в которой отображаются свойства выбранного элемента, например сведения о системе, предоставленные операционной системой, свойства виртуальной машины Azure и кольцевая диаграмма со сводными сведениями об обнаруженных подключениях. 

![Свойства системы компьютера](./media/monitoring-vminsights-maps/properties-pane-01.png)

Щелкните значок **События журнала** в правой части области, чтобы переключить фокус области и отобразить список таблиц с собранными данными, которые отправлены виртуальной машиной в службу Log Analytics и для которых можно создавать запросы.  Если щелкнуть запись какого-либо типа в списке, откроется страница **Журналы**, на которой отображаются результаты для этого типа с предварительно настроенным запросом, отфильтрованным по определенной виртуальной машине.  

![Список поиска в журнале в области "Свойства"](./media/monitoring-vminsights-maps/properties-pane-logs-01.png)

Закройте страницу *Журналы**, вернитесь в область **Свойства** и щелкните **Оповещения**, чтобы отобразить оповещения, созданные для виртуальной машины на основе критериев работоспособности. Функция "Схема" интегрирована с Оповещениями Azure, и это позволяет отображать созданные оповещения для выбранного сервера в выбранном временном диапазоне. При наличии оповещений на сервере отображается соответствующий значок, а сами оповещения отображаются в области оповещений компьютера. 

![Оповещения компьютера в области "Свойства"](./media/monitoring-vminsights-maps/properties-pane-alerts-01.png)

Чтобы включить функцию "Схема" для отображения релевантных оповещений, создайте правило генерации оповещений, которое будет срабатывать для определенного компьютера. Ниже описано, как правильно создавать оповещения.
- Добавьте предложение для группирования по компьютеру (например, **by Computer interval 1 minute**).
- Выберите предупреждение на основе измерения метрики.

Дополнительные сведения об оповещениях Azure и создании правил генерации оповещений см. в статье [Объединенные оповещения в Azure Monitor](../monitoring-and-diagnostics/monitoring-overview-unified-alerts.md).

Параметр **Условные обозначения** в верхнем правом углу описывает символы и роли на схеме.  Чтобы увеличить схему и перемещаться по ней, можно использовать элементы управления масштабом в нижней правой части страницы. С их помощью можно настроить масштаб и подогнать страницу к текущему размеру страницы.  

## <a name="connection-metrics"></a>Метрики подключения
В области **Подключения** отображаются стандартные метрики подключений для выбранного подключения с виртуальной машины через порт TCP. Среди них имеются метрики времени отклика, количества запросов в минуту, пропускной способности трафика и каналов.  

![Пример области диаграмм подключения к сети](./media/monitoring-vminsights-maps/map-group-network-conn-pane-01.png)  

### <a name="failed-connections"></a>Неудачные подключения
Неудачные подключения для процессов и компьютеров отображаются на схеме красными пунктирными линиями, которые указывают, что системе клиента не удалось связаться с процессом или портом. Сведения о неудачных подключениях поступают со всех систем, на которых имеется агент зависимостей и где попытка подключения завершилась сбоем. Служба "Схема" измеряет этот процесс, наблюдая за TCP-сокетами, которым не удается создать подключение. Ошибки подключения могут быть связаны с брандмауэром, неправильными настройками клиента или сервера, а также с недоступностью удаленной службы.

![Пример неудачного подключения на схеме](./media/monitoring-vminsights-maps/map-group-failed-connection-01.png)

Понимание причин неудачного подключения может помочь при устранении неполадок, проверке миграции, анализе системы безопасности и анализе общей архитектуры службы. Иногда неудачные подключения не несут вреда, но зачастую они указывают на проблему, например внезапную недоступность среды отработки отказа или отсутствие взаимодействия между двумя уровнями приложений после миграции в облако.

### <a name="client-groups"></a>Группы клиентов
Группы клиентов на схеме представляют клиентские компьютеры, у которых есть подключения к анализируемому компьютеру. Одна группа клиентов представляет клиентов для отдельного процесса или компьютера.

![Пример групп клиентов на схеме](./media/monitoring-vminsights-maps/map-group-client-groups-01.png)

Чтобы отобразить отслеживаемые клиенты и IP-адреса систем в группе клиентов, выберите необходимую группу. Содержимое группы отображается под группой.  

![Пример списка IP-адресов группы клиентов на схеме](./media/monitoring-vminsights-maps/map-group-client-group-iplist-01.png)

Если в группу входят отслеживаемые и неотслеживаемые клиенты, вы можете выбрать соответствующий раздел на кольцевой диаграмме группы, чтобы отфильтровать клиенты.

### <a name="server-port-groups"></a>Группы портов серверов
Группы портов серверов представляют порты на серверах, у которых имеются входящие подключения с анализируемого компьютера. В группе содержатся сведения о порте сервера и количестве серверов, у которых есть подключения к этому порту. Выберите группу, чтобы отобразить список отдельных серверов и подключений. 

![Пример группы портов серверов на схеме](./media/monitoring-vminsights-maps/map-group-server-port-groups-01.png)  

Если в группу входят отслеживаемые и неотслеживаемые серверы, вы можете выбрать соответствующий раздел на кольцевой диаграмме группы, чтобы отфильтровать серверы.

## <a name="view-map-directly-from-a-virtual-machine"></a>Просмотр схемы непосредственно в виртуальной машине 

Чтобы получить доступ к Azure Monitor для виртуальных машин непосредственно в виртуальной машине, выполните указанные ниже действия.

1. На портале Azure выберите **Виртуальные машины**. 
2. В списке выберите виртуальную машину и в разделе **Мониторинг** выберите пункт **Аналитические сведения (предварительная версия)**.  
3. Откройте вкладку **Схема**.

На схеме визуализированы зависимости виртуальных машин, то есть группы выполняющихся процессов и процессы с активными сетевыми подключениями за указанный диапазон времени.  По умолчанию на схеме показаны последние 30 минут.  С помощью селектора **TimeRange**, расположенного в левом верхнем углу, можно запрашивать сведения максимум за 1 час. Так вы можете получать представление о зависимостях в прошлом (например, во время инцидента или перед изменением).  

![Общие сведения о непосредственной схеме виртуальной машины](./media/monitoring-vminsights-maps/map-direct-vm-01.png)

## <a name="view-map-from-azure-monitor"></a>Просмотр схемы в Azure Monitor
В Azure Monitor функция "Схема" создает глобальное представление виртуальных машин и их зависимостей.  Чтобы получить доступ к функции "Схема" в Azure Monitor, выполните указанные ниже действия. 

1. На портале Azure выберите **Монитор**. 
2. В разделе **Аналитика** выберите пункт **Виртуальные машины (ознакомительная версия)**.
3. Откройте вкладку **Схема**.

![Общие сведения о схеме с несколькими виртуальными машинами в Azure Monitor](./media/monitoring-vminsights-maps/map-multivm-azure-monitor-01.png)

В селекторе **Рабочая область** в верхней части страницы (если у вас несколько рабочих областей Log Analytics) выберите рабочую область, которая интегрирована с решением и в которой имеются виртуальные машины, передающие данные в нее.  Затем в селекторе **Группа** выберите группу подписок или ресурсов. Отобразится набор виртуальных машин и их зависимости, сопоставленные с группой, за указанный период времени.  По умолчанию на схеме показаны последние 30 минут.  С помощью селектора **TimeRange** можно запрашивать сведения максимум за 1 час. Так вы можете получать представление о зависимостях в прошлом (например, во время инцидента или перед изменением).   

## <a name="next-steps"></a>Дополнительная информация
Сведения о том, как использовать функцию проверки работоспособности, см. в статье, посвященной [просмотру сведений о работоспособности виртуальных машин Azure](monitoring-vminsights-health.md). Сведения о том, как выявить узкие места и получить информацию об общем использовании и производительности виртуальных машин, см. в статье [Просмотр сведений о производительности виртуальных машин в Azure Monitor](monitoring-vminsights-performance.md). 
