---
title: Мониторинг службы Azure Site Recovery | Документация Майкрософт
description: Мониторинг и устранение неполадок с репликацией и операциями Azure Site Recovery с помощью портала.
services: site-recovery
author: bsiva
manager: abhemra
ms.service: site-recovery
ms.topic: troubleshooting
ms.date: 07/19/2018
ms.author: bsiva
ms.openlocfilehash: 89270a0bd1914a2486c8cc634563bdded743adaa
ms.sourcegitcommit: b5ac31eeb7c4f9be584bb0f7d55c5654b74404ff
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2018
ms.locfileid: "42746479"
---
# <a name="monitor-and-troubleshoot-site-recovery"></a>Мониторинг и устранение неполадок Site Recovery

В этой статье вы узнаете, как использовать встроенные функции мониторинга Azure Site Recovery для осуществления мониторинга и устранения неполадок. 

## <a name="use-the-dashboard"></a>Использование панели мониторинга

1. В хранилище щелкните **Обзор**, чтобы открыть панель мониторинга Site Recovery. Здесь можно переключаться между страницами панели мониторинга Site Recovery и Backup.

    ![Панель мониторинга Site Recovery](./media/site-recovery-monitor-and-troubleshoot/dashboard.png)

2.  Панель мониторинга содержит все данные мониторинга для хранилища в одном месте. На панели мониторинга можно детализировать различные области. 

    ![Панель мониторинга Site Recovery](./media/site-recovery-monitor-and-troubleshoot/site-recovery-overview-page.png).

3. На странице **Реплицированные элементы** нажмите кнопку **Просмотреть все**, чтобы просмотреть все серверы в хранилище.
4. Чтобы выполнить детализацию, щелкните сведения о состоянии в каждом разделе. На странице **Представление инфраструктуры** данные мониторинга можно сортировать по типу компьютеров, для которых выполняется репликация.

## <a name="monitor-replicated-items"></a>Мониторинг реплицированных элементов

В разделе реплицированных элементов показана работоспособность всех компьютеров, для которых включена репликация в хранилище.

**State** | **Дополнительные сведения**
--- | ---
Healthy | Репликация выполняется в обычном режиме. Ошибки или предупреждения не обнаружены.
Предупреждение | Обнаружено один или несколько признаков предупреждений, которые могут повлиять на репликацию.
критические ошибки. | Обнаружено один или несколько признаков критических ошибок репликации.<br/><br/> Как правило, эти признаки ошибок указывают на то, что репликация остановлена или не выполняется с такой же скоростью, с какой изменяются данные.
Не применяется | Серверы, которые в настоящее время не будут реплицироваться. Сюда относятся компьютеры, для которых выполнена отработка отказа.

## <a name="monitor-test-failovers"></a>Мониторинг тестовых отработок отказа

Просмотреть состояние тестовой отработки отказа можно для компьютеров в хранилище.

- Тестовую отработку отказа на реплицированных компьютерах рекомендуется выполнять хотя бы раз в шесть месяцев. Это позволит убедиться, что отработка отказа работает правильно, без нарушения рабочей среды. 
- Тестовая отработка отказа считается успешной только после успешной отработки отказа и успешного восстановления после сбоя.

**State** | **Дополнительные сведения**
--- | ---
Рекомендуется тестовая отработка отказа | Компьютеры, которые не выполняли тестовую отработку отказа с момента перехода в защищенное состояние.
Выполнено | Компьютеры, для которых тестовая отработка отказа была успешно выполнена один или несколько раз.
Не применяется | Компьютеры, которые в настоящее время не подлежат тестовой отработке отказа. Например: компьютеры, для которых выполнена отработка отказа; компьютеры, для которых сейчас выполняется начальная репликация, тестовая или реальная отработка отказа.

## <a name="monitor-configuration-issues"></a>Мониторинг проблем с конфигурацией

Раздел **Проблемы с конфигурацией** содержит список проблем, которые могут влиять на возможность успешной отработки отказа компьютера.

- Проблемы с конфигурацией (кроме доступности обновления программного обеспечения) определяются с помощью проверяющего элемента управления, который выполняет проверку каждые 12 часов по умолчанию. Можно принудительно выполнить операцию проверяющего элемента управления немедленно, щелкнув значок рядом с заголовком раздела **Проблемы с конфигурацией**.
- Щелкните ссылки для получения дополнительных сведений. Чтобы получить дополнительные сведения о проблемах, влияющих на определенные компьютеры, щелкните ссылку **Требует внимания** в столбце **Целевые конфигурации**. Эти сведения включают рекомендации по исправлению.

**State** | **Дополнительные сведения**
--- | ---
Отсутствующие конфигурации | Отсутствует необходимый параметр, например сеть восстановления или группа ресурсов.
Отсутствующие ресурсы | Указанный ресурс не найден или недоступен в подписке. Например, ресурс был удален или перенесен. К отслеживаемым ресурсам относятся: целевая группа ресурсов, целевая виртуальная сеть или подсеть, учетная запись хранения журнала или целевого объекта, целевая группа доступности, целевой IP-адрес.
Квота подписки |  Доступный баланс квоты ресурсов подписки приравнивается к балансу, который необходим для выполнения отработки отказа всех компьютеров в хранилище.<br/><br/> Если ресурсов недостаточно, сообщается о недостаточном балансе квот.<br/><br/> Квоты отслеживают число ядер виртуальных машин, число ядер семейства виртуальных машин, количество сетевых адаптеров (NIC).
Обновления программного обеспечения | Доступность новых обновлений программного обеспечения, а также данные о сроке действия версий программного обеспечения.


## <a name="monitoring-errors"></a>Мониторинг ошибок 
В разделе **Error summary** (Сводка ошибок) отображаются текущие ошибки, которые могут влиять на репликацию серверов в хранилище, а также на количество затронутых компьютеров.

- В начале раздела отображаются ошибки, влияющие на локальные компоненты инфраструктуры. Например, отсутствие пакета пульса от поставщика Azure Site Recovery, который работает на локальном сервере конфигурации, сервере VMM или узле Hyper-V.
- Далее перечислены ошибки репликации, влияющие на реплицированные серверы.
- Записи таблицы сортируются по убыванию серьезности ошибок, а затем — по убыванию количества затронутых компьютеров.
- Количество затронутых серверов позволяет понять, может ли отдельная проблема повлиять на несколько компьютеров. Например, сбой сети может повлиять на все компьютеры, реплицируемые в Azure. 
- На одном сервере может возникнуть несколько ошибок репликации. В этом случае каждая ошибка засчитывает этот сервер в список затронутых ею серверов. После устранения проблемы параметры репликации исправляются и ошибка удаляется с компьютера.

## <a name="monitor-the-infrastructure"></a>Мониторинг инфраструктуры.

На странице **Представление инфраструктуры** показаны компоненты инфраструктуры, которые вовлечены в процесс репликации, и работоспособность подключений между серверами и службами Azure.

- Зеленая линия указывает на работоспособность подключения.
- Красная линия с наложенным значком ошибки указывает на наличие одной или нескольких ошибок, которые влияют на возможность подключения.
-  Если навести указатель мыши на значок ошибки, отобразится описание ошибки и количество затронутых ею объектов. Щелкните значок, чтобы увидеть отфильтрованный список затронутых объектов.

    ![Представление инфраструктуры Site Recovery (хранилище)](./media/site-recovery-monitor-and-troubleshoot/site-recovery-vault-infra-view.png)

## <a name="tips-for-monitoring-the-infrastructure"></a>Советы по мониторингу инфраструктуры

- Убедитесь, что локальные компоненты инфраструктуры (сервер конфигурации, серверы обработки, серверы VMM, узлы Hyper-V, виртуальные машины VMware) используют последнюю версию поставщика или агентов Site Recovery.
- Чтобы использовать все функции в представлении инфраструктуры, следует запустить для этих компонентов [накопительный пакет обновления 22](https://support.microsoft.com/help/4072852).
- Чтобы использовать представление инфраструктуры, выберите соответствующий сценарий репликации в своей среде. Можно выполнить детализацию в представлении для получения дополнительных сведений. В следующей таблице показаны, какие сценарии представлены.

    **Сценарий** | **State**  | **Доступно ли представление?**
    --- |--- | ---
    **Репликация между локальными сайтами** | Все состояния | Нет  
    **Репликация виртуальных машин Azure между регионами Azure**  | Выполняется включенная и начальная репликация | Yes
    **Репликация виртуальных машин Azure между регионами Azure** | Отработка отказа и восстановление размещения | Нет    
    **Репликация VMware в Azure** | Выполняется включенная и начальная репликация | Yes     
    **Репликация VMware в Azure** | Отработка отказа и восстановление размещения | Нет       
    **Репликация Hyper-V в Azure** | Отработка отказа и восстановление размещения | Нет 

- Чтобы просмотреть представление инфраструктуры для одного реплицируемого компьютера, в меню хранилища щелкните **Реплицированные элементы** и выберите сервер.  

### <a name="common-questions"></a>Часто задаваемые вопросы


**Почему число виртуальных машин в представлении инфраструктуры хранилища отличается от общего числа в разделе реплицированных элементов?**

Представление инфраструктуры хранилища ограничивается сценариями репликации. В счет для представления включаются только компьютеры в выбранном сценарии репликации. Кроме того, считаются только виртуальные машины, настроенные для репликации в Azure. Компьютеры с выполненной отработкой отказа или компьютеры, реплицируемые на локальный сайт, не учитываются в представлении.

**Почему число реплицированных элементов, которое отображается в контейнере "Основное", отличается от общего числа реплицированных элементов на панели мониторинга?**

В счете, отображаемом в контейнере "Основное", учитываются только компьютеры, для которых была выполнена начальная репликация. В общем числе реплицированных элементов учитываются все компьютеры в хранилище, включая те, начальная репликация которых выполняется в данный момент.


## <a name="monitor-recovery-plans"></a>Мониторинг планов восстановления

В **разделе "Планы восстановления"** можно просмотреть количество планов, создать новые и изменить существующие планы.  

## <a name="monitor-jobs"></a>Мониторинг заданий

Раздел **Задания** отражает состояние операций Site Recovery.

- Большинство операций в Azure Site Recovery выполняется асинхронно, при этом создается и используется задание отслеживания для мониторинга хода выполнения операции. 
- Объект задания содержит все необходимые сведения для отслеживания состояния и хода выполнения операции. 

Выполняйте мониторинг заданий следующим образом.

1. В разделе "Панель мониторинга" > **Задания** можно просмотреть сводку заданий, которые были завершены, находятся в ходе выполнения или ожидают ввода данных, за последние 24 часа. Можно щелкнуть любое состояние, чтобы получить дополнительные сведения о соответствующих заданиях.
2. Нажмите кнопку **Просмотреть все**, чтобы просмотреть все задания за последние 24 часа.

    > [!NOTE]
    > Сведения о задании можно также получить из "Меню хранилища" > **Задания Site Recovery**. 

2. В списке **Задания Site Recovery** отображается список заданий. В верхнем меню можно получить сведения об ошибке для конкретных заданий, отфильтровать список заданий на основе заданных критериев и экспортировать выбранные сведения о задании в Excel.
3. Задание можно детализировать, щелкнув его. 

## <a name="monitor-virtual-machines"></a>Мониторинг работоспособности виртуальных машин

Панель мониторинга дает возможность отслеживать компьютеры на странице виртуальных машин. 

1. Чтобы получить список реплицированных компьютеров в хранилище, щелкните **Реплицированные элементы**.  Кроме того, можно увидеть отфильтрованный список защищенных элементов, щелкнув любой из ярлыков с заданной областью на странице панели мониторинга.

    ![Представление списка реплицированных элементов Azure Site Recovery](./media/site-recovery-monitor-and-troubleshoot/site-recovery-virtual-machine-list-view.png)

2. На странице **Реплицированные элементы** можно просмотреть и отфильтровать информацию. Вверху меню действий можно выполнить действия для определенного компьютера, включая запуск тестовой отработки отказа или просмотр конкретных ошибок.
3.  Нажмите кнопку **Столбцы** для отображения дополнительных столбцов, например столбцов RPO, проблем с конфигурацией целевого объекта и ошибок репликации.
4. Щелкните **Фильтр** для просмотра сведений на основе указанных параметров, например работоспособность репликации или политика конкретной репликации.
5. Щелкните правой кнопкой мыши, чтобы запустить операции, такие как тестовая отработка отказа для компьютера или просмотр сведений о конкретной ошибке.
6. Выберите компьютер, чтобы получить дополнительные сведения о нем. Вы сможете ознакомиться со следующими сведениями.
      - **Сведения о репликации.** Текущее состояние и работоспособность компьютера.
      - **RPO** (целевая точка восстановления). Текущая целевая точка восстановления виртуальной машины и время последнего вычисления целевой точки восстановления.
      - **Точки восстановления.** Последние доступные точки восстановления компьютера.
      - **Готовность к отработке отказа.** Показывает, выполнялась ли тестовая отработка отказа для компьютера, версию агента, работающего на компьютере (для компьютеров под управлением Службы мобильности), а также проблемы с конфигурацией.
      - **Ошибки.** Список ошибок репликации, наблюдаемых на компьютере в настоящее время, а также возможные причины или действия их появления.
      - **События.** Хронологический список последних событий, влияющих на работу компьютера. Сведения об ошибке отображают текущие наблюдаемые ошибки, а события представляют собой хронологическую запись о проблемах, которые повлияли на компьютер.
      - **Представление инфраструктуры.** Показывает состояние инфраструктуры для сценария, когда происходит репликация компьютера в Azure.

    ![Сведение о реплицированном элементе Azure Site Recovery](./media/site-recovery-monitor-and-troubleshoot/site-recovery-virtual-machine-details.png)


### <a name="common-questions"></a>Часто задаваемые вопросы

**Чем целевая точка восстановления (RPO) отличается от последней доступной точки восстановления?**


- Служба Site Recovery использует многоэтапный асинхронный процесс репликации компьютеров в Azure.
- На предпоследнем этапе репликации последние изменения на компьютере и метаданные копируются в учетную запись хранения журналов или кэша.
- Эти изменения, а также тег для идентификации восстанавливаемой точки, записываются в учетную запись хранения в целевом регионе.
-  Теперь Site Recovery может создать восстанавливаемую точку для виртуальной машины.
- На этом этапе RPO соответствует изменениям, переданным на данный момент в учетную запись хранения. Другими словами, на данном этапе значение RPO виртуальной машины равно времени, прошедшему с момента создания метки времени, соответствующей восстанавливаемой точке.
- После этого служба Site Recovery получает данные, переданные из учетной записи хранения, и применяет их к дискам реплик, созданных для компьютера.
- Затем Site Recovery создает точку восстановления и делает ее доступной для восстановления при отработке отказа. Последняя доступная точка восстановления указывает метку времени, соответствующую последней точке восстановления, которая уже была обработана и применена к дискам реплик.

> [!NOTE]
> Неправильное системное время на реплицируемом исходном компьютере или на локальных серверах инфраструктуры приведет к искажению вычисляемого значения RPO. Для точной отчетности RPO убедитесь, что системные часы на всех серверах и компьютерах показывают правильное время. 

## <a name="subscribe-to-email-notifications"></a>Подписка на уведомления по электронной почте

Вы можете подписаться на уведомления по электронной почте для следующих критических событий.
 
- Критическое состояние реплицируемого компьютера.
- Отсутствие связи между локальными компонентами инфраструктуры и службой Site Recovery. Связь между Site Recovery и локальными серверами, зарегистрированными в хранилище, определяется с помощью механизма пульса.
- Сбои отработки отказа.

Подпишитесь следующим образом.

В хранилище > **Мониторинг и отчеты** щелкните **События Site Recovery**.
2. Щелкните **Уведомления по электронной почте**.
3. В разделе **Уведомления по электронной почте** включите уведомления и укажите, кому отправлять сообщение. Вы можете отправлять уведомления всем администраторам подписки, а также на конкретные адреса электронной почты.

    ![Уведомления по почте](./media/site-recovery-monitor-and-troubleshoot/email.png)
