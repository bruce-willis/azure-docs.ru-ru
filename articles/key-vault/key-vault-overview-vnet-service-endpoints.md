---
ms.assetid: ''
title: Конечные точки служб виртуальной сети для Azure Key Vault | Документация Майкрософт
description: Обзор конечных точек служб виртуальной сети для Key Vault.
services: key-vault
author: amitbapat
ms.author: ambapat
manager: mbaldwin
ms.date: 08/31/2018
ms.service: key-vault
ms.workload: identity
ms.topic: conceptual
ms.openlocfilehash: c2696d5eb22443b565c48ef4f96d6e4a25827606
ms.sourcegitcommit: f3bd5c17a3a189f144008faf1acb9fabc5bc9ab7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2018
ms.locfileid: "44295010"
---
# <a name="virtual-network-service-endpoints-for-azure-key-vault"></a>Конечные точки служб виртуальной сети для Azure Key Vault

Конечные точки служб виртуальной сети для Key Vault позволяют предоставить доступ для указанной виртуальной сети или списка диапазонов адресов IPv4 (протокол IP версии 4). Доступ любой вызывающей стороны, подключающейся к хранилищу ключей, не из этих источников будет отклонен. Если клиент согласился на доступ из доверенных служб Майкрософт, таких как Office 365 Exchange Online, Office 365 SharePoint Online, служба вычислений Azure, Azure Resource Manager, Azure Backup и т. д., подключение из этих служб будет разрешено через брандмауэр. Разумеется, такие вызывающие стороны по-прежнему должны предоставлять допустимый токен AAD и иметь разрешения (настроенные в качестве политик доступа) для выполнения запрошенной операции. Дополнительные технические сведения о конечных точках служб виртуальной сети см. [здесь](../virtual-network/virtual-network-service-endpoints-overview.md).

## <a name="usage-scenarios"></a>Сценарии использования

[Брандмауэры и виртуальные сети Key Vault](key-vault-network-security.md) можно настроить так, чтобы по умолчанию запрещать доступ трафику из всех сетей (включая интернет-трафик). Вы можете разрешить доступ для трафика из конкретных виртуальных сетей Azure или общедоступных диапазонов IP-адресов в Интернете, что позволит вам создать границу для приложений в виде безопасной сети.

> [!NOTE]
> Правила брандмауэра и виртуальной сети Key Vault применяются только к [плоскости данных](../key-vault/key-vault-secure-your-key-vault.md#data-plane-access-control) хранилища ключей. На операции плоскости управления Key Vault (такие как создание, удаление, изменение хранилища ключей, настройка политик доступа, а также правил брандмауэров и виртуальной сети) не влияют правила брандмауэра и виртуальной сети.

Например,
* Если Key Vault используется для хранения ключей шифрования, секретов приложения, сертификатов и вы хотите заблокировать доступ к хранилищу ключей из общедоступного Интернета.
* Если вы хотите заблокировать доступ к хранилищу ключей, чтобы только ваше приложение или небольшой список назначенных узлов могли подключаться к нему.
* У вас есть приложения, работающие в виртуальной сети Azure, которая заблокирована для всего исходящего и входящего трафика. Вашему приложению все еще требуется подключение к хранилищу ключей, чтобы получать секреты или сертификаты либо использовать криптографические ключи.

## <a name="configure-key-vault-firewalls-and-virtual-networks"></a>Настройка брандмауэров и виртуальных сетей Key Vault

Ниже приведены шаги, необходимые для настройки брандмауэров и виртуальных сетей. Эти шаги остаются такими же, независимо от того, какой интерфейс (PowerShell, CLI, портал Azure) будет использоваться.
1. Необязательно, но настоятельно рекомендуется, включить [ведение журнала хранилища ключей](key-vault-logging.md), чтобы видеть подробные журналы событий. Это поможет в диагностике, когда правила брандмауэра и виртуальной сети предотвращают доступ к хранилищу ключей.
2. Включите конечные точки службы хранилища ключей для целевых виртуальных сетей и подсетей.
3. Установите правила брандмауэра и виртуальной сети для хранилища ключей таким образом, чтобы предоставить доступ к этому хранилищу ключей из определенных виртуальных сетей, подсетей и диапазонов IPv4-адресов.
4. Если это хранилище ключей должно быть доступно любым доверенным службам Майкрософт, вам необходимо включить параметр, позволяющий доверенным службам Azure подключаться к хранилищу ключей.

Пошаговые инструкции см. в статье [Настройка брандмауэров и виртуальных сетей Azure Key Vault](key-vault-network-security.md).

> [!IMPORTANT]
> Когда правила брандмауэра начнут действовать, все операции [плоскости данных](../key-vault/key-vault-secure-your-key-vault.md#data-plane-access-control) Key Vault будут выполняться, только если запросы вызывающей стороны поступают из разрешенных виртуальных сетей или диапазонов IPv4-адресов. Это также относится к получению доступа к хранилищу ключей с портала Azure. Хотя пользователь может перейти в хранилище ключей с портала Azure, он не сможет перечислять ключи, секреты и сертификаты, если их клиентский компьютер не находится в разрешенном списке. Это также влияет на выбор хранилища ключей другими службами Azure. Пользователи могут просматривать список хранилищ ключей, но не список ключей, если правила брандмауэра запрещают их клиентский компьютер.


> [!NOTE]
> * Максимальное разрешенное количество правил виртуальной сети и правил IPv4 — 127. 
> * Небольшие адреса, использующие размеры с префиксом /31 или /32, не поддерживаются. Эти диапазоны следует настраивать с помощью отдельных правил для IP-адресов.
> * Правила IP-сети можно применять только в общедоступных IP-адресах. Диапазоны IP-адресов, зарезервированные для частных сетей (как определено в документе RFC 1918), запрещено использовать в правилах IP. Частные сети включают адреса, начинающиеся с *10.**, *172.16.**, и *192.168.**. 
> * Сейчас поддерживаются только IPV4-адреса.

## <a name="trusted-services"></a>Доверенные службы
Ниже приведен список доверенных служб, которые получают доступ к хранилищу ключей, если включен соответствующий параметр.

|Доверенная служба|Сценарии использования|
| --- | --- |
|Служба развертывания виртуальных машин Azure|[Развертывание сертификатов на виртуальных машинах из хранилища ключей, управляемого пользователем](https://blogs.technet.microsoft.com/kv/2016/09/14/updated-deploy-certificates-to-vms-from-customer-managed-key-vault/)|
|Служба развертывания шаблонов Azure Resource Manager|[Передача безопасных значений в процессе развертывания](../azure-resource-manager/resource-manager-keyvault-parameter.md)|
|Служба шифрования томов для шифрования дисков Azure|Разрешение доступа к ключу BitLocker (виртуальная машина Windows), парольной фразе DM (виртуальная машина Linux) и ключу шифрования ключей во время развертывания виртуальной машины, чтобы включить [шифрование дисков Azure](../security/azure-security-disk-encryption.md).|
|Служба архивации Azure|Разрешение резервного копирования и восстановления соответствующих ключей и секретов во время резервного копирования виртуальной машины Azure с помощью службы [Azure Backup](../backup/backup-introduction-to-azure-backup.md).|
|Exchange Online и SharePoint Online|Разрешение доступа к ключу пользователя для шифрования службы с использованием [этого ключа](https://support.office.com/en-us/article/Controlling-your-data-in-Office-365-using-Customer-Key-f2cd475a-e592-46cf-80a3-1bfb0fa17697).|
|Azure Information Protection|Разрешение доступа к ключу клиента для [Azure Information Protection.](https://docs.microsoft.com/azure/information-protection/what-is-information-protection)|
|Службы приложений|[Развертывание сертификата веб-приложения Azure через Key Vault](https://blogs.msdn.microsoft.com/appserviceteam/2016/05/24/deploying-azure-web-app-certificate-through-key-vault/)|
|Azure SQL|[Прозрачное шифрование данных с поддержкой использования собственных ключей для Базы данных SQL Azure и Хранилища данных SQL Azure](../sql-database/transparent-data-encryption-byok-azure-sql.md?view=sql-server-2017&viewFallbackFrom=azuresqldb-current)|
|Хранилище Azure|[Шифрование службы хранилища с помощью управляемых пользователем ключей в Azure Key Vault](../storage/common/storage-service-encryption-customer-managed-keys.md)|
|Хранилище озера данных Azure|[Шифрование данных в Azure Data Lake Store](../data-lake-store/data-lake-store-encryption.md) с помощью управляемого пользователем ключа|



> [!NOTE]
> Политики доступа хранилища ключей нужно настроить так, чтобы разрешить доступ к этому хранилищу соответствующим службам.

## <a name="next-steps"></a>Дополнительная информация

* [Защита хранилища ключей](key-vault-secure-your-key-vault.md)
* [Настройка брандмауэров и виртуальных сетей Azure Key Vault](key-vault-network-security.md)