---
title: Сброс TCP-подключений для Load Balancer при простое | Документация Майкрософт
description: Load Balancer с двунаправленными TCP-пакетами RST при истечении времени ожидания простоя
services: load-balancer
documentationcenter: na
author: KumudD
manager: timlt
editor: ''
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/08/2018
ms.author: kumud
ms.openlocfilehash: 9aa3811eb03d38a4c6ab8203512f3e6699098122
ms.sourcegitcommit: 55952b90dc3935a8ea8baeaae9692dbb9bedb47f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2018
ms.locfileid: "48883641"
---
# <a name="load-balancer-with-tcp-reset-on-idle-public-preview"></a>Load Balancer со сбросом TCP-подключений при простое (общедоступная предварительная версия)

С помощью [Load Balancer ценовой категории "Стандартный"](load-balancer-standard-overview.md) можно сделать работу приложения более предсказуемой в сценариях с двунаправленным сбросом TCP-подключений (TCP-пакетами RST) для каждого настраиваемого времени ожидания простоя.  По умолчанию, когда истекает время ожидания простоя последовательности, Load Balancer автоматически прерывает ее.

![Сброс TCP-подключений в Load Balancer](media/load-balancer-tcp-reset/load-balancer-tcp-reset.png)

>[!NOTE] 
>Функция Load Balancer со сбросом TCP-подключений при истечении времени ожидания простоя находится в стадии общедоступной предварительной версии и доступна не во всех [регионах](#regions). Предварительная версия предоставляется без соглашения об уровне обслуживания. Не рекомендуем использовать ее в рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. См. [дополнительные условия использования для предварительных версий Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).
 
Изменить это поведение по умолчанию и включить отправку признаков TCP Reset при истечении времени ожидания простоя можно в правилах NAT для входящего трафика, правилах балансировки нагрузки и [правилах для исходящего трафика](https://aka.ms/lboutboundrules).  Если эта функция включена для отдельного правила, Load Balancer отправляет двунаправленные признаки TCP Reset (TCP-пакеты RST) клиентским и серверным конечным точкам при истечении времени ожидания простоя для всех соответствующих последовательностей.

Конечные точки, получившие TCP-пакеты RST, немедленно закрывают соответствующий сокет. Таким образом конечные точки немедленно уведомляются об освобождении соединения, и дальнейшие попытки передачи данных по этому TCP-соединению будут завершаться неудачно.  Приложения могут очищать соединения при закрытии сокета и повторно устанавливать их по мере необходимости, не дожидаясь, когда время ожидания TCP-соединения окончательно истечет.

Во многих ситуациях это позволяет уменьшить количество сообщений об активности TCP (или прикладного уровня), которые требуется отправлять для обновления времени ожидания последовательности. 

Однако если время простоя превышает допускаемое конфигурацией или приложение демонстрирует нежелательное поведение при включенном сбросе TCP, вам может требоваться использовать сообщения об активности TCP (или прикладного уровня) для отслеживания активности TCP-соединений.  Кроме того, сообщения об активности, особенно об активности прикладного уровня, могут по-прежнему быть полезными, если где-то на пути соединения есть прокси-сервер.  

Тщательно проанализируйте весь сценарий, чтобы решить, даст ли преимущества включение сброса TCP и настройка времени ожидания простоя, а также потребуются ли дополнительные действия для обеспечения требуемого поведения приложения.

## <a name="enabling-tcp-reset-on-idle-timeout"></a>Включение сброса подключений TCP при истечении времени ожидания простоя

С помощью интерфейса API версии 2018-07-01 можно включить двунаправленную отправку пакетов TCP Reset при истечении времени ожидания простоя для отдельных правил:

```json
      "loadBalancingRules": [
        {
          "enableTcpReset": true | false,
        }
      ]
```

```json
      "inboundNatRules": [
        {
          "enableTcpReset": true | false,
        }
      ]
```

```json
      "outboundRules": [
        {
          "enableTcpReset": true | false,
        }
      ]
```

## <a name="regions"></a> Доступность по регионам

В настоящее время этот параметр действует в перечисленных ниже регионах.  Если регион отсутствует в списке, параметр не действует.

| Регион |
|---|
| Юго-восточная Азия |
| Западная Европа |
| Восточная часть США 2 |
| Север США |
| Западная часть США |

Эта таблица будет обновляться по мере развертывания предварительной версии в других регионах.  

## <a name="limitations"></a>Ограничения

- Доступно [не во всех регионах](#regions).
- С помощью портала нельзя настраивать или просматривать состояние функции сброса TCP-подключений.  Вместо этого используйте шаблоны, REST API, Azure CLI 2.0 или PowerShell.

## <a name="next-steps"></a>Дополнительная информация

- Сведения о [Load Balancer ценовой категории "Стандартный"](load-balancer-standard-overview.md).
- Сведения о [правилах для исходящих подключений](load-balancer-outbound-rules-overview.md).
