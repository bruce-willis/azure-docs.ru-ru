---
title: Что такое пользовательские голосовые модели в Cognitive Services
description: В этой статье рассматривается настройка голоса в службе "Преобразование текста в речь" корпорации Майкрософт, которая позволяет создать узнаваемые уникальные голоса.
services: cognitive-services
author: noellelacharite
ms.service: cognitive-services
ms.topic: article
ms.date: 05/07/2018
ms.author: nolach
ms.openlocfilehash: 5e99e7e376a020f845816fb38e31dd727d87a4cb
ms.sourcegitcommit: 42405ab963df3101ee2a9b26e54240ffa689f140
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/28/2018
ms.locfileid: "47423431"
---
# <a name="creating-custom-voice-fonts"></a>Создание настраиваемого голоса

Настройка голоса в службе "Преобразование текста в речь" позволяет создать узнаваемый уникальный *голос*. 

Чтобы создать голос, сделайте студийную запись и отправьте связанные сценарии в качестве данных обучения. Затем служба создает модель уникального голоса, настроенную для записи. Затем этот голос можно использовать для синтезирования речи. 

Для подтверждения концепции можно начать с небольшого количества данных. Однако чем больше данных вы предоставите, тем более естественно и профессионально будет звучать голос.


## <a name="prerequisites"></a>Предварительные требования

Функция настройки голоса в службе **Преобразование текста в речь** в настоящее время находится в закрытой предварительной версии. Для доступа необходимо [заполнить форму заявки](https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR0N8Vcdi8MZBllkZb70o6KdURjRaUzhBVkhUNklCUEMxU0tQMEFPMjVHVi4u).

Вам также потребуется учетная запись Azure и подписка на службу "Речь". [Создайте ее](https://docs.microsoft.com/azure/cognitive-services/speech-service/get-started), если это еще не сделано. Подключите подписку к порталу Custom Voice следующим образом.

1. Выполните вход на [портал Custom Voice](https://customvoice.ai) с помощью той же учетной записи Майкрософт, которая использовалась для получения доступа.

2. Перейдите в раздел **Подписки** под именем учетной записи пользователя в правом верхнем углу.

    ![Подписки](media/custom-voice/subscriptions.png)

3. На странице "Подписки" выберите **Connect existing subscription** (Подключиться к имеющейся подписке). Обратите внимание на то, что службы речи поддерживают разные регионы. Проверьте регион, в котором был создан ключ подписки, и убедитесь, что вы подключили свой ключ к правильному подпорталу.  

     
4. Вставьте ключ подписки в таблицу, как показано ниже. В каждой подписке есть два ключа. Использовать можно любой из них.

     ![Добавление подписки](media/custom-voice/add-subscription.png)

Все готово.

## <a name="prepare-recordings-and-transcripts"></a>Подготовка записей и расшифровок

Набор данных для обучения голоса состоит из набора аудиофайлов, а также текстового файла, в котором содержатся расшифровки всех этих аудиофайлов.

Эти файлы можно подготовить двумя способами: либо написать сценарий, который озвучит актер дубляжа, либо использовать общедоступный аудиофайл и преобразовать его в текст. В последнем случае отредактируйте в аудиофайлах слова-паразиты, такие как "эм", заикание, нечетко или неправильно произнесенные слова.

Чтобы получить хороший голос, запись необходимо производить в тишине при помощи качественного микрофона. Согласованный объем, скорость речи, тон голоса и выразительная манера речи необходимы для создания качественного цифрового голоса. 

Чтобы создать голос для использования в рабочей среде, рекомендуем использовать профессиональную студию звукозаписи и актера озвучивания. Дополнительные сведения см. в разделе [Как записывать образцы голоса для создания пользовательских голосовых моделей](record-custom-voice-samples.md).

### <a name="audio-files"></a>Аудиофайлы

Каждый звуковой файл должен содержать одно высказывание (например, одно предложение или одно действие диалоговой системы). Все файлы должны быть на одном языке (многоязычные пользовательские голоса не поддерживаются). Звуковые файлы также должны иметь уникальное числовое имя с расширением `.wav`.

Звуковые файлы следует подготовить следующим образом. Другие форматы не поддерживаются и будут отклонены.

| **Свойство** | **Значение** |
| ------------ | --------- |
| Формат файла  | RIFF (WAV)|
| Частота выборки| Не менее 16 000 Гц |
| Формат выборки| PCM, 16-разрядные |
| Имя файла    | Числовое, с расширением `.wav` |
| Формат архива| .zip      |
| Максимальный размер архива|200 МБ|

> [!NOTE]
> Звуковые WAV-файлы с частотой выборки ниже 16 000 Гц будут отклонены. Если ZIP-файл содержит сигналы с разной частотой выборки, будут импортированы только те из них, частота выборки которых не меньше 16 000 Гц.
> Портал в настоящее время импортирует ZIP-архивы размером до 200 МБ. Однако можно отправить несколько архивов. Максимальное разрешенное количество наборов данных — 10 ZIP-файлов для пользователей с бесплатной подпиской и 50 — для пользователей со стандартной подпиской.

### <a name="transcripts"></a>Расшифровка

Файл транскрибирования — это обычный текстовый файл (в формате ANSI, UTF-8, UTF-8-BOM, UTF-16-LE или UTF-16-BE). Каждая строка файла транскрибирования должна иметь имя звукового файла с символом табуляции (кодовая точка 9) и расшифровку. Пустые строки не допускаются.

Например: 

```
0000000001  This is the waistline, and it's falling.
0000000002  We have trouble scoring.
0000000003  It was Janet Maslin.
```

Система пользовательских голосовых моделей нормализует расшифровки, преобразовывая текст в нижний регистр и удаляя лишние знаки пунктуации. Важно, чтобы расшифровка соответствовала аудиозаписям на 100 %.

> [!TIP]
> При создании рабочих голосов службы "Преобразование текста в речь" выбирайте высказывания (или пишите сценарии) с учетом фонетического охвата и эффективности. Возникли проблемы при получении требуемых результатов? [Обратитесь к команде Пользовательских голосовых моделей](mailto:tts@microsoft.com), чтобы узнать больше о том, как получить консультацию.

## <a name="upload-your-datasets"></a>Обновление наборов данных

После подготовки архива и расшифровок звукового файла отправьте их через [портал службы Custom Voice](https://customvoice.ai).

> [!NOTE]
> Наборы данных нельзя изменить после отправки. Например, если вы забыли включить в набор расшифровку некоторых звуковых файлов или случайно выбрали неправильный пол, необходимо заново загрузить весь набор данных. Перед началом отправки тщательно проверьте свой набор данных и настройки.

1. Войдите на портал.

2. В разделе **Custom Voice** (Пользовательские голосовые модели) на главной странице выберите **Data** (Данные).   

    Появится таблица **My Voice** (Мой голос). Она остается пустой, пока не отправлены никакие наборы голосовых данных.

3. Щелкните **Импорт данных**, чтобы открыть страницу отправки нового набора данных. 

    ![Импорт голосовых данных](media/custom-voice/import-voice-data.png)

4. Введите имя и описание в предоставленные поля. 

5. Выберите языковый стандарт для голоса. Убедитесь, что сведения о языковом стандарте соответствуют языку данных записи и сценариям. 

6. Выберите пол говорящего, голос которого вы используете.

7. Выберите сценарий и звуковые файлы для отправки. 

8. Нажмите кнопку **Импортировать**, чтобы отправить данные. Импортирование крупных наборов данных может занять несколько минут.

> [!NOTE]
> Пользователи бесплатной подписки могут отправлять сразу два набора данных. Стандартные подписчики могут одновременно отправлять пять наборов данных. Если вы достигли предела, подождите, пока завершится импортирование хотя бы одного из наборов данных. Затем повторите попытку.

После завершения отправки снова отобразится таблица **My Voice Data** (Мои голосовые данные). Отобразится запись, соответствующая только что отправленному набору данных. 

Наборы данных автоматически проверяются после отправки. Проверка данных включает ряд проверок звуковых файлов для проверки их формата, размера и частоты выборки. При проверке файлов транскрибирования выполняется проверка формата файлов и нормализация текста. Высказывания преобразовываются в текст при помощи распознавания речи. Затем полученный текст сравнивается с предоставленной расшифровкой.

![Мои голосовые данные](media/custom-voice/my-voice-data.png)

В следующей таблице приведены состояния обработки импортированных наборов данных. 

| Состояние | Значение
| ----- | -------
| `NotStarted` | Набор данных получен и помещен в очередь для обработки.
| `Running` | Выполняется проверка набора данных.
| `Succeeded` | Проверка набора данных выполнена. Теперь его можно использовать для создания голоса.

После завершения проверки можно увидеть общее количество согласованных высказываний для каждого из ваших наборов данных в столбце **Utterance** (Высказывание).

Отчет можно скачать, чтобы проверить оценку произношения и уровень шума каждой записи. Оценка произношению дается в диапазоне от 0 до 100. Оценка ниже 70 обычно означает ошибку в речи или несоответствие в сценарии. Заметный акцент уменьшает оценку произношения и влияет на созданный цифровой голос.

Более высокий коэффициент сигнала и шума (SNR) обозначает более низкий уровень шума в звуковом файле. Обычно SNR выше 50 можно достичь, производя запись в профессиональных студиях. Звуковой файл с SNR менее 20 может привести к явному шуму в созданном голосе.

Рассмотрите возможность повторной записи любых высказываний с низкой оценкой произношения или слабым SNR. Если повторная запись невозможна, исключите эти высказывания из набора данных.

## <a name="build-your-voice-font"></a>Создание голоса

После проверки набор данных можно использовать для создания пользовательского голоса. 

1.  В раскрывающемся меню **Custom Voice** (Пользовательские голосовые модели) выберите **Модели**.
 
    Появится таблица **My Voice Fonts** (Мои голоса), в которой перечислены все пользовательские голоса, которые уже созданы.

1. Нажмите кнопку **Create voices** (Создать голоса) под названием таблицы. 

    Появится страница для создания голоса. Текущий языковой стандарт отображается в первой записи таблицы. Измените языковой стандарт, чтобы создать голос на другом языке. Языковой стандарт должен быть таким же, как и в наборах данных, используемых для создания голоса.

1. Как и при отправке набора данных, введите имя и описание, что поможет идентифицировать эту модель. 

    Тщательно выбирайте имя. Имя, которое здесь вводится, будет использоваться, чтобы указать голос в запросе на синтез речи, как часть входных данных SSML. Можно использовать только буквы, цифры и несколько знаков препинания, таких как "-", "_", "(" и ")".

    В поле **Description** (Описание) обычно записываются имена наборов данных, которые используются для создания модели.

1. Выберите пол для голоса. Он должен соответствовать полу для набора данных.

1. Выберите наборы данных, которые нужно использовать для обучения голоса. Все используемые наборы данных должны быть от одного и того же говорящего.

1. Щелкните **Создать**, чтобы начать создание голоса.

    ![Создание модели](media/custom-voice/create-model.png)

Новая модель появится в таблице **My Voice Fonts** (Мои голоса). 

![Мои голоса](media/custom-voice/my-voice-fonts.png)

Показанное состояние отражает процесс преобразования набора данных в голос, как показано ниже.

| Состояние | Значение
| ----- | -------
| `NotStarted` | Запрос на создание голоса поставлен в очередь для обработки.
| `Running` | Идет создание голоса.
| `Succeeded` | Голос создан и может быть развернут.

Время обучения зависит от объема обработанных звуковых данных. Обычный диапазон времени варьируется от 30 минут для сотен выражений до 40 часов — для 20 000 выражений.

> [!NOTE]
> Пользователи бесплатной подписки могут одновременно обучать один голос. Стандартные пользователи подписки могут одновременно обучать три голоса. Если вы достигли предела, подождите, пока хотя бы один из ваших голосов завершит обучение, а затем повторите попытку.

## <a name="test-your-voice-font"></a>Тестирование голоса

После успешного создания голос можно протестировать перед развертыванием. Выберите **Проверка** в столбце **Операции**. Для выбранного голоса отображается тестовая страница. Таблица будет пустой, если вы не отправили никаких запросов на тестирование для голоса.

Нажмите кнопку **Test with text** (Проверка с текстом) под заголовком таблицы для отображения раскрывающегося меню для отправки текстовых запросов. Можно отправить запрос на тестирование в виде обычного текста или SSML. Максимальный размер входных данных — 1024 символа, включая все теги для запроса SSML. Язык текста должен быть таким же, что и язык голоса.

После заполнения текстового поля и подтверждения режима ввода нажмите кнопку **Да**, чтобы отправить запрос на тестирование и вернуться на страницу тестирования. Теперь таблица содержит запись, соответствующую новому запросу, и столбец состояния. Синтезирование голоса может занять несколько минут. Когда в столбце появится состояние **Успешно**, можно скачать входные текстовые данные (файл `.txt`), выходные звуковые данные (файл `.wav`) и прослушать последние, чтобы оценить их качество.

## <a name="create-and-use-a-custom-endpoint"></a>Создание пользовательской конечной точки и ее использование

После того как вы успешно создали и протестировали свою голосовую модель, она развертывается в пользовательской конечной точке службы "Преобразование текста в речь". Затем эта конечная точка используется вместо обычной конечной точки при выполнении запросов службы "Преобразование текста в речь" через REST API. Пользовательская конечная точка может быть вызвана только подпиской, которая использовалась для развертывания шрифта.

Чтобы создать пользовательскую конечную точку, в меню **Custom Voice** (Пользовательские голосовые модели) в верхней части страницы выберите **Конечные точки**. Появится страница **My Deployed Voices** (Мои развернутые голоса) с таблицей текущих конечных точек пользовательских голосовых моделей, если таковые имеются. Текущий языковой стандарт отображается в первой строке таблицы. Чтобы создать развертывание для другого языка, измените отображаемый языковой стандарт. (Он должен соответствовать голосу, развертывание которого выполняется.)

Нажмите кнопку **Deploy voices** (Развернуть голоса), чтобы создать конечную точку. Введите имя и описание пользовательской конечной точки.

В меню **Подписка** выберите подписку, которую нужно использовать. Пользователи бесплатной подписки могут за раз развертывать только одну модель. Пользователи стандартной подписки могут создавать до 20 конечных точек, каждая со своим собственным голосовом.

![Создать конечную точку](media/custom-voice/create-endpoint.png)

После выбора модели, которую необходимо развернуть, щелкните **Создать**. Страница **My Deployed Voices** (Мои развернутые голоса) появится снова. Теперь на ней отобразится запись для новой конечной точки. Создание конечной точки может занять несколько минут. Если состояние развертывания — **Удачно**, конечная точка готова к использованию.

![Мои развернутые голоса](media/custom-voice/my-deployed-voices.png)

Если состояние развертывания — **Удачно**, конечная точка голоса отображается в таблице **My Deployed Voices** (Мои развернутые голоса). Этот URI можно использовать непосредственно в HTTP-запросе.

Тестирование конечной точки в сети также доступно через портал настраиваемых пользовательских голосовых моделей. Для проверки конечной точки в раскрывающемся меню **Custom Voice** (Пользовательские голосовые модели) выберите **Endpoints testing** (Тестирование конечных точек). Откроется страница тестирования конечной точки. Выберите развернутую пользовательскую голосовую модель и введите в текстовое поле текст, который необходимо произнести (в текстовом формате или в формате SSML).

> [!NOTE] 
> При использовании SSML в теге `<voice>` необходимо указать имя, данное пользовательской голосовой модели при создании. При отправке обычного текста всегда используется пользовательская голосовая модель.

Нажмите кнопку **Воспроизведение**, чтобы прослушать текст с помощью пользовательской голосовой модели.

![Тестирование конечной точки](media/custom-voice/endpoint-testing.png)

Пользовательская конечная точка функционально идентична стандартной конечной точке, используемой для запросов преобразования текста в речь. Дополнительные сведения см. в статье о [REST API](rest-apis.md).

## <a name="language-support"></a>Поддержка языков

Настройка голоса недоступна для английского языка (en US), континентального китайского (zh-CN) и итальянского (it-IT).

> [!NOTE]
> Обучение итальянского голоса начинается с набора данных, состоящего из более чем 2000 высказываний. Китайско-английские двуязычные модели также поддерживаются с помощью набора данных, состоящего из более чем 2000 высказываний.

## <a name="next-steps"></a>Дополнительная информация

- [Пробная версия Cognitive Services](https://azure.microsoft.com/try/cognitive-services/)
- [Как записывать образцы голоса для создания пользовательских голосовых моделей](record-custom-voice-samples.md)
