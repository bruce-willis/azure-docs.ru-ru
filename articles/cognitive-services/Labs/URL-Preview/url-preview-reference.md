---
title: Справочник по службе предварительного просмотра URL-адресов в проектах в Microsoft Cognitive Services | Документация Майкрософт
description: Справочная документация по конечной точке службе предварительного просмотра URL-адресов в проектах.
services: cognitive-services
author: mikedodaro
manager: rosh
ms.service: cognitive-services
ms.technology: project-url-preview
ms.topic: article
ms.date: 03/29/2018
ms.author: rosh, v-gedod
ms.openlocfilehash: 46c011d62b6ae51f5f7d292345e6ece0e27a8541
ms.sourcegitcommit: ab3b2482704758ed13cccafcf24345e833ceaff3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/06/2018
ms.locfileid: "37865881"
---
# <a name="project-url-preview-v7-reference"></a>Документация по службе предварительному просмотру URL-адресов в проектах версии 7

Службы предварительного просмотра URL-адресов отображает краткое описание веб-ресурсов, например записей в блогах, обсуждениях на форуме, страниц предварительного просмотра и т. д.  URL-адреса указывают на Интернет-ресурсы любого типа: веб-страницы, новости, изображения или видео. Запрос должен содержать абсолютный URL-адрес со схемой http или https. Относительные URL-адреса и другие схемы (например, ftp://) не поддерживаются.

Приложения, использующие API предварительного просмотра, отправляют запросы в конечную точку с URL-адресом для предварительного просмотра в параметре запроса.  Запрос должен содержать заголовок *Ocp-Apim-Subscription-Key*.   

Ответ возвращается в формате JSON. Из него можно извлечь сведения для предварительного просмотра, включая имя, описание ресурса, флаг *isFamilyFriendly*, а также ссылки для доступа к демонстрационному изображению и полному ресурсу в Интернете.

Данные полученные от службы предварительного просмотра URL-адресов, можно использовать только для предварительного отображения фрагментов кода и эскизов изображений, связанных гиперссылками с исходными сайтами, при инициированном пользователем предоставлении доступа к URL-адресам в социальных сетях, ботах и подобных предложениях. Не копируйте, не сохраняйте и не кэшируйте данные, полученные из API предварительного просмотра URL-адресов в проектах. Необходимо учитывать любые запросы на отключение службы предварительного просмотра, которые вы можете получить от владельцев веб-сайтов или содержимого.

## <a name="endpoint"></a>Конечная точка
Чтобы запросить результаты предварительного просмотра URL-адресов, отправьте запрос в следующую конечную точку. Для определения дополнительных спецификаций используйте заголовки и параметры URL-адреса.

Запрос GET к конечной точке: 
````
https://api.labs.cognitive.microsoft.com/urlpreview/v7.0/search?q=queryURL

````

Запрос должен использовать протокол HTTPS и включать следующий параметр запроса:

 q — запрос, который определяет URL-адрес для просмотра. 

В следующих разделах приведены технические сведения об объектах ответа, параметрах запроса и заголовках, которые влияют на результаты поиска. 
  
Сведения о заголовках, которые должны включать запросы, см. в разделе [Заголовки](#headers).  
  
См. дополнительные сведения [параметрах запросов](#query-parameters).  
  
См. дополнительные сведения об [объектах JSON, которые содержит ответ](#response-objects).

Максимальная длина URL-адреса запроса составляет 2048 символов. Чтобы длина вашего URL-адреса не превышала ограничение, максимальная длина ваших параметров запроса должна быть менее 1500 символов. Если длина URL-адреса превышает 2048 символов, сервер возвращает ошибку 404 (страница не найдена).  

Сведения о разрешенном использовании и отображении результатов см. в статье [Project Answer Search use and display requirements](use-display-requirements.md) (Использование и отображение требований к службе поиска ответов в проектах). 

> [!NOTE]
> Некоторые заголовки запросов, которые важны для других API поиска, не влияют на возможность предварительного просмотра URL-адресов.
> - Pragma — вызывающая сторона не влияет на то, использует ли предварительная версия URL-адреса кэш.
> - User-Agent — сейчас API предварительного просмотра URL-адресов не поддерживает разные варианты ответов для вызовов с мобильных устройств, ноутбуков и ПК.

> Кроме того, некоторые параметры сейчас не являются важными для API предварительного просмотра URL-адресов, но могут использоваться в будущем для поддержки глобализации. 
 
## <a name="headers"></a>Заголовки  
Ниже приведены заголовки, которые могут включать запрос и ответ.  
  
|Заголовок|ОПИСАНИЕ|  
|------------|-----------------|   
|<a name="market" />BingAPIs-Market|Заголовок ответа.<br /><br /> Рынок, используемый для запроса. Формат значения — \<код_языка\>-\<код_страны\>. Например, en-US.|  
|<a name="traceid" />BingAPIs-TraceId|Заголовок ответа.<br /><br /> Идентификатор записи журнала, содержащей сведения о запросе. В случае ошибки запишите этот код. Если вы не можете определить и устранить проблему, укажите этот идентификатор вместе с другой информацией в запросе к группе поддержки.|  
|<a name="subscriptionkey" />Ocp-Apim-Subscription-Key|Обязательный заголовок запроса.<br /><br /> Ключ подписки, полученный при регистрации для использования этой службы в [Cognitive Services](https://www.microsoft.com/cognitive-services/).|  
|<a name="clientid" />X-MSEdge-ClientID|Дополнительный заголовок запроса и ответа.<br /><br /> Bing использует этот заголовок для обеспечения согласованного поведения при выполнении разных вызовов Bing API. Bing часто проверяет новые функции и улучшения и использует идентификатор клиента в качестве ключа для назначения тестируемых возможностей. Если вы не используете один и тот же идентификатор клиента для нескольких запросов, Bing может назначить одному пользователю несколько конфликтующих функций. Назначение таких проверяемых возможностей может привести к несогласованному взаимодействию с пользователем. Например, если для второго запроса будет назначена другая проверяемая возможность, результат будет неожиданным для пользователя. Кроме того, Bing может использовать идентификатор клиента, чтобы адаптировать результаты веб-поиска к истории поиска этого идентификатора, обеспечивая более широкие возможности взаимодействия с пользователем.<br /><br /> Bing также использует этот заголовок, чтобы повысить рейтинг результатов путем анализа активности, создаваемой идентификатором клиента. Повышение релевантности помогает улучшить качество результатов, предоставляемых API Bing, что, в свою очередь, обеспечивает более быстрые переходы по ссылкам для потребителей API.<br /><br />Ниже приведены базовые правила использования, применяемые к этому заголовку.<br /><ul><li>Каждый пользователь, использующий приложение на устройстве, должен иметь уникальный идентификатор клиента Bing.<br /><br/>Если этот заголовок не включается в запрос, Bing создает идентификатор и возвращает его в заголовке ответа X-MSEdge-ClientID. Этот заголовок не следует включать в запрос, только когда пользователь в первый раз использует приложение на этом устройстве.<br /><br/></li><li>Используйте идентификатор клиента при каждом запросе к API Bing от приложения для определенного пользователя на определенном устройстве.<br /><br/></li><li>**ВНИМАНИЕ!** Нужно убедиться, что этот идентификатор клиента никак не связан с информацией учетной записи пользователя, используемой для аутентификации.</li><br/><li>Сохраните идентификатор клиента. Чтобы сохранить идентификатор в приложении браузера, нужен постоянный файл cookie HTTP, что гарантирует использование идентификатора во всех сеансах. Не используйте файл cookie сеанса. В других приложениях, таких как мобильные приложения, для хранения идентификатора можно использовать постоянное хранилище устройства.<br /><br/>В следующий раз, когда пользователь будет использовать приложение на этом устройстве, извлеките сохраненный идентификатор клиента.</li></ul><br /> **Примечание.** Ответы Bing могут как включать, так и не включать этот заголовок. Если ответ включает этот заголовок, сохраните идентификатор клиента и используйте его для всех последующих запросов Bing для пользователя на этом устройстве.<br /><br /> **Примечание.** Если в запрос включен заголовок X-MSEdge-ClientID, этот запрос не должен содержать файлы cookie.|  
|<a name="clientip" />X-MSEdge-ClientIP|Дополнительный заголовок запроса.<br /><br /> IPv4-адрес или IPv6-адрес клиентского устройства. IP-адрес используется для обнаружения расположения пользователя. Bing использует сведения о расположении для выбора безопасного поведения поиска.<br /><br />  Не маскируйте адрес (например, изменив последний октет на 0). Маскировка адреса приводит к тому, что определяется расположение, отдаленное от фактического расположения устройства. В результате Bing может выводить ошибочные результаты.|  
<br /><br /></li></ul>   

## <a name="query-parameters"></a>Параметры запроса  
Запрос может включать следующие параметры запроса. В столбце "Обязательно" отмечены обязательные параметры. К параметрам запроса нужно применить кодировку URL. Запрос должен содержать абсолютный URL-адрес со схемой http или https. Мы пока не поддерживаем относительные URL-адреса и другие схемы (например, ftp://).
  
  
|ИМЯ|Значение|type|Обязательно|  
|----------|-----------|----------|--------------|  
|<a name="mkt" />mkt|Рынок, по которому возвращаются результаты. <br /><br />Список возможных значений рынка см. в разделе [Коды рынка](#market-codes).<br /><br /> **ПРИМЕЧАНИЕ.** Сейчас API предварительного просмотра URL-адресов поддерживает только рынок США и английский язык.<br /><br />|Строка|Yes|  
|<a name="query" />q|URL-адрес для предварительного просмотра|Строка|Yes|  
|<a name="responseformat" />responseFormat|Тип мультимедиа, используемый для ответа. Ниже приведены возможные значения, в которых не учитывается регистр.<br /><ul><li>JSON</li><li>JSONLD</li></ul><br /> По умолчанию используется JSON. Сведения об объектах JSON, которые содержат ответ, см. в разделе [Объекты ответа](#response-objects).<br /><br />  При указании JsonLd текст ответа включает объекты JSON-LD, содержащие результаты поиска. Сведения о JSON-LD см. на [этом сайте](http://json-ld.org/).|Строка|Нет |
|<a name="safesearch"/>safeSearch|Недопустимое содержимое для взрослых или пиратское содержимое будет заблокировано с кодом ошибки 400, при этом флаг *isFamilyFriendly* не возвращается. <p>Ниже описано поведение, применяемое к разрешенному содержимому для взрослых. Возвращается код состояния 200, а флаг *isFamilyFriendly* имеет значение False.<ul><li>safeSearch = strict: не возвращаются заголовок, описание, URL-адрес и изображение.</li><li>safeSearch=moderate: возвращаются заголовок, URL-адрес и описание, но не изображение.</li><li>safeSearch = off: возвращаются все объекты и элементы ответа — заголовок, URL-адрес, описание и изображение.</li></ul> |Строка|Необязательно. </br> По умолчанию используется значение safeSearch = strict.| 

## <a name="response-objects"></a>Объекты ответа  
Схема ответа — либо [WebPage], либо ErrorResponse, как для API поиска в Интернете. Если запрос завершается с ошибкой, то объектом верхнего уровня будет являться [ErrorResponse](#errorresponse).


|Объект.|ОПИСАНИЕ|  
|------------|-----------------|  
|[WebPage](#webpage)|Объект верхнего уровня JSON, содержащий атрибуты предварительного просмотра.|  

  
### <a name="error"></a>Ошибка  
Определяет возникшую ошибку.  
  
|Элемент|ОПИСАНИЕ|type|  
|-------------|-----------------|----------|  
|<a name="error-code" />code|Код ошибки, определяющий ее категорию. Список возможных кодов см. в разделе [Коды ошибок](#error-codes).|Строка|  
|<a name="error-message" />message|Текстовое описание ошибки.|Строка|  
|<a name="error-moredetails" />moreDetails|Подробное описание, которое предоставляет дополнительную информацию об ошибке.|Строка|  
|<a name="error-parameter" />parameter|Параметр запроса, который вызвал эту ошибку.|Строка|  
|<a name="error-subcode" />subCode|Код ошибки, по которому определяется ошибка. Например, если `code` имеет значение InvalidRequest, то `subCode` может иметь значение ParameterInvalid или ParameterInvalidValue. |Строка|  
|<a name="error-value" />value|Недопустимое значение параметра запроса.|Строка|  
  

### <a name="errorresponse"></a>ErrorResponse  
Объект верхнего уровня, который включается ответ при сбое обработки запроса.  
  
|ИМЯ|Значение|type|  
|----------|-----------|----------|  
|_type|Указание типа.|Строка|  
|<a name="errors" />errors|Список ошибок, описывающих причины сбоя запроса.|[Error](#error)[]|   
  

### <a name="webpage"></a>WebPage  
Определяет сведения о веб-странице, для которой выполнялся предварительный просмотр.  
  
|ИМЯ|Значение|type|  
|----------|-----------|----------|
|name|Заголовок страницы, не обязательно заголовок HTML|Строка|
|URL-адрес|URL-адрес, который фактически проверялся (запрос может обрабатываться с учетом перенаправлений)|Строка|  
|description|Краткое описание страницы и содержимого|Строка|  
|isFamilyFriendly|Наиболее точно для элементов в веб-индексе. В режиме реального времени это обнаружение основано исключительно на URL-адресе, а не на содержимом страницы.|Логическое|
|primaryImageOfPage/contentUrl|URL-адрес примера изображения для включения в предварительный просмотр|Строка| 


### <a name="identifiable"></a>Identifiable
|ИМЯ|Значение|type|  
|-------------|-----------------|----------|
|id|Идентификатор ресурса|Строка|
 

## <a name="error-codes"></a>Коды ошибок

Ниже приведены возможные коды состояния HTTP, которые возвращает запрос.  
  
|Код состояния|ОПИСАНИЕ|  
|-----------------|-----------------|  
|200|Успешно.|  
|400|Один из параметров запроса отсутствует или является недопустимым.| 
|400|ServerError, дополнительный код ResourceError: не удалось подключиться к запрошенному URL-адресу|
|400|ServerError, дополнительный код ResourceError: запрошенный URL-адрес не вернул код успешного завершения (сюда включается и ошибка HTTP 404)|
|400|InvalidRequest, дополнительный код Blocked: запрошенный URL-адрес заблокирован, так как он может содержать содержимое только для взрослых| 
|401|Ключ подписки отсутствует или является недопустимым.|  
|403|Пользователь прошел проверку подлинности (например, с допустимым ключом подписки), но не имеет разрешений для обращения к запрошенному ресурсу.<br /><br /> Bing также может вернуть это состояние, если для вызывающего объекта превышены месячные квоты.|  
|410|В запросе использовался протокол HTTP вместо HTTPS. HTTPS является единственным поддерживаемым протоколом.|  
|429|Вызывающий превысил свою квоту на число запросов в секунду.|  
|500|Непредвиденная ошибка сервера.|

Если запрос завершается с ошибкой, ответ будет содержать объект [ErrorResponse](#errorresponse), который содержит список объектов [Error](#error), описывающих причину ошибки. Если ошибка связана с параметром, поле `parameter` идентифицирует параметр, который является причиной проблемы. Если ошибка связана со значением параметра, поле `value` идентифицирует недопустимое значение.

```json
{
  "_type": "ErrorResponse", 
  "errors": [
    {
      "code": "InvalidRequest", 
      "subCode": "ParameterMissing", 
      "message": "Required parameter is missing.", 
      "parameter": "q" 
    }
  ]
}

{
  "_type": "ErrorResponse", 
  "errors": [
    {
      "code": "InvalidAuthorization", 
      "subCode": "AuthorizationMissing", 
      "message": "Authorization is required.", 
      "moreDetails": "Subscription key is not recognized."
    }
  ]
}
```

Ниже приведены возможные коды ошибок и кодовые значения вложенных ошибок.

|Код|SubCode (дополнительный код)|ОПИСАНИЕ
|-|-|-
|ServerError|UnexpectedError<br/>ResourceError<br/>NotImplemented|Код состояния HTTP — 500.
|InvalidRequest|ParameterMissing<br/>ParameterInvalidValue<br/>HttpNotAllowed<br/>Заблокировано|Bing возвращает ошибку InvalidRequest (недопустимый запрос) всякий раз, когда любая часть запроса является недопустимой. Например, отсутствует обязательный параметр или значение параметра является недопустимым.<br/><br/>В случае ошибки ParameterMissing или ParameterInvalidValue возвращается код состояния HTTP 400.<br/><br/>Если вместо HTTPS используется протокол HTTP, Bing возвращает HttpNotAllowed и код состояния HTTP 410.
|RateLimitExceeded|Дополнительные коды не используются|Bing возвращает ошибку RateLimitExceeded всякий раз при превышении квоты запросов в секунду (QPS) или запросов в месяц (QPM).<br/><br/>При превышении QPS Bing возвращает код состояния HTTP 429, а если превысить QPM, Bing вернет код 403.
|InvalidAuthorization|AuthorizationMissing<br/>AuthorizationRedundancy|Bing возвращает InvalidAuthorization, если не может выполнить аутентификацию вызывающего объекта. Например, когда отсутствует заголовок `Ocp-Apim-Subscription-Key` или указан недопустимый ключ подписки.<br/><br/>Избыточность возникает, если указать более одного способа аутентификации.<br/><br/>При ошибке InvalidAuthorization возвращается код состояния HTTP 401.
|InsufficientAuthorization|AuthorizationDisabled<br/>AuthorizationExpired|Bing возвращает InsufficientAuthorization, когда вызывающая сторона не имеет разрешений на доступ к ресурсу. Это может произойти, если ключ подписки отключен или срок его действия истек. <br/><br/>При ошибке InsufficientAuthorization возвращается код состояния HTTP 403.

## <a name="next-steps"></a>Дополнительная информация
- [Краткое руководство — C#](csharp.md)
- [Краткое руководство — Java](java-quickstart.md)
- [Краткое руководство — JavaScript](javascript.md)
- [Краткое руководство — Node](node-quickstart.md)
- [Project Answer Search Python quickstart](python-quickstart.md) (Краткое руководство по запросам Python в службе поиска ответов в проекте)

