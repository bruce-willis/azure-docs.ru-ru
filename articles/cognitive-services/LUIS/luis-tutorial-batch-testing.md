---
title: Улучшение прогнозирований LUIS с помощью пакетного тестирования | Документы Майкрософт
titleSuffix: Azure
description: Выполняйте пакетное тестирование, просматривайте результаты и улучшайте прогнозирования LUIS с помощью изменений.
services: cognitive-services
author: diberry
manager: cjgronlund
ms.service: cognitive-services
ms.component: language-understanding
ms.topic: article
ms.date: 08/02/2018
ms.author: diberry
ms.openlocfilehash: e907a1f5ad8e75e018149e53ae0c2f9faff10a89
ms.sourcegitcommit: eaad191ede3510f07505b11e2d1bbfbaa7585dbd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2018
ms.locfileid: "39493111"
---
# <a name="improve-app-with-batch-test"></a>Улучшение приложения с помощью пакетного тестирования

В этом руководстве содержатся сведения по использованию пакетного тестирования для поиска проблем прогнозирования.  

Из этого руководства вы узнаете, как выполнять следующие задачи:

<!-- green checkmark -->
> [!div class="checklist"]
* Создание файла пакетного теста 
* Выполнение пакетного теста
* Просмотр результатов теста
* Исправление ошибок 
* Повторное тестирование пакета

[!include[LUIS Free account](../../../includes/cognitive-services-luis-free-key-short.md)]

## <a name="before-you-begin"></a>Перед началом работы

Если у вас нет приложения по управлению персоналом из раздела [Руководство. Проверка фрагментов речи конечной точки](luis-tutorial-review-endpoint-utterances.md), [импортируйте](luis-how-to-start-new-app.md#import-new-app) файл в формате JSON в новое приложение на веб-сайте [LUIS](luis-reference-regions.md#luis-website). Приложение, которое следует импортировать, находится в репозитории Github [LUIS-Samples](https://github.com/Microsoft/LUIS-Samples/blob/master/documentation-samples/quickstarts/custom-domain-review-HumanResources.json).

Чтобы сохранить исходное приложение по управлению персоналом, клонируйте версию приложения на странице [Параметры](luis-how-to-manage-versions.md#clone-a-version) и назовите ее `batchtest`. Клонирование — это отличный способ поэкспериментировать с различными функциями LUIS без влияния на исходную версию. 

Обучите приложение.

## <a name="purpose-of-batch-testing"></a>Цель пакетного тестирования

Пакетное тестирование позволяет проверить состояние активной, обученной модели с известным набором помеченных высказываний и сущностей. В пакетном файле в формате JSON добавьте высказывания и установите метки сущностей, которые нужно спрогнозировать внутри высказывания. 

<!--The recommended test strategy for LUIS uses three separate sets of data: example utterances provided to the model, batch test utterances, and endpoint utterances. --> При использовании приложения, которое отличается от этого руководства, убедитесь, что вы *не* используете примеры высказываний, уже добавленных в намерение. Чтобы проверить высказывания пакетного тестирования по сравнению с примерами высказываний, [экспортируйте](luis-how-to-start-new-app.md#export-app) приложение. Сравните пример высказывания приложения с высказываниями пакетного тестирования. 

Требования к пакетному тестированию.

* Не более 1000 высказываний за тест. 
* Без дубликатов. 
* Разрешенные типы сущностей: только машинно-обученные сущности простых, иерархических (только родительских) и составных сущностей. Пакетное тестирование полезно только для машинно-обученных намерений и сущностей.

## <a name="create-a-batch-file-with-utterances"></a>Создание пакетного файла с высказываниями

1. Создайте `HumanResources-jobs-batch.json` в текстовом редакторе, таком как [VSCode](https://code.visualstudio.com/). 

2. В пакетный файл в формате JSON добавьте высказывания с **намерением**, которое должно быть спрогнозировано в тесте. 

   [!code-json[Add the intents to the batch test file](~/samples-luis/documentation-samples/tutorial-batch-testing/HumanResources-jobs-batch.json "Add the intents to the batch test file")]

## <a name="run-the-batch"></a>Запуск пакетного теста

1. Нажмите кнопку **Test** (Тестировать) в верхней панели навигации. 

2. На правой панели щелкните ссылку **Batch testing panel** (Панель пакетного тестирования). 

    [![Снимок экрана приложения LUIS с выделенной ссылкой "Batch testing panel" (Панель пакетного тестирования)](./media/luis-tutorial-batch-testing/hr-batch-testing-panel-link.png)](./media/luis-tutorial-batch-testing/hr-batch-testing-panel-link.png#lightbox)

3. Нажмите кнопку **Import dataset** (Импортировать набор данных).

    [![Снимок экрана приложения LUIS с выделенной кнопкой "Import dataset" (Импортировать набор данных)](./media/luis-tutorial-batch-testing/hr-import-dataset-button.png)](./media/luis-tutorial-batch-testing/hr-import-dataset-button.png#lightbox)

4. Выберите расположение файловой системы для файла `HumanResources-jobs-batch.json`.

5. Назовите набор данных `intents only` и выберите **Готово**.

    ![Выбор файла](./media/luis-tutorial-batch-testing/hr-import-new-dataset-ddl.png)

6. Нажмите кнопку **Запустить**. Дождитесь завершения теста.

7. Щелкните **See results** (Просмотреть результаты).

8. Просмотрите результаты на диаграмме и в условных обозначениях.

    [![Снимок экрана приложения LUIS с результатами пакетного тестирования](./media/luis-tutorial-batch-testing/hr-intents-only-results-1.png)](./media/luis-tutorial-batch-testing/hr-intents-only-results-1.png#lightbox)

## <a name="review-batch-results"></a>Просмотр результатов пакетного тестирования

Пакетная диаграмма отображает четыре квадранта результатов. В правой части диаграммы находится фильтр. По умолчанию фильтр устанавливается в первом намерении в списке. Фильтр содержит все намерения и только простые, иерархические (только родительские) и составные сущности. При выборе [раздела диаграммы](luis-concept-batch-test.md#batch-test-results) или точки внутри диаграммы соответствующие высказывания отображаются под диаграммой. 

При наведении курсора на диаграмму с помощью колеса мыши можно увеличить или уменьшить отображение. Это полезно в тех случаях, когда на диаграмме собрано много плотно сгруппированных точек. 

Диаграмма состоит из четырех квадрантов, два из которых выделены красным цветом. **Это разделы, требующие внимания**. 

### <a name="getjobinformation-test-results"></a>Результаты теста GetJobInformation

Результаты теста **GetJobInformation**, отображаемые в фильтре, показывают, что 2 из четырех прогнозов были успешными. Выберите имя **False positive** (Ложное срабатывание) над верхним правым квадрантом, чтобы увидеть высказывания под диаграммой. 

![Высказывания пакетного тестирования службы LUIS](./media/luis-tutorial-batch-testing/hr-applyforjobs-false-positive-results.png)

Почему два высказывания спрогнозированы как **ApplyForJob** вместо правильного намерения **GetJobInformation**? Эти два намерения очень тесно связаны с выбором и расположением слов. Кроме того, существует почти в три раза больше примеров для **ApplyForJob**, чем для **GetJobInformation**. Эта неравномерность примеров высказываний взвешивается в намерении **ApplyForJob**. 

Обратите внимание, что оба намерения имеют одинаковое количество ошибок. Неправильное прогнозирование в одном намерении также влияет на другое намерение. Они оба имеют ошибки, потому что высказывания были неправильно спрогнозированы для обоих намерений. 

![Ошибки фильтра пакетного тестирования службы LUIS](./media/luis-tutorial-batch-testing/hr-intent-error-count.png)

Высказывания, соответствующие верхней точке в разделе **Ложное срабатывание**, являются `Can I apply for any database jobs with this resume?` и `Can I apply for any database jobs with this resume?`. Для первого высказывания слово `resume` использовалось только в **ApplyForJob**. Для второго высказывания слово `apply` использовалось только в намерении **ApplyForJob**.

## <a name="fix-the-app-based-on-batch-results"></a>Исправление приложения на основе результатов пакетного тестирования

Цель этого раздела — правильно спрогнозировать все высказывания для **GetJobInformation**, исправляя приложение. 

По-видимому, быстрое исправление заключается в том, чтобы добавить эти высказывания пакетного файла к правильному намерению. Это не то, что нужно сделать. Нужно, чтобы служба LUIS правильно спрогнозировала эти высказывания, не добавляя их в качестве примеров. 

Могут также возникнуть вопросы об удалении высказываний из **ApplyForJob**, пока количество высказываний не будет таким же, как у **GetJobInformation**. Это может исправить результаты тестирования, но препятствует службе LUIS точно спрогнозировать это намерение в следующий раз. 

Первый способ исправления заключается в добавлении дополнительных высказываний в **GetJobInformation**. Второй способ заключается в уменьшении веса слов типа `resume` и `apply` по отношению к намерению **ApplyForJob**. 

### <a name="add-more-utterances-to-getjobinformation"></a>Добавление дополнительных высказываний в **GetJobInformation**

1. Закройте панель пакетного тестирования, нажав кнопку **Test** (Тестирование) на верхней панели навигации. 

2. Выберите **GetJobInformation** из списка намерений. 

3. Добавьте дополнительные высказывания, которые различаются по длине, подбору и расположению слов, поэтому обязательно включайте термины `resume`, `c.v.` и `apply`.

    |Примеры высказываний для намерения **GetJobInformation**|
    |--|
    |Does the new job in the warehouse for a stocker require that I apply with a resume?|
    |Where are the roofing jobs today?|
    |I heard there was a medical coding job that requires a resume.|
    |I would like a job helping college kids write their c.v.s. |
    |Here is my resume, looking for a new post at the community college using computers.|
    |What positions are available in child and home care?|
    |Is there an intern desk at the newspaper?|
    |My C.v. shows I'm good at analyzing procurement, budgets, and lost money. Is there anything for this type of work?|
    |Where are the earth drilling jobs right now?|
    |I've worked 8 years as an EMS driver. Any new jobs?|
    |New food handling jobs require application?|
    |How many new yard work jobs are available?|
    |Is there a new HR post for labor relations and negotiations?|
    |I have a masters in library and archive management. Any new positions?|
    |Are there any babysitting jobs for 13 year olds in the city today?|

    Не отмечайте сущность **Job** в высказываниях. Этот раздел руководства ориентирован только на прогнозирование намерения.

4. Обучите приложение, выбрав **Train** (Обучать) в правом верхнем углу.

## <a name="verify-the-fix-worked"></a>Проверка применения исправления

Чтобы проверить правильность прогнозирования высказываний пакетного тестирования, запустите пакетный тест еще раз.

1. Нажмите кнопку **Test** (Тестировать) в верхней панели навигации. Если результаты пакетного тестирования по-прежнему открыты, выберите **Назад к списку**.  

2. Нажмите кнопку многоточия (***...***) справа от имени пакета и выберите пункт **Run Dataset** (Запустить набор данных). Дождитесь завершения пакетного теста. Обратите внимание, что кнопка **See results** (Просмотреть результаты) теперь зеленого цвета. Это означает, что весь пакет успешно выполнен.

3. Щелкните **See results** (Просмотреть результаты). У всех намерений должны быть зеленые значки слева от имен. 

    ![Снимок экрана службы LUIS с выделенной кнопкой результатов пакетного тестирования](./media/luis-tutorial-batch-testing/hr-batch-test-intents-no-errors.png)

## <a name="create-batch-file-with-entities"></a>Создание пакетного файла с сущностями 

Чтобы проверить сущности в пакетном тесте, они должны быть помечены в пакетном файле в формате JSON. Используются только машинно-обученные сущности: простые, иерархические (только родительские) и составные. Не добавляйте машинно-необученные сущности, потому что они всегда встречаются либо с помощью регулярных выражений, либо с явным текстовым совпадением.

Изменение сущности для общего количества слов ([токенов](luis-glossary.md#token)) может повлиять на качество прогнозирования. Удостоверьтесь, что данные обучения, предоставленные намерению с помеченными высказываниями, включают в себя множество длин сущности. 

При первом написании и тестировании пакетных файлов лучше всего начать с нескольких высказываний и сущностей, которые, как вы знаете, работают, а также нескольких, которые, по вашему мнению, могут быть неправильно спрогнозированы. Это поможет быстро сосредоточиться на проблемных областях. После тестирования намерений **GetJobInformation** и **ApplyForJob** с использованием нескольких разных имен сущности Job, которые не были спрогнозированы, этот файл пакетного тестирования был разработан для того, чтобы увидеть, есть ли проблема с прогнозированием определенных значений для сущности **Job**. 

Значение сущности **задания**, представленное в тестовых высказываниях, обычно является одним или двумя словами, в нескольких примерах больше слов. Если _ваше собственное_ приложение по управлению персоналом обычно имеет имена заданий, составленные с нескольких слов, примеры высказываний с меткой **Job**  в этом приложении не будут работать хорошо.

1. Создайте `HumanResources-entities-batch.json` в текстовом редакторе, таком как [VSCode](https://code.visualstudio.com/). Или загрузите [файл](https://github.com/Microsoft/LUIS-Samples/blob/master/documentation-samples/tutorial-batch-testing/HumanResources-entities-batch.json) из репозитория LUIS-Samples Github.


2. В пакетном файле в формате JSON добавьте массив объектов, которые включают высказывания с **намерением**, которое необходимо спрогнозировать во время тестирования, а также местоположения любых сущностей в высказывании. Поскольку сущность основана на токенах, обязательно запускайте и останавливайте каждую сущность на символе. Не начинайте или заканчивайте высказывание пробелом. Это приводит к ошибке во время импорта пакетного файла.  

   [!code-json[Add the intents and entities to the batch test file](~/samples-luis/documentation-samples/tutorial-batch-testing/HumanResources-entities-batch.json "Add the intents and entities to the batch test file")]


## <a name="run-the-batch-with-entities"></a>Запустите пакетный тест с сущностями

1. Нажмите кнопку **Test** (Тестировать) в верхней панели навигации. 

2. На правой панели щелкните ссылку **Batch testing panel** (Панель пакетного тестирования). 

3. Нажмите кнопку **Import dataset** (Импортировать набор данных).

4. Выберите расположение файловой системы для файла `HumanResources-entities-batch.json`.

5. Назовите набор данных `entities` и выберите **Готово**.

6. Нажмите кнопку **Запустить**. Дождитесь завершения теста.

7. Щелкните **See results** (Просмотреть результаты).

## <a name="review-entity-batch-results"></a>Просмотр результатов пакетного тестирования сущностей

Диаграмма открывается со всеми намерениями, которые были правильно спрогнозированы. Прокрутите вниз фильтр справа, чтобы найти прогнозирования ошибочных сущностей. 

1. Выберите сущность **Job** в фильтре.

    ![Ошибочные прогнозирования сущностей в фильтре](./media/luis-tutorial-batch-testing/hr-entities-filter-errors.png)

    Диаграмма изменяется, чтобы отобразить прогнозирование сущностей. 

2. Выберите **False Negative** (Ложный отрицательный результат) в левом нижнем квадранте диаграммы. Затем нажмите клавиши CTRL + Е для переключения в представление токена. 

    [![Представление токена прогнозирования сущностей](./media/luis-tutorial-batch-testing/token-view-entities.png)](./media/luis-tutorial-batch-testing/token-view-entities.png#lightbox)
    
    При просмотре высказываний под диаграммой появляется непротиворечивая ошибка, когда имя задания включает `SQL`. Рассматривая примеры высказываний и список фраз Job, SQL используется только один раз и только как часть более крупного имени задания `sql/oracle database administrator`.

## <a name="fix-the-app-based-on-entity-batch-results"></a>Исправление приложения на основе результатов пакетного тестирования сущностей

Исправление приложения требует, чтобы служба LUIS правильно определяла варианты задания SQL. Существует несколько вариантов исправления. 

* Явным образом добавьте несколько примеров высказываний, которые используют SQL и помечают эти слова в качестве сущности Job. 
* Явным образом добавьте дополнительные задания SQL в список фраз

Эти задачи оставлены для вас.

Добавление [шаблона](luis-concept-patterns.md) до того, как сущность будет правильно спрогнозирована, не решит проблему. Это связано с тем, что шаблон не будет соответствовать, пока не будут обнаружены все сущности в шаблоне. 

## <a name="what-has-this-tutorial-accomplished"></a>Какие результаты работы с этим руководством?

Точность прогнозирования приложения увеличилась путем поиска ошибок в пакете и исправления модели. 

## <a name="clean-up-resources"></a>Очистка ресурсов

[!include[LUIS How to clean up resources](../../../includes/cognitive-services-luis-tutorial-how-to-clean-up-resources.md)]

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Tutorial: Improve app with pattern roles](luis-tutorial-pattern.md) (Руководство. Улучшение приложения с ролями шаблонов)

