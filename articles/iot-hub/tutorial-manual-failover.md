---
title: Ручная отработка отказа центра Интернета вещей Azure | Документация Майкрософт
description: Описывается выполнение ручной отработки отказа центра Интернета вещей Azure
author: robinsh
manager: timlt
ms.service: iot-hub
services: iot-hub
ms.topic: tutorial
ms.date: 07/11/2018
ms.author: robinsh
ms.custom: mvc
ms.openlocfilehash: f0e8bf922f142b795dd1a2ded4b3ec265c43481a
ms.sourcegitcommit: 156364c3363f651509a17d1d61cf8480aaf72d1a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/25/2018
ms.locfileid: "39250061"
---
# <a name="tutorial-perform-manual-failover-for-an-iot-hub-public-preview"></a>Руководство. Выполнение ручной отработки отказа центра Интернета вещей Azure (предварительная версия)

Ручная отработка отказа — это функция службы Центра Интернета вещей, которая позволяет клиентам [отрабатывать отказ](https://en.wikipedia.org/wiki/Failover) концентратора операций из основного региона в соответствующий географически связанный регион Azure. Ручная отработка отказа может выполняться в случае региональной аварии или при длительном сбое службы. Также можно выполнять плановую отработку отказа для проверки возможности аварийного восстановления, но рекомендуется использовать тестовый Центр Интернета вещей вместо рабочего. Функция ручной отработки отказа предоставляется клиентам без каких-либо дополнительных затрат.

Вот какие шаги выполняются в этом руководстве:

> [!div class="checklist"]
> * Создание центра Интернета вещей с помощью портала Azure. 
> * Выполнение отработки отказа. 
> * Запуск концентратора в дополнительном расположении.
> * Восстановление размещения для возврата операций центра Интернета вещей в основное расположение. 
> * Подтверждение правильной работы концентратора в нужном расположении.

## <a name="prerequisites"></a>Предварительные требования

- Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="create-an-iot-hub"></a>Создание Центра Интернета вещей

1. Войдите на [портал Azure](https://portal.azure.com). 

2. Щелкните **+ Создать ресурс** и выберите **Интернет вещей**, затем **Центр Интернета вещей**.

   ![Снимок показывающий создание центра Интернета вещей](./media/tutorial-manual-failover/create-hub-01.png)

3. Выберите вкладку **Основы**. Заполните следующие поля.

    **Подписка**. Выберите подписку Azure, которую необходимо использовать.

    **Группа ресурсов**. Щелкните **Создать** и укажите в поле для имени группы ресурсов **ManlFailRG**.

    **Регион**. Выберите близкий регион, который является частью предварительной версии. В этом руководстве используется `westus2`. Отработка отказа может выполняться только между географически связанными регионами Azure. Регион, географически связанный с westus2 — это WestCentralUS.
    
   > [!NOTE]
   > В настоящее время ручная отработка отказа находится в общедоступной предварительной версии и является *недоступной* в следующих регионах Azure: восточная часть США, западная часть США, Северная Европа, Западная Европа, Южная Бразилия и Юго-центральная часть США.

   **Имя центра IoT**. Укажите имя Центра Интернета вещей. Имя концентратора должно быть глобально уникальным. 

   ![Снимок экрана, показывающий основные сведения для создания Центра Интернета вещей](./media/tutorial-manual-failover/create-hub-02-basics.png)

   Щелкните **Review + create** (Просмотреть и создать). (Значения для размера и масштаба используются по умолчанию.) 

4. Просмотрите информацию, затем щелкните **Создать**, чтобы создать центр Интернета вещей. 

   ![Снимок экрана, показывающий последний шаг для создания центра Интернета вещей](./media/tutorial-manual-failover/create-hub-03-create.png)

## <a name="perform-a-manual-failover"></a>Выполнение ручной отработки отказа

Обратите внимание, что для центра Интернета вещей установлено ограничение: две отработки отказа и два восстановления размещений в день.

1. Щелкните **Группы ресурсов** и выберите группу ресурсов **ManlFailRG**. В списке ресурсов выберите концентратор. 

2. В разделе **Устойчивость** на панели Центра Интернета вещей выберите **Ручная отработка отказа (предварительная версия)**. Обратите внимание, что если концентратор не настроен в допустимом регионе, функция ручной отработки отказа будет отключена.

   ![Снимок экрана, показывающий область свойств Центра Интернета вещей](./media/tutorial-manual-failover/trigger-failover-01.png)

3. На панели ручной отработки отказа можно увидеть **Основное расположение Центра IoT** и **Дополнительное расположение Центра IoT**. Основное расположение изначально установлено в том месте, которое было указано при создании центра Интернета вещей, и всегда указывает расположение, в котором концентратор активен в данный момент. Дополнительное расположение — это стандартный [географически связанный регион Azure](../best-practices-availability-paired-regions.md), который находится в паре с основным расположением. Расположение изменить невозможно. Для этого руководства основное расположение — это `westus2`, а дополнительное расположение — `WestCentralUS`.

   ![Снимок экрана, показывающий панель ручной отработки отказа](./media/tutorial-manual-failover/trigger-failover-02.png)

3. В верхней части панели ручной отработки отказа щелкните **Запустить отработку отказа**. Вы увидите панель **Подтверждение ручной отработки отказа**. Для подтверждения введите имя центра Интернета вещей, для которого необходимо выполнить отработку отказа. Чтобы начать отработку отказа, нажмите **OK**.

   Время, необходимое для выполнения ручной отработки отказа, пропорционально количеству устройств, зарегистрированных для концентратора. Например, для 100 000 устройств понадобится 15 минут, но если имеется пять миллионов устройств, отработка отказа может занять час или больше.

4. На панели **Подтверждение ручной отработки отказа** введите имя центра Интернета вещей, для которого необходимо выполнить отработку отказа. Чтобы начать отработку отказа, нажмите OK. 

   ![Снимок экрана, показывающий панель ручной отработки отказа](./media/tutorial-manual-failover/trigger-failover-03-confirm.png)

   Во время выполнения процесса ручной отработки отказа на панели появляется баннер, в котором сообщается, что выполняется ручная отработка отказа. 

   ![Снимок, показывающий процесс выполнения ручной отработки отказа](./media/tutorial-manual-failover/trigger-failover-04-in-progress.png)

   Если закрыть панель центра Интернета вещей и, щелкнув ее на панели "Группа ресурсов", открыть ее снова, появится баннер, который сообщает, что концентратор неактивен. 

   ![Снимок, показывающий неактивный Центр Интернета вещей](./media/tutorial-manual-failover/trigger-failover-05-hub-inactive.png)

   После завершения ручной отработки отказа основной и дополнительный регионы на странице "Ручная отработка отказа" поменяются местами и концентратор снова активируется. В этом примере основное расположение теперь находится в `WestCentralUS`, а дополнительное расположение в — `westus2`. 

   ![Снимок, показывающий завершение отработки отказа](./media/tutorial-manual-failover/trigger-failover-06-finished.png)

## <a name="perform-a-failback"></a>Восстановление размещения 

После выполнения отработки отказа вручную можно переключить операции концентратора обратно в исходную основную область. Это называется восстановлением размещения. Если отработка отказа была выполнена только что, прежде чем запросить восстановление размещения, необходимо подождать около часа. Если же выполнить восстановление размещения не подождав это время, появится сообщение об ошибке.

Восстановление размещения выполняется так же, как ручная отработка отказа. Шаги описаны ниже. 

1. Чтобы выполнить восстановление размещения, вернитесь на панель центра Интернета вещей.

2. В разделе **Устойчивость** на панели Центра Интернета вещей выберите **Ручная отработка отказа (предварительная версия)**. 

3. В верхней части панели ручной отработки отказа щелкните **Запустить отработку отказа**. Вы увидите панель **Подтверждение ручной отработки отказа**. 

4. На панели **Подтверждение ручной отработки отказа** введите имя центра Интернета вещей, для которого необходимо выполнить восстановление размещения. Чтобы начать восстановление размещения, нажмите OK. 

   ![Снимок, показывающий запрос на ручное восстановление размещения](./media/tutorial-manual-failover/trigger-failback-01-regions.png)

   Баннеры отображаются, как описано в разделе [Tutorial: Perform manual failover for an IoT hub (public preview)](#perform-a-failover) (Руководство. Выполнение ручной отработки отказа Центра Интернета вещей Azure (предварительная версия)). После завершения восстановления размещения еще раз отображается баннер `westus2`, как основное расположение, и баннер `WestCentralUS` в качестве дополнительного расположения, как было установлено изначально.

## <a name="clean-up-resources"></a>Очистка ресурсов 

Чтобы удалить все ресурсы, которые были созданы в этом руководстве, удалите группу ресурсов. При этом будут также удалены все ресурсы, содержащиеся в группе. В этом случае происходит удаление центра Интернета вещей и самой группы ресурсов. 

1. Щелкните раздел **Группа ресурсов**. 

2. Найдите и выберите группу ресурсов **ManlFailRG**. Щелкните ее, чтобы открыть. 

3. Щелкните **Удалить группу ресурсов**. Когда появится запрос, введите имя группы ресурсов и нажмите кнопку **Удалить**. 

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как настроить и выполнить ручную отработку отказа и как запросить восстановление размещения, выполнив следующие задачи.

> [!div class="checklist"]
> * Создание центра Интернета вещей с помощью портала Azure. 
> * Выполнение отработки отказа. 
> * Запуск концентратора в дополнительном расположении.
> * Восстановление размещения для возврата операций центра Интернета вещей в основное расположение. 
> * Подтверждение правильной работы концентратора в нужном расположении.

Перейдите к следующему руководству, чтобы узнать, как управлять состоянием устройств IoT. 

> [!div class="nextstepaction"]
[Руководство. Настройка устройств из внутренней службы](tutorial-device-twins.md)