---
title: Обмен сообщениями с помощью служебной шины Azure в Azure Logic Apps | Документация Майкрософт
description: Настройка обмена сообщениями в корпоративном облаке с помощью служебной шины Azure в Azure Logic Apps.
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: ecfan
ms.author: estfan
ms.reviewer: klam, LADocs
ms.assetid: d6d14f5f-2126-4e33-808e-41de08e6721f
ms.topic: article
tags: connectors
ms.date: 08/25/2018
ms.openlocfilehash: 813df5b4ef37ad1264df48863aa8f0ed5a4d4789
ms.sourcegitcommit: 161d268ae63c7ace3082fc4fad732af61c55c949
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/27/2018
ms.locfileid: "43048780"
---
# <a name="exchange-messages-in-the-cloud-with-azure-service-bus-and-azure-logic-apps"></a>Обмен сообщениями в облаке с помощью служебной шины Azure и Azure Logic Apps

С помощью Azure Logic Apps и соединителя служебной шины Azure можно создать автоматизированные задачи и рабочие процессы, которые передают данные, такие как информация о продажах и заказы на покупку, журналы и перемещение запасов в приложениях, для вашей организации. Соединитель не только отслеживает, отправляет сообщения и управляет ими, но также выполняет действия с очередями, сеансами, разделами, подписками и т. д., например:

* Отслеживает прибытие (автозавершение) или прием сообщений (с блокировкой при извлечении) в очередях, разделах и подписках на разделы. 
* Отправляет сообщения.
* Создает и удаляет подписки на разделы.
* Управляет сообщениями в очередях и подписках на разделы, например, выполняет такие действия, как получение сообщения, получение отложенного сообщения, заполнение, отложение, прерывание и размещение недоставленных сообщений.
* Продлевает блокировку сообщений и сеансы в очередях и подписках на разделы.
* Закрывает сеансы в очередях и разделах.

Вы можете использовать триггеры, которые получают ответы из служебной шины и делают выходные данные доступными для других действий в приложениях логики. Кроме того, выходные данные действий служебной шины могут использоваться другими действиями. Если вы не знакомы со Служебной шиной и Logic Apps, перейдите к статье [Что такое служебная шина Azure?](../service-bus-messaging/service-bus-messaging-overview.md) и [Что такое Azure Logic Apps](../logic-apps/logic-apps-overview.md).

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, <a href="https://azure.microsoft.com/free/" target="_blank">зарегистрируйтесь для получения бесплатной учетной записи Azure</a>. 

* Пространство имен служебной шины и сущность обмена сообщениями, например очередь. Если у вас нет этих элементов, узнайте, как [создавать пространство имен служебной шины и очередь](../service-bus-messaging/service-bus-create-namespace-portal.md). 

  Эти элементы должны существовать в той же подписке Azure, что и приложения логики, которые их используют.

* Базовые знания [создания приложений логики](../logic-apps/quickstart-create-first-logic-app-workflow.md).

* Приложение логики, в котором необходимо использовать служебную шину. Приложение логики должно находиться в той же подписке Azure, что и служебная шина. Чтобы начать работу с триггером служебной шины, [создайте пустое приложение логики](../logic-apps/quickstart-create-first-logic-app-workflow.md). Чтобы использовать действие служебной шины, запустите приложение логики с другим триггером, например триггером **Периодичность**.

<a name="permissions-connection-string"></a>

## <a name="check-permissions"></a>Проверка разрешений

Убедитесь, что у приложения логики есть разрешения для доступа к пространству имен служебной шины. 

1. Войдите на [портале Azure](https://portal.azure.com). 

2. Перейдите к *пространству имен* служебной шины. На странице пространства имен в разделе **Параметры** выберите **Политики общего доступа**. В разделе **Утверждения** убедитесь, что у вас есть разрешения на **управление** для этого пространства имен.

   ![Управление разрешениями для пространства имен служебной шины](./media/connectors-create-api-azure-service-bus/azure-service-bus-namespace.png)

3. Получите строку подключения для пространства имен служебной шины. Эта строка потребуется при вводе сведений о подключении в приложении логики.

   1. Выберите **RootManageSharedAccessKey**. 
   
   1. Теперь нажмите кнопку копирования рядом с первичной строкой подключения. Сохраните строку подключения для дальнейшего использования.

      ![Копирование строки подключения к пространству имен служебной шины](./media/connectors-create-api-azure-service-bus/find-service-bus-connection-string.png)

   > [!TIP]
   > Чтобы проверить, относится ли строка подключения к пространству имен служебной шины или сущности обмена сообщениями, например очереди, найдите в ней параметр `EntityPath`. Если в строке подключения есть такой параметр, значит она относится к определенной сущности и ее нельзя использовать в приложении логики.

## <a name="add-trigger-or-action"></a>Добавление триггера или действия

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

1. Войдите на [портал Azure](https://portal.azure.com) и откройте свое приложение логики в конструкторе приложений логики, если оно еще не открыто.

1. Чтобы добавить *триггер* в пустое приложение логики, в поле поиска введите "Служебная шина Azure" в качестве фильтра. В списке триггеров выберите нужный триггер. 

   Например, для запуска приложения логики при отправке нового элемента в очередь служебной шины выберите триггер **При получении сообщения в очереди (автозавершение)**.

   ![Выбор триггера служебной шины](./media/connectors-create-api-azure-service-bus/select-service-bus-trigger.png)

   > [!NOTE]
   > Некоторые триггеры возвращают одно или несколько сообщений, например триггер **Когда одно или несколько сообщений поступает в очередь (автозавершение)**. Когда такие триггеры срабатывают, они возвращают от одного до нескольких сообщений. Количество сообщений определяется в свойстве триггера **Максимальное число сообщений**.

   Все триггеры служебной шины имеют *длинный интервал опроса*. Это значит, что после срабатывания триггер обрабатывает все сообщения, после чего в течение 30 секунд ожидает появления новых событий в очереди или подписке раздела. 
   Если на протяжении 30 секунд новые сообщения не поступают, триггер больше не срабатывает. 
   В противном случае триггер продолжит считывать сообщения, пока очередь или подписка раздела не опустеет. Следующий опрос триггера основывается на интервале повторения, установленном в свойствах триггера.

1. Чтобы добавить *действие* в существующее приложение логики, выполните следующие действия: 

   1. На последнем шаге, в котором необходимо добавить действие, выберите **Новый шаг**. 

      Чтобы добавить действие между шагами, переместите указатель на стрелку между шагами. 
      Выберите появившийся знак "плюс" (**+**), а затем щелкните **Добавить действие**.

   1. В поле поиска введите "служебная шина Azure" в качестве фильтра. 
   В списке действий выберите любое необходимое действие. 
 
      Например, выберите это действие: **Отправить сообщение**.

      ![Выбор действия служебной шины](./media/connectors-create-api-azure-service-bus/select-service-bus-send-message-action.png) 

1. Когда вы будете впервые подключать приложение логики к пространству имен служебной шины, конструктор приложений логики запросит сведения о подключении. 

   1. Укажите имя для подключения и выберите нужное пространство имен служебной шины.

      ![Создание подключения к служебной шине, часть 1](./media/connectors-create-api-azure-service-bus/create-service-bus-connection-1.png)

      Чтобы ввести строку подключения вручную, выберите **Вручную введите сведения о подключении**. 
      Если у вас нет строки подключения, узнайте, [как ее найти](#permissions-connection-string).

   1. Теперь выберите политику служебной шины, а затем нажмите кнопку **Создать**.

      ![Создание подключения к служебной шине, часть 2](./media/connectors-create-api-azure-service-bus/create-service-bus-connection-2.png)

1. В этом примере выберите нужную сущность обмена сообщениями, например очередь или раздел. В этом примере выберите очередь служебной шины. 
   
   ![Выбор очереди служебной шины](./media/connectors-create-api-azure-service-bus/service-bus-select-queue.png)

1. Укажите необходимые сведения для триггера или действия. Например, выполните следующие шаги для триггера или действия: 

   * **Пример триггера**: задайте интервал опроса и частоту проверки очереди.

     ![Настройка интервала опроса](./media/connectors-create-api-azure-service-bus/service-bus-trigger-details.png)

     Когда вы закончите, продолжайте создавать рабочий процесс своего приложения логики, добавляя нужные действия. Например, можно добавить действие, которое отправляет сообщение электронной почты при поступлении нового сообщения.
     Когда триггер проверяет вашу очередь и находит новое сообщение, ваше приложение логики запускает для него выбранные действия.

   * **Пример действия**: введите содержимое сообщения и другие сведения. 

     ![Указание содержимого сообщения и сведений](./media/connectors-create-api-azure-service-bus/service-bus-send-message-details.png)

     Когда вы закончите, продолжайте создавать рабочий процесс своего приложения логики, добавляя нужные действия. Например, вы можете добавить действие, которое отправляет письмо, подтверждающее отправку вашего сообщения.

1. Сохраните приложение логики. На панели инструментов конструктора нажмите кнопку **Сохранить**.

## <a name="connector-reference"></a>Справочник по соединителям

Дополнительные технические сведения о триггерах, действиях и ограничениях, которые приведены в описании OpenAPI соединителя (прежнее название — Swagger), можно найти на [странице справки](/connectors/servicebus/) соединителя.

## <a name="get-support"></a>Получение поддержки

* Если у вас возникли вопросы, то посетите [форум Azure Logic Apps](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps).
* Отправить идею по поводу возможности или проголосовать за нее вы можете на [сайте отзывов пользователей Logic Apps](http://aka.ms/logicapps-wish).

## <a name="next-steps"></a>Дополнительная информация

* См. дополнительные сведения о других [соединителях Logic Apps](../connectors/apis-list.md).