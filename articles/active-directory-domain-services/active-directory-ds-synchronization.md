---
title: 'Доменные службы Azure Active Directory: синхронизация в управляемых доменах | Документация Майкрософт'
description: Общие сведения о синхронизации в управляемом домене доменных служб Azure Active Directory.
services: active-directory-ds
documentationcenter: ''
author: mahesh-unnikrishnan
manager: mtillman
editor: curtand
ms.assetid: 57cbf436-fc1d-4bab-b991-7d25b6e987ef
ms.service: active-directory
ms.component: domain-services
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/30/2018
ms.author: maheshu
ms.openlocfilehash: 463113731d1c4b4d7dfb5b81d429a8b7ffb74b1b
ms.sourcegitcommit: 16ddc345abd6e10a7a3714f12780958f60d339b6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2018
ms.locfileid: "36218866"
---
# <a name="synchronization-in-an-azure-ad-domain-services-managed-domain"></a>Синхронизация в управляемом домене доменных служб Azure AD
На следующей схеме показано, как работает синхронизация в управляемых доменах доменных служб Azure AD.

![Синхронизация в доменных службах Azure AD](./media/active-directory-domain-services-design-guide/sync-topology.png)

## <a name="synchronization-from-your-on-premises-directory-to-your-azure-ad-tenant"></a>Синхронизация между локальным каталогом и клиентом Azure AD
Синхронизация Azure AD Connect используется для того, чтобы синхронизировать учетные записи пользователей, сведения о членстве в группах, а также хэши учетных данных с клиентом Azure AD. Атрибуты учетных записей пользователей, такие как имя участника-пользователя и локальный идентификатор безопасности (SID), синхронизируются. Если используются доменные службы Azure AD, то предыдущие версии хэшей учетных данных, необходимые для аутентификации NTLM и Kerberos, также синхронизируются с клиентом Azure AD.

Если настроить обратную запись, то изменения, вносимые в каталог Azure AD, синхронизируются обратно в локальную службу Active Directory. Например, если изменить пароль с помощью функции самостоятельного управления паролем Azure AD, то измененный пароль обновится в локальном домене AD.

> [!NOTE]
> Всегда используйте последнюю версию Azure AD Connect. В этом случае у вас точно будут исправления для всех известных ошибок.
>
>

## <a name="synchronization-from-your-azure-ad-tenant-to-your-managed-domain"></a>Синхронизация между клиентом Azure AD и управляемым доменом
Учетные записи пользователей, сведения о членстве в группах, а также хэши учетных данных синхронизируются между клиентом Azure AD и управляемым доменом доменных служб Azure AD. Этот процесс синхронизации выполняется автоматически. Для него не требуется настройка, отслеживание или управление. Начальная синхронизация может занять от нескольких часов до нескольких дней. Это зависит от количества объектов в каталоге Azure AD. После завершения начальной синхронизации внесенные в Azure AD изменения сохраняются в управляемом домене в течение 20–30 минут. Этот интервал синхронизации применяется к изменению паролей или параметров в Azure AD.

Кроме того, процесс синхронизации по своей природе является односторонним (однонаправленным). Как правило, управляемый домен доступен только для чтения. Исключениями являются любые пользовательские подразделения, которые вы создаете. Поэтому внесение изменений в атрибуты и пароли пользователя, а также в сведения о членстве в группах недоступно в пределах управляемого домена. В результате обратная синхронизация изменений из управляемого домена в клиент Azure AD не выполняется.

## <a name="synchronization-from-a-multi-forest-on-premises-environment"></a>Синхронизация из локальной среды с несколькими лесами
Многие организации имеют довольно сложную локальную инфраструктуру идентификации, состоящую из нескольких лесов учетных записей. Azure AD Connect поддерживает синхронизацию пользователей, групп и хэшей учетных данных между средами с несколькими лесами и клиентом Azure AD.

В свою очередь, клиент Azure AD использует гораздо более простое и одноуровневое пространство имен. Чтобы предоставить пользователям надежный доступ к приложениям, защищенным с помощью Azure AD, устраните конфликты имен участников-пользователей между учетными записями пользователей в разных лесах. Управляемый домен доменных служб Azure AD имеет много сходств с клиентом Azure AD. В своем управляемом домене вы видите одноуровневую структуру подразделений. Все учетные записи и группы пользователей хранятся в контейнере "Пользователи AADDC", несмотря на то что они синхронизируются из разных локальных доменов или лесов. Возможно, у вас настроена иерархическая локальная структура подразделений. Управляемый домен по-прежнему имеет простую одноуровневую структуру подразделений.

## <a name="exclusions---what-isnt-synchronized-to-your-managed-domain"></a>Исключения: что не синхронизируется с управляемым доменом
Ниже перечислены объекты и атрибуты, которые не синхронизируются с клиентом Azure AD или управляемым доменом.

* **Исключенные атрибуты**. При выполнении синхронизации между локальным доменом и клиентом Azure AD с помощью Azure AD Connect можно исключить из синхронизации определенные атрибуты. Исключенные атрибуты будут недоступны в управляемом домене.
* **Групповые политики**. Групповые политики, настроенные в локальном домене, не синхронизируются с управляемым доменом.
* **Общий ресурс Sysvol**. Аналогичным образом содержимое общего ресурса Sysvol в локальном домене не синхронизируется с управляемым доменом.
* **Объекты-компьютеры**. Объекты-компьютеры для компьютеров, присоединенных к локальному домену, не синхронизируются с управляемым доменом. Эти компьютеры не имеют отношений доверия с управляемым доменом и принадлежат только к локальному домену. В управляемом домене можно найти объекты-компьютеры только для компьютеров, которые были явно присоединены к управляемому домену.
* **Атрибуты SidHistory для пользователей и групп**. Основные идентификаторы безопасности (SID) пользователей и групп из локального домена синхронизируются с управляемым доменом. Но существующие атрибуты SidHistory для пользователей и групп из локального домена не синхронизируются с управляемым доменом.
* **Структуры подразделений**. Подразделения, определенные в локальном домене, не синхронизируются с управляемым доменом. В управляемом домене есть два встроенных подразделения. По умолчанию структура подразделений в управляемом домене одноуровневая. Однако вы можете [создавать в управляемом домене пользовательские подразделения](active-directory-ds-admin-guide-create-ou.md).

## <a name="how-specific-attributes-are-synchronized-to-your-managed-domain"></a>Синхронизация определенных атрибутов с управляемым доменом
В следующей таблице перечислены некоторые распространенные атрибуты, а также описывается, как они синхронизируются с управляемым доменом.

| Атрибут в управляемом домене | Источник | Заметки |
|:--- |:--- |:--- |
| Имя участника-пользователя (UPN) |Атрибут UPN пользователя в клиенте Azure AD |Атрибут UPN из клиента Azure AD синхронизируется с управляемым доменом "как есть". Поэтому самый надежный способ входа в управляемый домен — это с помощью имени участника-пользователя. |
| SAMAccountName |Атрибут mailNickname пользователя в клиенте Azure AD или автоматически созданный атрибут |Атрибут SAMAccountName формируется из атрибута mailNickname в клиенте Azure AD. Если несколько учетных записей пользователей имеют одинаковый атрибут mailNickname, то SAMAccountName создается автоматически. Если длина атрибута mailNickname пользователя или префикс имени участника-пользователя превышает 20 знаков, то SAMAccountName создается автоматически, чтобы не превышать ограничение в 20 знаков, установленное для атрибутов SAMAccountName. |
| Пароли |Пароль пользователя из клиента Azure AD |Хэши учетных данных, необходимые для аутентификации NTLM или Kerberos (которые также называют дополнительными учетными данными), синхронизируются с клиентом Azure AD. Если клиент Azure AD является синхронизируемым клиентом, то источником этих учетных данных будет локальный домен. |
| Основной идентификатор безопасности (SID) пользователя или группы |Создается автоматически |Основной идентификатор безопасности для учетных записей пользователей или групп создается автоматически в управляемом домене. Этот атрибут не совпадает с основным идентификатором безопасности пользователя или группы объекта в локальном домене AD. Это несоответствие объясняется тем, что управляемый домен имеет пространство имен SID, отличное от локального домена. |
| Журнал идентификаторов безопасности для пользователей и групп |Локальный основной идентификатор безопасности пользователя и группы |Атрибут SidHistory для пользователей и групп в управляемом домене совпадает с соответствующим основным идентификатором безопасности пользователя или группы в локальном домене. Эта функция значительно упрощает процесс извлечения и перемещения локальных приложений в управляемый домен, так как не требуется повторно создавать список управления доступом для ресурсов. |

> [!NOTE]
> **При входе в управляемый домен используйте формат имени участника-пользователя (UPN)**. Для некоторых учетных записей пользователей в управляемом домене атрибут SAMAccountName может создаваться автоматически. Если несколько пользователей имеют одинаковый атрибут mailNickname или у пользователей слишком длинные префиксы имени участника-пользователя, то атрибут SAMAccountName для этих пользователей может создаваться автоматически. Поэтому имя в формате SAMAccountName (например, CONTOSO100\joeuser) не всегда является надежным способом входа в домен. Автоматически создаваемый атрибут SAMAccountName пользователей может отличаться от их префикса имени участника-пользователя. Для безопасного входа в управляемый домен используйте формат имени участника-пользователя (например, joeuser@contoso100.com).
>
>

### <a name="attribute-mapping-for-user-accounts"></a>Сопоставление атрибутов для учетных записей пользователей
В следующей таблице показано, как определенные атрибуты для пользовательских объектов в клиенте Azure AD синхронизируются с соответствующими атрибутами в управляемом домене.

| Атрибут пользователя в клиенте Azure AD | Атрибут пользователя в управляемом домене |
|:--- |:--- |
| AccountEnabled |userAccountControl (задает или удаляет значение ACCOUNT_DISABLED) |
| city |l |
| country |co |
| department |department |
| displayName |displayName |
| facsimileTelephoneNumber |facsimileTelephoneNumber |
| givenName |givenName |
| jobTitle |title |
| mail |mail |
| mailNickname |msDS-AzureADMailNickname |
| mailNickname |SAMAccountName (в некоторых случаях создается автоматически) |
| mobile |mobile |
| objectid |msDS-AzureADObjectId |
| onPremiseSecurityIdentifier |sidHistory |
| passwordPolicies |userAccountControl (задает или удаляет значение DONT_EXPIRE_PASSWORD) |
| physicalDeliveryOfficeName |physicalDeliveryOfficeName |
| postalCode |postalCode |
| preferredLanguage |preferredLanguage |
| state |st |
| streetAddress |streetAddress |
| surname |sn |
| TelephoneNumber |TelephoneNumber |
| userPrincipalName |userPrincipalName |

### <a name="attribute-mapping-for-groups"></a>Сопоставление атрибутов для групп
В следующей таблице показано, как определенные атрибуты для объектов групп в клиенте Azure AD синхронизируются с соответствующими атрибутами в управляемом домене.

| Атрибут группы в клиенте Azure AD | Атрибут группы в управляемом домене |
|:--- |:--- |
| displayName |displayName |
| displayName |SAMAccountName (в некоторых случаях создается автоматически) |
| mail |mail |
| mailNickname |msDS-AzureADMailNickname |
| objectid |msDS-AzureADObjectId |
| onPremiseSecurityIdentifier |sidHistory |
| securityEnabled |groupType |

## <a name="password-hash-synchronization-and-security-considerations"></a>Вопросы по синхронизации и безопасности хэша паролей
При включении доменных служб Azure AD в каталоге Azure AD создаются и сохраняются хэши паролей в совместимых форматах NTLM и Kerberos. 

Для имеющихся учетных записей пользователей в облаке эти хэши не создаются автоматически, так как Azure AD никогда не сохраняет свои открытые пароли. Таким образом, для создания и хранения хэшей паролей в Azure AD [пользователям облака необходимо сбросить или изменить свои пароли](active-directory-ds-getting-started-password-sync.md). Для любой облачной учетной записи пользователя в Azure AD хэши паролей сохраняются и создаются в совместимых форматах NTLM и Kerberos после включения доменных служб Azure AD. 

Для учетных записей пользователей, синхронизируемых из локального AD с помощью службы синхронизации Azure AD Connect, необходимо [настроить Azure AD Connect для синхронизации хэшей паролей в совместимых форматах NTLM и Kerberos](active-directory-ds-getting-started-password-sync-synced-tenant.md).

Хэши паролей совместимых форматов NTLM и Kerberos всегда хранятся в Azure AD в зашифрованном виде. Эти хэши шифруются таким образом, что только доменные службы Azure AD имеют доступ к ключам шифрования. Другие службы или компоненты в Azure AD не имеют доступа к этим ключам. Ключи шифрования являются уникальными для каждого клиента Azure AD. Доменные службы Azure AD синхронизируют хэши паролей с контроллерами управляемого домена. Эти хэши паролей хранятся и защищаются в контроллерах домена (аналогично хранению и защите паролей в контроллерах домена Windows Server AD). Диски для этих контроллеров управляемых доменов шифруются при хранении.

## <a name="objects-that-are-not-synchronized-to-your-azure-ad-tenant-from-your-managed-domain"></a>Объекты, которые не синхронизируются между управляемым доменом и клиентом Azure AD
Как сказано в предыдущем разделе этой статьи, обратная синхронизация из управляемого домена в клиент Azure AD не выполняется. Вы можете [создать пользовательское подразделения](active-directory-ds-admin-guide-create-ou.md) в управляемом домене. Затем вы можете создать другие подразделения, а также пользователей, группы и учетные записи служб в этих пользовательских подразделениях. Ни один из объектов, созданных в пользовательских подразделениях, не синхронизируется обратно в клиент Azure AD. Эти объекты доступны для использования только в пределах управляемого домена. Таким образом, данные объекты не отображаются при использовании командлетов Azure AD PowerShell, интерфейса API Graph Azure AD или пользовательского интерфейса управления Azure AD.

## <a name="related-content"></a>Похожий контент
* [Возможности доменных служб Azure AD](active-directory-ds-features.md)
* [Сценарии развертывания доменных служб Azure AD](active-directory-ds-scenarios.md)
* [Рекомендации по сетям для доменных служб Azure AD](active-directory-ds-networking.md)
* [Приступая к работе с доменными службами Azure AD](active-directory-ds-getting-started.md)
