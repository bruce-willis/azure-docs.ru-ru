---
title: Создание решения аналитики промежуточных данных с помощью Azure и Azure Stack | Документация Майкрософт
description: Узнайте, как создать решение аналитики промежуточных данных с помощью Azure и Azure Stack.
services: azure-stack
documentationcenter: ''
author: mattbriggs
manager: femila
editor: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: tutorial
ms.date: 09/24/2018
ms.author: mabrigg
ms.reviewer: Anjay.Ajodha
ms.openlocfilehash: b704db0b79d056f5c7081d3fed117e1d1f22b336
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46978834"
---
# <a name="tutorial-create-a-staged-data-analytics-solution-with-azure-and-azure-stack"></a>Руководство. Создание решения аналитики промежуточных данных с помощью Azure и Azure Stack 

*Область применения: интегрированные системы Azure Stack и Пакет средств разработки Azure Stack*

Узнайте, как использовать локальные и общедоступные облачные среды, чтобы обеспечить соответствие требованиям предприятий с несколькими филиалами или офисами. Azure Stack предлагает быстрое, безопасное и гибкое решение для сбора, обработки, хранения и распространения локальных и удаленных данных. В особенности решение подходит для ситуаций, в которых требования безопасности, конфиденциальности, корпоративной политики и нормативные требования могут быть различными для разных расположений и пользователей.

В этом шаблоне клиенты собирают данные, анализ которых необходимо выполнять в точке сбора таким образом, чтобы можно было быстро принимать решения. Часто этот сбор данных происходит без доступа к Интернету. Когда подключение будет установлено, возможно, потребуется выполнить ресурсоемкий анализ данных, чтобы получить дополнительные сведения. Вы сможете выполнить такой анализ, даже если доступ к общедоступному облаку будет получен слишком поздно или же оно будет недоступно.

В рамках этого руководства вы создадите пример среды и выполните в ней следующие действия:

> [!div class="checklist"]
> - Создание большого двоичного объекта для хранения необработанных данных.
> - Создание функции Azure Stack для перемещения очищенных данных из Azure Stack в Azure.
> - Создание функции для триггеров хранилища BLOB-объектов.
> - Создание учетной записи хранения Azure Stack, содержащей большой двоичный объект и очередь.
> - Создание функции, активируемой очередью.
> - Тестирование функции, активируемой очередью.

> [!Tip]  
> ![hybrid-pillars.png](./media/azure-stack-solution-cloud-burst/hybrid-pillars.png)  
> Microsoft Azure Stack — это расширение Azure.re. Azure Stack обеспечивает гибкое и быстрое внедрение инноваций облачных вычислений в локальной среде. Только это гибридное облако позволяет создавать и развертывать гибридные приложения в любой точке мира.  
> 
> В техническом документе [Design Considerations for Hybrid Applications](https://aka.ms/hybrid-cloud-applications-pillars) (Рекомендации по проектированию гибридных приложений) рассматриваются основные аспекты качества программного обеспечения (размещение, масштабируемость, доступность, устойчивость, управляемость и безопасность) для разработки, развертывания и эксплуатации гибридных приложений. Рекомендации помогут оптимизировать разработку гибридных приложений и свести к минимуму проблемы в рабочих средах.

## <a name="prerequisites"></a>Предварительные требования

Чтобы создать это решение, требуется некоторая подготовка:

-   Установленный и работоспособный экземпляр Azure Stack (дополнительные сведения можно найти здесь: [Общие сведения о хранилище Azure Stack](https://docs.microsoft.com/azure/azure-stack/user/azure-stack-storage-overview)).

-   Подписка Azure. Создайте [бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

-   Скачайте и установите [обозреватель хранилищ Microsoft Azure](http://storageexplorer.com/).

-   Данные, обрабатываемые этими функциями, не предоставляются. Данные должны быть сформированы и доступны для отправки в контейнер больших двоичных объектов хранилища Azure Stack.

## <a name="issues-and-considerations"></a>Проблемы и рекомендации

### <a name="scalability-considerations"></a>Вопросы масштабируемости

Функции Azure и решения для хранения данных масштабируются в соответствии с требованиями к объему и обработке данных. Сведения о масштабируемости Azure и целевые показатели см. в [документации по масштабируемости Azure](https://docs.microsoft.com/azure/storage/common/storage-scalability-targets).

### <a name="availability-considerations"></a>Вопросы доступности

Хранение данных — основной фактор доступности для этого шаблона. Для обработки и распространения больших объемов данных необходимо подключение с помощью высокоскоростных каналов.

### <a name="manageability-considerations"></a>Вопросы управляемости

Определите, как средства разработки и система управления версиями позволят управлять вашим решением.

## <a name="create-the-raw-data-storage-blob"></a>Создание большого двоичного объекта для хранения необработанных данных

В учетной записи хранения и контейнере больших двоичных объектов будут содержаться все исходные данные, созданные в ходе локальной деятельности, включая операции компьютеров и действия сотрудников, данные помещения, метрики производства и другая отчетность.

1.  Войдите на [*портал Azure Stack*](https://portal.local.azurestack.external/).

2.  На портале Azure Stack разверните меню слева, чтобы открыть меню служб, и выберите **Все службы**. Прокрутите вниз до пункта **Хранилище** и выберите **Учетные записи хранения**. В появившемся окне "Учетные записи хранения" выберите **Добавить**.

3.  Укажите следующие сведения для учетной записи:

    a.  Имя: **по вашему выбору**.

    b.  Модель развертывания: **Resource Manager**.

    c.  Тип учетной записи: **Учетная запись хранения (версия 1, общего назначения)**.

    d.  Расположение: **Западная часть США**.

    д.  Репликация: **Локально избыточное хранилище (LRS)**.

    Е.  Производительность: **Стандартная**.

    ж.  Требуется безопасная передача данных: **Отключено**.

    h.  Подписка: выберите подписку.

    i.  Группа ресурсов: укажите новую группу ресурсов или выберите существующую.

    j.  Настройка виртуальных сетей: **Отключено**.

4.  Выберите **Создать**, чтобы создать учетную запись хранения.

    ![Alt text](media\azure-stack-solution-staged-data-analytics\image1.png)

5.  После создания учетной записи хранения выберите ее имя.

6.  В колонке учетной записи под заголовком **СЛУЖБА BLOB-ОБЪЕКТОВ** выберите **Контейнеры**.

7.  В верхней части колонки выберите **+ Контейнер**, затем выберите **Контейнер**.

    ![Alt text](media\azure-stack-solution-staged-data-analytics\image2.png)

8.  Имя: **по вашему выбору**.

9.  Общедоступный уровень доступа: **Контейнер** (анонимный доступ на чтение к контейнерам и большим двоичным объектам).

10.  Нажмите кнопку **ОК**.

## <a name="create-an-azure-stack-function"></a>Создание функции Azure Stack

Создайте функцию Azure Stack для перемещения очищенных данных из Azure Stack в Azure.

1.  Чтобы создать функцию, выберите **Функции** и нажмите кнопку **+ Создать функцию**.

    ![Alt text](media\azure-stack-solution-staged-data-analytics\image3.png)

2.  Выберите **Триггер таймера**.

    ![Alt text](media\azure-stack-solution-staged-data-analytics\image4.png)

3.  Выберите язык **C\#** и присвойте функции имя `upload-to-azure`. Задайте расписание `0 0 * * * *`, что в нотации CRON означает запуск каждый час.

    ![Alt text](media\azure-stack-solution-staged-data-analytics\image5.png)

4.  Создайте приложение-функцию с использованием параметров, указанных в таблице под рисунком.

    | Параметр | Рекомендуемое значение | ОПИСАНИЕ |
    | ---- | ---- | ---- |
    | Имя приложения. | Глобально уникальное имя | Имя, которое идентифицирует ваше новое приложение-функцию. Допустимые символы: `a`-`z`, `0``-9` и `-`. |
    | Подписка | Ваша подписка | Подписка, в которой создано приложение-функция. |
    | **Группа ресурсов** |  |  |
    | myResourceGroup | Имя новой группы ресурсов, в которой создается приложение-функция. |  |
    | ОС | Windows | Бессерверное размещение в данный момент доступно только при выполнении в Windows. |
    | **План размещения** |  |  |
    | План потребления | План размещения, который определяет выделение ресурсов в приложении-функции. В плане потребления по умолчанию ресурсы добавляются динамически в соответствии с потребностями функций. При таком бессерверном размещении вы платите только за время выполнения функций. |  |
    | Расположение | Ближайший к вам регион | Выберите ближайший регион или регион рядом с другими службами, к которому получают доступ ваши функции. |
    | **Учетная запись хранения** |  |  |
    | \<созданная выше учетная запись хранения> | Имя учетной записи хранения, используемой вашим приложением-функцией. Имя учетной записи хранения должно содержать от 3 до 24 символов и состоять только из цифр и строчных букв. Вы также можете использовать имеющуюся учетную запись. |  |

    **Пример.**

    ![Определение параметров нового приложения-функции](media\azure-stack-solution-staged-data-analytics\image6.png)

5.  Выберите **Создать**, чтобы подготовить и развернуть приложение-функцию.

6.  Выберите значок уведомления в правом верхнем углу портала. Вы должны увидеть сообщение **Развертывание выполнено**.

    ![Определение параметров нового приложения-функции](media\azure-stack-solution-staged-data-analytics\image7.png)

7.  Выберите **Перейти к ресурсу**, чтобы просмотреть новое приложение-функцию.

![Приложение-функция успешно создана.](media\azure-stack-solution-staged-data-analytics\image8.png)

## <a name="create-a-blob-storage-triggered-function"></a>Создание функции, активируемой хранилищем BLOB-объектов

1.  Разверните приложение-функцию и нажмите кнопку **+** рядом с элементом **Функции**. Если это первая функция в приложении-функции, выберите **Пользовательская функция**. Откроется полный набор шаблонов функций.

  ![Страница быстрого начала работы с функциями на портале Azure](media\azure-stack-solution-staged-data-analytics\image9.png)

2.  В поле поиска введите "blob" и выберите нужный язык для шаблона триггера для хранилища BLOB-объектов.

  ![Выбор шаблона триггера для хранилища BLOB-объектов](media\azure-stack-solution-staged-data-analytics\image10.png)

3.  Используйте параметры, указанные в таблице ниже:

    | Параметр | Рекомендуемое значение | ОПИСАНИЕ |
    | ------- | ------- | ------- |
    | ИМЯ | Уникальное для вашего приложения-функции | Имя функции, активируемой большим двоичным объектом. |
    | Путь | \<путь из указанного выше расположения хранения> | Расположение в хранилище BLOB-объектов отслеживается. Имя файла большого двоичного объекта передается в привязке как параметр name. |
    | Подключение к учетной записи хранения | Подключение приложения-функции | Можно использовать подключение к учетной записи хранения, которое уже используется вашим приложением-функцией, или создать его. |

    **Пример.**

    ![Создание функции, активируемой хранилищем BLOB-объектов.](media\azure-stack-solution-staged-data-analytics\image11.png)

4.  Щелкните **Создать**, чтобы создать функцию.

### <a name="test-the-function"></a>Проверка функции

1.  Перейдите к функции на портале Azure. Разверните узел **Журналы** в нижней части страницы и убедитесь, что потоковая передача журналов не приостановлена.

2.  Откройте Обозреватель службы хранилища и подключитесь к учетной записи хранения, созданной в начале этого раздела.

3.  Разверните учетную запись хранения, узел **Контейнеры больших двоичных объектов** и большой двоичный объект, созданный вами ранее. Последовательно выберите **Отправка** и **Отправка файлов**.

    ![Отправьте файл в контейнер больших двоичных объектов.](media\azure-stack-solution-staged-data-analytics\image12.png)

4.  В диалоговом окне "Отправка файлов" выберите поле "Файлы". Перейдите к файлу на локальном компьютере, например к файлу изображения, выберите его, а затем последовательно выберите **Открыть** и **Отправить**.

5.  Вернитесь к журналам функции и убедитесь, что большой двоичный объект считан.

    **Пример.**

    ![Просмотр сообщения в журналах](media\azure-stack-solution-staged-data-analytics\image13.png)

## <a name="create-an-azure-stack-storage-account"></a>Создание учетной записи хранения Azure Stack

Создайте учетную запись хранения Azure Stack, содержащую большой двоичный объект и очередь.

### <a name="storage-blob--data-archiving"></a>Архивация данных в большой двоичный объект хранилища

В этой учетной записи хранения будут размещены два контейнера. Эти контейнеры представляют собой один большой двоичный объект, используемый для хранения архивных данных, и очередь, используемую для обработки данных, назначенных для распространения из главного офиса.

С помощью действий и параметров, описанных выше, создайте еще одну учетную запись хранения и контейнер больших двоичных объектов в качестве архивного хранилища.

### <a name="storage-queue--filtered-data-holding"></a>Размещение отфильтрованных данных в очереди хранилища

1.  С помощью действий и параметров, описанных выше, получите доступ к новой учетной записи хранения.

2.  В разделе Storage Account Overview (Обзор учетной записи хранения) выберите **Очередь**.

3.  Выберите **+ Очередь** и введите имя для новой очереди в поле **Имя**.

4.  Нажмите кнопку **ОК**.

    ![Alt text](media\azure-stack-solution-staged-data-analytics\image14.png)

    ![Alt text](media\azure-stack-solution-staged-data-analytics\image15.png)

## <a name="create-a-queue-triggered-function"></a>Создание функции, активируемой очередью

1.  С помощью инструкций, приведенных выше в разделе о создании функции, создайте дополнительную функцию Azure Stack с триггером очереди вместо триггера большого двоичного объекта.

2.  Используйте параметры, указанные в таблице ниже:

    | Параметр | Рекомендуемое значение | ОПИСАНИЕ |
    | ------- | ------- | ------- |
    | ИМЯ | Уникальное для вашего приложения-функции | Имя функции, активируемой очередью. |
    | Путь | \<путь из указанного выше расположения хранения> | Расположение в хранилище, которое отслеживается. Имя файла очереди передается в привязке как параметр name. |
    | Подключение к учетной записи хранения | Подключение приложения-функции | Можно использовать подключение к учетной записи хранения, которое уже используется вашим приложением-функцией, или создать его. |

3.  Щелкните **Создать**, чтобы создать функцию.

## <a name="test-the-queue-triggered-function"></a>Тестирование функции, активируемой очередью

1.  Перейдите к функции на портале Azure. Разверните узел **Журналы** в нижней части страницы и убедитесь, что потоковая передача журналов не приостановлена.

2.  Откройте Обозреватель службы хранилища и подключитесь к учетной записи хранения, созданной в начале этого раздела.

3.  Разверните учетную запись хранения, узел **Контейнеры больших двоичных объектов** и большой двоичный объект, созданный вами ранее. Последовательно выберите **Отправка** и **Отправка файлов**.

    ![Отправьте файл в контейнер больших двоичных объектов.](media\azure-stack-solution-staged-data-analytics\image12.png)

4.  В диалоговом окне "Отправка файлов" выберите поле "Файлы". Перейдите к файлу на локальном компьютере, например к файлу изображения, выберите его, а затем последовательно выберите **Открыть** и **Отправить**.

5.  Вернитесь к журналам функции и убедитесь, что большой двоичный объект считан.

  **Пример.**

    ![Просмотр сообщения в журналах](media\azure-stack-solution-staged-data-analytics\image13.png)

## <a name="securely-stored-and-accessed-compliant-data"></a>Защищенное хранение соответствующих требованиям данных и доступ к ним

Azure, решение аналитики промежуточных данных Azure Stack и директивы пользовательских конечных точек обеспечивают безопасное хранение, обработку и распространение глобальных корпоративных данных, а также доступ к ним. Действия сотрудников и операции оборудования в удаленных офисах, данные помещения и бизнес-метрики постоянно компилируются, сохраняются, тестируется на предмет соответствия требованиям и распространяются в соответствии с политикой компании и установленными в регионе правилами.

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о шаблонах для облака Azure см. в статье [Конструктивные шаблоны облачных решений](https://docs.microsoft.com/azure/architecture/patterns).