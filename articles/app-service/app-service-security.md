---
title: Безопасность в службе приложений Azure и службе "Функции Azure" | Документация Майкрософт
description: Сведения о том, как служба приложений помогает защитить ваше приложение, а также о последующей блокировке приложения для защиты от угроз.
keywords: azure app service, web app, mobile app, api app, function app, security, secure, secured, compliance, compliant, certificate, certificates, https, ftps, tls, trust, encryption, encrypt, encrypted, ip restriction, authentication, authorization, authn, autho, msi, managed service identity, secrets, secret, patching, patch, patches, version, isolation, network isolation, ddos, mitm
services: app-service
documentationcenter: ''
author: cephalin
manager: cfowler
editor: ''
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/24/2018
ms.author: cephalin
ms.openlocfilehash: 40fdd22bdbb3fc0676688430069d58c0422a7ca2
ms.sourcegitcommit: a3a0f42a166e2e71fa2ffe081f38a8bd8b1aeb7b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/01/2018
ms.locfileid: "43382122"
---
# <a name="security-in-azure-app-service-and-azure-functions"></a>Безопасность в службе приложений Azure и службе "Функции Azure"

В этой статье описывается, как [служба приложений Azure](app-service-web-overview.md) помогает защитить ваше веб-приложение, серверную часть мобильного приложения и приложение API, а также приводятся сведения о службе [Функции Azure](/azure/azure-functions/). Здесь также приводятся сведения о том, как дополнительно защитить приложение с помощью встроенных функций службы приложений.

Компоненты платформы службы приложений, включая виртуальные машины Azure, хранилище, сетевые подключения, веб-платформы, функции управления и интеграции, надежно защищены. Служба приложений проходит непрерывные проверки соответствия требованиям, чтобы гарантировать следующее:

- Ресурсы вашего приложения [защищены](https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox) от ресурсов Azure других клиентов.
- [Экземпляры виртуальной машины и программное обеспечение среды выполнения регулярно обновляются](app-service-patch-os-runtime.md) для обнаружения новых уязвимостей. 
- Обмен секретными данными (например, строками подключения) между приложением и другими ресурсами Azure (например, [базой данных SQL](https://azure.microsoft.com/services/sql-database/)) остается в пределах Azure и не выходит за рамки сети. При сохранении секретные данные всегда шифруются.
- Все сообщения, передаваемые с помощью функций подключения службы приложений, например [гибридного подключения](app-service-hybrid-connections.md), шифруются. 
- Подключения к удаленным инструментам управления, например Azure PowerShell, Azure CLI, пакетам SDK Azure, интерфейсам API REST, шифруются.
- Круглосуточное предотвращение угроз позволяет защитить инфраструктуру и платформу от вредоносных программ, атак типа "отказ в обслуживании" (DDoS), атак типа "злоумышленник посередине" (MITM) и других угроз.

Дополнительные сведения о безопасности инфраструктуры и платформы см. в [центре управления безопасностью Azure](https://azure.microsoft.com/overview/trusted-cloud/).

В следующих разделах показано, как в дальнейшем защитить приложение службы приложений от угроз.

## <a name="https-and-certificates"></a>Протокол HTTPS и сертификаты

Служба приложений позволяет защитить приложения с помощью протокола [HTTPS](https://wikipedia.org/wiki/HTTPS). После создания приложения к его доменному имени по умолчанию (\<app_name>.azurewebsites.net) уже можно получить доступ с помощью протокола HTTPS. Если вы [настраиваете личный домен для приложения](app-service-web-tutorial-custom-domain.md), вам также нужно [защитить его с помощью настраиваемого сертификата](app-service-web-tutorial-custom-ssl.md), чтобы браузеры клиента могли применить к нему безопасные подключения HTTPS. Это можно сделать двумя способами.

- **Сертификат службы приложения**. Создайте сертификат непосредственно в Azure. Сертификат защищен в [Azure Key Vault](/azure/key-vault/) и его можно импортировать в приложение службы приложений. Дополнительные сведения см. в статье [Приобретение и настройка сертификата SSL для службы приложений Azure](web-sites-purchase-ssl-web-site.md).
- **Сторонний сертификат**. Загрузите настраиваемый SSL-сертификат, приобретенный в доверенном центре сертификации, и свяжите его с приложением службы приложений. Служба приложений поддерживает сертификаты с одним доменом и групповые сертификаты. Она также поддерживает самозаверяющие сертификаты для тестирования. Дополнительные сведения см. в статье [Руководство. Привязывание существующего настраиваемого SSL-сертификата к веб-приложениям Azure](app-service-web-tutorial-custom-ssl.md).

## <a name="insecure-protocols-http-tls-10-ftp"></a>Незащищенные протоколы (HTTP, TLS 1.0, FTP)

Чтобы защитить ваше приложение от всех незашифрованных подключений (HTTP), служба приложений предоставляет конфигурацию в один щелчок для принудительного использования HTTPS. Незащищенные запросы отсеиваются еще до того, как они достигнут кода приложения. Дополнительные сведения см. в разделе [Принудительное использование HTTPS](app-service-web-tutorial-custom-ssl.md#enforce-https).

Протокол [TLS](https://wikipedia.org/wiki/Transport_Layer_Security) версии 1.0 больше не считается безопасным в соответствии с отраслевыми стандартами, такими как [PCI DSS](https://wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard). Служба приложений позволяет отключить устаревшие протоколы путем принудительного использования протокола [TLS версии 1.1 или 1.2](app-service-web-tutorial-custom-ssl.md#enforce-tls-versions).

Служба приложений поддерживает протоколы FTP и FTPS для развертывания файлов. Но если возможно, лучше использовать протокол FTPS вместо FTP. Если один из этих протоколов или оба протокола не используются, нужно [их отключить](app-service-deploy-ftp.md#enforce-ftps).

## <a name="static-ip-restrictions"></a>Ограничения статических IP-адресов

По умолчанию приложение службы приложений принимает запросы со всех IP-адресов из Интернета, но вы можете ограничить доступ небольшим подмножеством IP-адресов. Служба приложений в Windows позволяет определить список IP-адресов, с которых разрешен доступ к вашему приложению. Список разрешений может содержать отдельные IP-адреса или их диапазон, который определяется маской подсети. Дополнительные сведения см. в статье [Ограничения статических IP-адресов в Службе приложений Azure](app-service-ip-restrictions.md).

Для службы приложений в Windows вы также можете ограничить IP-адреса динамически, настроив _web.config_. Чтобы узнать больше, ознакомьтесь со статьей о [безопасности динамического IP-адреса<dynamicIpSecurity>](https://docs.microsoft.com/iis/configuration/system.webServer/security/dynamicIpSecurity/).

## <a name="client-authentication-and-authorization"></a>Аутентификация и авторизация клиента

Служба приложений Azure обеспечивает аутентификацию "под ключ" и авторизацию пользователей или клиентских приложений. При включении с помощью такой аутентификации обеспечивается вход пользователей и клиентских приложений с минимальным использованием или без использования кода приложения. Вы можете реализовать собственное решение аутентификации и авторизации или разрешить это сделать службе приложений. Модуль аутентификации и авторизации обрабатывает веб-запросы перед их передачей коду приложения, и отклоняет несанкционированные запросы до того, как они достигнут кода.

Аутентификация и авторизация службы приложений поддерживают несколько поставщиков аутентификации, включая Azure Active Directory, учетные записи Майкрософт, Facebook, Google и Twitter. Дополнительные сведения см. в статье [Проверка подлинности и авторизация в службе приложений Azure](app-service-authentication-overview.md).

## <a name="service-to-service-authentication"></a>Взаимодействие между службами

При аутентификации внутренней службы служба приложений предоставляет два разных механизма в зависимости от ваших потребностей:

- **Удостоверение службы**. Войдите в удаленный ресурс, используя удостоверение самого приложения. Служба приложений позволяет легко создать [управляемое удостоверение службы](app-service-managed-service-identity.md), которое вы можете использовать для аутентификации с другими службами, например [базой данных SQL Azure](/azure/sql-database/) или [Azure Key Vault](/azure/key-vault/). Соответствующие сведения о сквозной аутентификации для этого подхода см. в статье [Руководство. Безопасное подключение базы данных Azure SQL с использованием управляемого удостоверения службы](app-service-web-tutorial-connect-msi.md).
- **От имени (OBO)**. Предоставьте делегированный доступ к удаленным ресурсам от имени пользователя. При использовании Azure Active Directory в качестве поставщика аутентификации приложение службы приложений может выполнять делегированный вход в удаленную службу, например [API Graph Azure Active Directory](../active-directory/develop/active-directory-graph-api.md) или приложение удаленного API в службе приложений. Соответствующие сведения о сквозной аутентификации для этого подхода см. в статье [Руководство по сквозной проверке подлинности и авторизации в службе приложений Azure](app-service-web-tutorial-auth-aad.md).

## <a name="connectivity-to-remote-resources"></a>Подключение к удаленным ресурсам

Есть три типа удаленных ресурсов, к которым приложению может потребоваться доступ: 

- [Ресурсы Azure](#azure-resources)
- [Ресурсы внутри виртуальной сети Azure](#resources-inside-an-azure-virtual-network).
- [Локальные ресурсы](#on-premises-resources).

В каждом из этих случаев служба приложений предоставляет способ выполнить безопасные подключения, но вы должны по-прежнему соблюдать рекомендации по безопасности. Например, всегда используйте зашифрованные подключения, даже если внутренний ресурс разрешает незашифрованные. Кроме того, настройте для внутренней службы Azure минимальный набор IP-адресов. Вы можете найти исходящие IP-адреса для приложения, ознакомившись со статьей [Входящие и исходящие IP-адреса в Службе приложений Azure](app-service-ip-addresses.md).

### <a name="azure-resources"></a>Ресурсы Azure

Когда приложение подключается к ресурсам Azure, например [базе данных SQL](https://azure.microsoft.com/services/sql-database/) и [службе хранилища Azure](/azure/storage/), оно остается в пределах Azure и не пересекает границы сети. Однако оно проходит через общедоступную сеть в Azure, поэтому всегда проверяйте, зашифровано ли оно. 

Если приложение размещено в [среде службы приложений](environment/intro.md), вы должны [подключиться к поддерживаемым службам Azure с использованием конечных точек службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md).

### <a name="resources-inside-an-azure-virtual-network"></a>Ресурсы внутри виртуальной сети Azure

Ваше приложение может получить доступ к ресурсам в [виртуальной сети Azure](/azure/virtual-network/) через [интеграцию виртуальной сети](web-sites-integrate-with-vnet.md). Интеграция с виртуальной сетью устанавливается с помощью VPN-подключения "точка — сеть". Затем приложение может получить доступ к ресурсам в виртуальной сети, используя их частные IP-адреса. Тем не менее подключение "точка — сеть" все еще проходит через общие сети в Azure. 

Чтобы полностью изолировать подключение к ресурсам из общих сетей в Azure, создайте свое приложение в [среде службы приложений](environment/intro.md). Так как среда службы приложений всегда развертывается в выделенную виртуальную сеть, связь между вашим приложением и ресурсами в виртуальной сети полностью изолирована. Сведения о других аспектах безопасности сети в среде службы приложений см. в разделе об [изоляции сети](#network-isolation).

### <a name="on-premises-resources"></a>Локальные ресурсы

Есть три способа безопасного получения доступа к локальным ресурсам, таким как базы данных. 

- [Гибридное подключение](app-service-hybrid-connections.md). Устанавливает подключение типа "точка — точка" к удаленному ресурсу через TCP-туннель. TCP-туннель устанавливается с помощью протокола TLS 1.2 с общедоступными ключами подписи (SAS).
- [Интеграция виртуальной сети](web-sites-integrate-with-vnet.md) с VPN-подключением "сеть — сеть". Выполняется, как описано в разделе о [ресурсах внутри виртуальной сети Azure](#resources-inside-an-azure-virtual-network), но виртуальную сеть можно подключить к локальной сети через [VPN-подключение "сеть — сеть"](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md). В этой топологии сети приложение может подключаться к локальным ресурсам, например другим ресурсам в виртуальной сети.
- [Среда службы приложений](environment/intro.md) с VPN-подключением "сеть — сеть". Сведения описаны в разделе о [ресурсах внутри виртуальной сети Azure](#resources-inside-an-azure-virtual-network), но виртуальную сеть можно подключить к локальной сети через [VPN-подключение "сеть — сеть"](../vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal.md). В этой топологии сети приложение может подключаться к локальным ресурсам, например другим ресурсам в виртуальной сети.

## <a name="application-secrets"></a>Секреты приложений

Не храните секреты приложений, такие как учетные данные базы данных, маркеры API и закрытые ключи в файлах кода или конфигурации. Общепринятым подходом является доступ к ним как [переменным среды](https://wikipedia.org/wiki/Environment_variable) с использованием стандартного шаблона на выбранном вами языке. В службе приложений определить переменные среды можно с помощью [параметров приложения](web-sites-configure.md#app-settings) (и, особенно для приложений .NET, [строк подключения](web-sites-configure.md#connection-strings)). Параметры приложения и строки подключения хранятся в зашифрованном виде в Azure, и расшифровываются только перед введением в память процесса приложения при его запуске. Ключи шифрования регулярно меняются.

Кроме того, вы можете интегрировать приложение службы приложений с [Azure Key Vault](/azure/key-vault/) для расширенного управления секретами. При получении [доступа к Key Vault с помощью управляемого удостоверения службы](../key-vault/tutorial-web-application-keyvault.md) приложение службы приложений может безопасно получить доступ к нужным секретам.

## <a name="network-isolation"></a>Сетевая изоляция

За исключением ценового уровня **Изолированный** на всех уровнях приложения запускаются в общей сетевой инфраструктуре в службе приложений. Например, общедоступные IP-адреса и интерфейсные подсистемы балансировки нагрузки используются совместно с другими клиентами. **Изолированный** уровень обеспечивает полную изоляцию сети с помощью запуска приложений внутри выделенной [среды службы приложений](environment/intro.md). Среда службы приложений запускается в вашем экземпляре [виртуальной сети Azure](/azure/virtual-network/). Это дает такие возможности: 

- ограничить доступ к сети с помощью [групп безопасности сети](../virtual-network/virtual-networks-nsg.md). 
- Выполнить обслуживание приложений через выделенную общедоступную конечную точку с выделенными внешними интерфейсами.
- Выполнить обслуживание внутреннего приложения с помощью внутреннего балансировщика нагрузки (ILB), который обеспечивает доступ только внутри виртуальной сети Azure. У балансировщика ILB есть IP-адрес из частной подсети, который обеспечивает полную изоляцию приложений из Интернета.
- [Использовать балансировщик ILB за брандмауэром веб-приложения(WAF)](environment/integrate-with-application-gateway.md). WAF предлагает защиту на уровне предприятия для общедоступных приложений, такую как защита от атак DDoS, фильтрация URI и предотвращение внедрения SQL.

Дополнительные сведения см. в статье [Общие сведения о средах службы приложений](environment/intro.md). 
