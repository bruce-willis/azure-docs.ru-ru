---
title: Общие сведения о локальном кэше службы приложений Azure | Документация Майкрософт
description: В этой статье описывается, как включить функцию локального кэша службы приложений Azure, а также как изменить его размер и запросить его состояние.
services: app-service
documentationcenter: app-service
author: cephalin
manager: jpconnock
editor: ''
tags: optional
keywords: ''
ms.assetid: e34d405e-c5d4-46ad-9b26-2a1eda86ce80
ms.service: app-service
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/04/2016
ms.author: cephalin
ms.openlocfilehash: 6729c87dcc9a85e2e3ccb6b4822213d38e2ba6f7
ms.sourcegitcommit: 31241b7ef35c37749b4261644adf1f5a029b2b8e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/04/2018
ms.locfileid: "43666120"
---
# <a name="azure-app-service-local-cache-overview"></a>Общие сведения о локальном кэше службы приложений Azure

> [!NOTE]
> Локальный кэш не поддерживается в приложениях-функциях и контейнерных приложениях службы приложений, например в [службе приложений в Linux](containers/app-service-linux-intro.md).


Содержимое веб-приложения Azure хранится в службе хранилища Azure; оно доступно в долгосрочном режиме в общей папке содержимого. Эта схема рассчитана на работу с различными приложениями и имеет следующие атрибуты:  

* Содержимое разделяется между несколькими экземплярами виртуальных машин в веб-приложении.
* Содержимое хранится в долгосрочном режиме и может быть изменено путем запуска веб-приложений.
* Файлы журналов и диагностических данных доступны в той же общей папке содержимого.
* При публикации нового содержимого происходит явное обновление содержимого общей папки. То же содержимое можно моментально просмотреть с помощью веб-сайта диспетчера служб, запустив веб-приложение (обычно некоторые технологии, такие как ASP.NET, перезапускают веб-приложение при каких-либо изменениях файлов, чтобы получить обновленное содержимое).

Многие веб-приложения используют все перечисленные возможности или одну из них, но некоторым веб-приложениям требуется лишь высокопроизводительное хранилище с содержимым только для чтения, из которого они могут запускаться с высоким уровнем доступности. Эти приложения могут использовать экземпляр виртуальной машины определенного локального кэша.

Функция локального кэша службы приложений Azure позволяет получить представление содержимого от лица веб-роли. Это содержимое представляет собой кэш содержимого хранилища с записью и отменой, который асинхронно создается во время запуска сайта. Когда кэш готов, сайт переключается на работу с кэшированным содержимым. Веб-приложения, работающие в локальном кэше, отличаются следующими преимуществами:

* На них не влияют задержки, возникающие во время доступа к содержимому службы хранилища Azure.
* На них не влияют запланированные обновления или незапланированные простои серверов, на которых размещена общая папка содержимого, а также любые другие перебои в работе службы хранилища Azure.
* Эти приложения реже перезапускаются после изменений, выполненных в общей папке хранилища.

## <a name="how-the-local-cache-changes-the-behavior-of-app-service"></a>Как локальный кэш изменяет поведение службы приложений
* Папка _D:\home_ содержит локальный кэш, который создается в экземпляре виртуальной машины при запуске приложения. В папке _D:\local_ по-прежнему размещается временное хранилище конкретной виртуальной машины.
* Локальный кэш содержит данные разового копирования папок общего хранилища содержимого _/site_ и _/siteextensions_ соответственно в папках _D:\home\site_ и _D:\home\siteextensions_. Файлы копируются в локальный кэш при запуске приложения. Размер обеих папок каждого приложения по умолчанию ограничен 300 МБ, но может быть увеличен до 2 ГБ.
* Локальный кэш доступен для чтения и записи. Но при перемещении виртуальных машин или перезапуске приложения все изменения в кэше отменяются. Не следует использовать локальный кэш для приложений, которые хранят критически важные данные в хранилище содержимого.
* Папки _D:\home\LogFiles_ и _D:\home\Data_ содержат файлы журналов и данные приложения. Две подпапки хранятся локально в экземпляре виртуальной машины и периодически копируются в общее хранилище содержимого. Приложения могут сохранять файлы журналов и данные, записывая их в эти папки. Хоть копирование в общее хранилище содержимого выполняется самым оптимальным образом, файлы журналов и данные могут быть потеряны из-за внезапного сбоя экземпляра виртуальной машины.
* На [потоковую передачу журналов](web-sites-enable-diagnostic-log.md#streamlogs) влияет оптимальное копирование. Вы можете наблюдать задержку в потоковой передаче журналов около одной минуты.
* В общем хранилище содержимого присутствуют некоторые изменения структуры папок _LogFiles_ и _Data_ для приложений, которые используют локальный кэш. Теперь в них есть подпапки, в которых используется следующий шаблон именования: "уникальный идентификатор + метка времени". Каждая подпапка соответствует экземпляру виртуальной машины, на котором запущено приложение.
* Остальные папки в _D:\home_ остаются в локальном кэше и не копируются в общее хранилище содержимого.
* Развертывание приложений через любой поддерживаемый метод публикуется напрямую в устойчивое общее хранилище содержимого. Чтобы обновить папки _D:\home\site_ и _D:\home\siteextensions_ в локальном кэше, необходимо перезапустить приложение. Чтобы организовать эффективный жизненный цикл, см. инструкции далее в этой статье.
* На веб-сайте диспетчера служб в качестве представления содержимого по умолчанию по-прежнему отображается общее хранилище содержимого.

## <a name="enable-local-cache-in-app-service"></a>Включение локального кэша в службе приложений
Локальный кэш настраивается с помощью нескольких зарезервированных параметров приложения. Эти параметры приложения можно настроить следующими способами.

* [портала Azure](#Configure-Local-Cache-Portal)
* [Диспетчер ресурсов Azure](#Configure-Local-Cache-ARM)

### <a name="configure-local-cache-by-using-the-azure-portal"></a>Настройка локального кэша на портале Azure
<a name="Configure-Local-Cache-Portal"></a>

Включите локальный кэш для каждого веб-приложения с помощью этого параметра приложения: `WEBSITE_LOCAL_CACHE_OPTION` = `Always`  

![Параметры приложения на портале Azure: локальный кэш](media/app-service-local-cache-overview/app-service-local-cache-configure-portal.png)

### <a name="configure-local-cache-by-using-azure-resource-manager"></a>Настройка локального кэша с помощью Azure Resource Manager
<a name="Configure-Local-Cache-ARM"></a>

```

...

{
    "apiVersion": "2015-08-01",
    "type": "config",
    "name": "appsettings",
    "dependsOn": [
        "[resourceId('Microsoft.Web/sites/', variables('siteName'))]"
    ],

"properties": {
        "WEBSITE_LOCAL_CACHE_OPTION": "Always",
        "WEBSITE_LOCAL_CACHE_SIZEINMB": "300"
    }
}

...
```

## <a name="change-the-size-setting-in-local-cache"></a>Изменение размера локального кэша
По умолчанию размер локального кэша равен **300 МБ**. Он включает папки /site и /siteextensions, которые копируются из хранилища содержимого, а также любые другие локально созданные журналы и папки данных. Чтобы увеличить это ограничение, используйте параметр приложения `WEBSITE_LOCAL_CACHE_SIZEINMB`. Размер кэша для каждого веб-приложения можно увеличить до **2 ГБ** (2000 МБ).

## <a name="best-practices-for-using-app-service-local-cache"></a>Рекомендации по использованию локального кэша службы приложений
Мы рекомендуем использовать локальный кэш в сочетании с функцией [промежуточных сред](../app-service/web-sites-staged-publishing.md) .

* Добавьте *прикрепленный* параметр приложения `WEBSITE_LOCAL_CACHE_OPTION` со значением `Always` в **рабочий** слот. Если вы используете параметр `WEBSITE_LOCAL_CACHE_SIZEINMB`, также добавьте его в рабочий слот в качестве прикрепленного параметра.
* Создайте **промежуточный** слот и выполните в нем публикацию. Если вы используете локальный кэш для рабочего слота, настройте промежуточный слот так, чтобы он не использовал локальный кэш. Таким образом упрощается жизненный цикл построения, развертывания и тестирования для промежуточного слота.
* Протестируйте свой веб-сайт относительно промежуточной области.  
* По завершении выполните [операцию переключения](../app-service/web-sites-staged-publishing.md#Swap) между промежуточным и рабочим слотами.  
* Прикрепленные параметры имеют имена и привязаны к слоту. Поэтому при переключении между промежуточным и рабочим слотами промежуточный слот наследует параметры локального кэша приложения. Через несколько минут новый рабочий слот будет запущен с локальным кэшем и будет разогрет после переключения. После завершения переключения слотов рабочий слот будет работать с локальным кэшем.

## <a name="frequently-asked-questions-faq"></a>Часто задаваемые вопросы
### <a name="how-can-i-tell-if-local-cache-applies-to-my-web-app"></a>Как узнать, можно ли использовать локальный кэш с моим веб-приложением?
Да, если веб-приложению требуется высокопроизводительное надежное хранилище содержимого, а также если это веб-приложение не сохраняет в хранилище важные данные во время работы, а его общий размер не превышает 2 ГБ. Чтобы узнать общий размер папок /site и /siteextensions, используйте расширение сайта Azure Web Apps Disk Usage.

### <a name="how-can-i-tell-if-my-site-has-switched-to-using-local-cache"></a>Как узнать, переключился ли мой веб-сайт на использование локального кэша?
При использовании функции локального кэша с функцией промежуточных сред операция переключения не завершится, пока не инициализируется локальный кэш. Чтобы определить, работает ли веб-сайт с локальным кэшем, можно проверить переменную среды `WEBSITE_LOCALCACHE_READY`для рабочего процесса. Следуйте инструкциям на странице [переменных среды рабочего процесса](https://github.com/projectkudu/kudu/wiki/Process-Threads-list-and-minidump-gcdump-diagsession#process-environment-variable) , чтобы получить доступ к переменной среды рабочего процесса для нескольких экземпляров.  

### <a name="i-just-published-new-changes-but-my-web-app-does-not-seem-to-have-them-why"></a>Новые изменения только что опубликованы, но они еще не отразились в моем веб-приложении. Почему?
Если веб-приложение использует локальный кэш, перезапустите сайт, чтобы применить последние изменения. Не хотите публиковать изменения на рабочем сайте? См. информацию о вариантах слотов в предыдущем разделе рекомендаций.

### <a name="where-are-my-logs"></a>Где находятся мои журналы?
Если вы используете локальный кэш, журналы и папки данных выглядят немного иначе. Однако структура вложенных папок остается прежней, за исключением того, что они размещаются во вложенной папке с именем в формате "уникальный идентификатор виртуальной машины + метка времени".

### <a name="i-have-local-cache-enabled-but-my-web-app-still-gets-restarted-why-is-that-i-thought-local-cache-helped-with-frequent-app-restarts"></a>Локальный кэш включен, но мое веб-приложение все равно перезапускается. Почему? Я подумал, что локальный кэш поможет снизить частоту перезапуска приложения.
Локальный кэш помогает предотвратить перезапуск веб-приложений, которые используют хранилище. Но ваше веб-приложение все равно может быть перезапущено во время планируемых обновлений инфраструктуры виртуальной машины. В целом при использовании локального кэша приложение перезапускается реже.

### <a name="does-local-cache-exclude-any-directories-from-being-copied-to-the-faster-local-drive"></a>Исключается ли при использовании локального кэша копирование каких-либо каталогов на более быстрый локальный диск?
В рамках операции копирования содержимого хранилища исключаются любые папки с именем repository. Это помогает в ситуациях, когда содержимое узла может содержать репозиторий системы управления версиями, который может быть не нужен для ежедневных операций веб-приложения. 
