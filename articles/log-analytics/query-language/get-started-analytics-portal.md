---
title: Начало работы с Log Analytics на портале Azure | Документация Майкрософт
description: В этой статье описано, как использовать портал аналитики для написания запросов в Log Analytics.
services: log-analytics
documentationcenter: ''
author: bwren
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 08/20/2018
ms.author: bwren
ms.component: na
ms.openlocfilehash: 3bcc5368a99dc7c7c32381ca0226119d81fc2c0a
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46978205"
---
# <a name="get-started-with-log-analytics-in-the-azure-portal"></a>Начало работы с Log Analytics на портале Azure

[!INCLUDE [log-analytics-demo-environment](../../../includes/log-analytics-demo-environment.md)]

В этом руководстве рассматривается использование страницы Log Analytics на портале Azure (в настоящее время на стадии предварительной версии) для записи запросов Log Analytics. Вы научитесь:

- писать простые запросы;
- разобраться со схемой данных;
- фильтровать, сортировать и группировать результаты;
- применять диапазон времени;
- создавать диаграммы;
- сохранять и загружать запросы;
- экспортировать запросы и совместно использовать их.


## <a name="meet-the-log-analytics-page"></a>Знакомство со страницей Log Analytics 
Страница Log Analytics — это веб-инструмент, используемый для записи и выполнения запросов Azure Log Analytics. Откройте ее, выбрав **Журналы (Предварительная версия)** в меню Log Analytics. Она начинается с нового пустого запроса.

![главная страница](media/get-started-analytics-portal/homepage.png)



## <a name="basic-queries"></a>Базовые запросы
Запросы могут использоваться для поиска терминов, определения тенденций, анализа шаблонов и предоставления многих других сведений на основе ваших данных. Начните с базового запроса:

```Kusto
Event | search "error"
```

Этот запрос выполняет в таблице _Event_ поиск записей, содержащих термин "error" в любом свойстве.

Запросы могут начинаться с имени таблицы или команды **search**. Пример выше начинается с имени таблицы _Event_, которое определяет область запроса. Символ вертикальной черты (|) разделяет команды, поэтому выходные данные первой команды содержатся во входных данных следующей команды. Вы можете добавить любое количество команд в один запрос.

Другой способ написать тот же запрос:

```Kusto
search in (Event) "error"
```

В этом примере команда **search** привязана к таблице _Event_, и во всех записях в этой таблице выполняется поиск термина "error".

## <a name="running-a-query"></a>Выполнение запроса
Выполните запрос, нажав кнопку **Запуск** или клавиши **SHIFT+ENTER**. Рассмотрите следующие сведения, которые определяют код для запуска, и возвращаемые данные:

- Разрывы строк: один разрыв делает запрос более четким. Несколько разрывов строк разделяют его на отдельные запросы.
- Курсор: поместите курсор где-нибудь внутри запроса для его выполнения. Текущий запрос считается кодом до тех пор, пока не будет найдена пустая строка.
- Диапазон времени: по умолчанию установлен диапазон времени _за последние 24 часа_. Чтобы использовать другой диапазон, используйте инструмент выбора времени или добавьте в свой запрос явный фильтр диапазона времени.


## <a name="understand-the-schema"></a>Изучение схемы
Схема представляет собой коллекцию таблиц, визуально сгруппированных в логической категории. Некоторые из категорий относятся к решениям мониторинга. Категория _LogManagement_ содержит общие данные, такие как события Windows и Syslog, данные о производительности и пакеты пульса клиента.

![Схема](media/get-started-analytics-portal/schema.png)

В каждой таблице данные упорядочены в столбцы с разными типами данных, которые указаны с помощью значков рядом с именем столбца. Например, таблица _Event_, показанная на снимке экрана, содержит такие столбцы, как _Computer_ с текстовым типом данных, _EventCategory_ с числовым типом данных и _TimeGenerated_ с типом даты и времени.

## <a name="filter-the-results"></a>Фильтрация результатов
Начните с получения всех сведений в таблице _Event_.

```Kusto
Event
```

Страница Log Analytics автоматически задает область результатов по следующим критериям:

- Диапазон времени: по умолчанию запросы ограничиваются последними 24 часами.
- Количество результатов: результаты не могут включать более 10 000 записей.

Этот запрос очень общий, и он возвращает слишком много результатов, поэтому является неэффективным. Вы можете фильтровать результаты с помощью элементов таблицы или путем явного добавления фильтра в запрос. Фильтрация результатов с помощью элементов таблицы применяется к имеющемуся результирующему набору, тогда как фильтр в самом запросе возвращает новый отфильтрованный результирующий набор и, следовательно, может обеспечивать более точные результаты.

### <a name="add-a-filter-to-the-query"></a>Добавление фильтра в запрос
Слева от каждой записи находится стрелка. Щелкните эту стрелку, чтобы открыть сведения о конкретной записи.

Наведите указатель мыши над именем столбца, чтобы появились значки "+" и "-". Чтобы добавить фильтр, который будет возвращать только записи с одинаковым значением, щелкните значок "+". Щелкните значок "-", чтобы исключить записи с этим значением, а затем нажмите кнопку **Запуск**, чтобы снова запустить запрос.

![Добавление фильтра к запросу](media/get-started-analytics-portal/add-filter.png)

### <a name="filter-through-the-table-elements"></a>Фильтрация по элементам таблицы
Теперь давайте сосредоточимся на событиях с уровнем серьезности _Ошибка_. Серьезность указана в столбце с именем _EventLevelName_. Прокрутите вправо, чтобы увидеть этот столбец.

Щелкните значок "Фильтр" рядом с заголовком столбца, а во всплывающем окне выберите значения, которые _начинаются со_ слова _error_:

![Фильтр](media/get-started-analytics-portal/filter.png)


## <a name="sort-and-group-results"></a>Сортировка и группирование результатов
Теперь результаты сужены и включают только события ошибок из SQL Server, созданные за последние 24 часа. Однако результаты не отсортированы каким-либо образом. Чтобы отсортировать результаты по определенному столбцу, например, _timestamp_, щелкните заголовок столбца. Первый щелчок сортирует по возрастанию, а второй — по убыванию.

![Сортировка столбца](media/get-started-analytics-portal/sort-column.png)

Другой способ упорядочить результаты — по группам. Чтобы сгруппировать результаты по определенному столбцу, просто перетащите заголовок столбца над другими столбцами. Чтобы создать подгруппы, перетащите другие столбцы на верхнюю панель.

![Группы](media/get-started-analytics-portal/groups.png)

## <a name="select-columns-to-display"></a>Выбор столбцов для отображения
Таблица результатов часто содержит множество столбцов. Вы можете обнаружить, что некоторые возвращенные столбцы не отображаются по умолчанию, или вы можете удалить некоторые столбцы, которые отображаются. Чтобы выбрать столбцы для отображения, нажмите кнопку "Столбцы":

![Выбор столбцов](media/get-started-analytics-portal/select-columns.png)


## <a name="select-a-time-range"></a>Выбор диапазона времени
По умолчанию страница Log Analytics применяет диапазон времени за _последние 24 часа_. Чтобы использовать другой диапазон, выберите другое значение через средство выбора времени и нажмите кнопку **Запуск**. В дополнение к заданным значениям вы можете использовать параметр _Настраиваемый диапазон времени_, чтобы выбрать абсолютный диапазон для своего запроса.

![Средство выбора времени](media/get-started-analytics-portal/time-picker.png)

При выборе настраиваемого диапазона времени выбранные значения указаны в формате UTC, который может отличаться от локального часового пояса.

Если запрос явно содержит фильтр по столбцу _TimeGenerated_, в заголовке средства выбора времени будет отображено _Set in query_ (Задано в запросе). Выбор вручную будет отключен, чтобы предотвратить конфликт.


## <a name="charts"></a>Диаграммы
Кроме возврата результатов в таблице, результаты запроса могут быть представлены в визуальных форматах. В качестве примера используйте следующий запрос:

```Kusto
Event 
| where EventLevelName == "Error" 
| where TimeGenerated > ago(1d) 
| summarize count() by Source 
```

По умолчанию результаты отображаются в таблице. Щелкните _Диаграмма_, чтобы увидеть результаты в графическом представлении:

![Линейчатая диаграмма](media/get-started-analytics-portal/bar-chart.png)

Результаты показаны на линейчатой диаграмме с накоплением. Щелкните _Гистограмма с накоплением_ и выберите _Круговая диаграмма_, чтобы отобразить другое представление результатов:

![Круговая диаграмма](media/get-started-analytics-portal/pie-chart.png)

Различные свойства представления, например оси x и y, или группирования и разделения параметров можно изменить вручную на панели элементов управления.

Можно также задать нужное представление в самом запросе, используя оператор отображения.

### <a name="smart-diagnostics"></a>Интеллектуальная диагностика
Если на временной диаграмме есть внезапный пик или шаг в данных, то вы можете видеть на линии выделенную точку. Это указывает на то, что _интеллектуальная диагностика_ выявила сочетание свойств, которое отфильтровывает внезапные изменения. Щелкните данную точку, чтобы узнать больше о фильтре и просмотреть отфильтрованную версию. Эти сведения могут помочь определить причину изменения.

![Интеллектуальная диагностика](media/get-started-analytics-portal/smart-diagnostics.png)

## <a name="pin-to-dashboard"></a>Закрепить на панели мониторинга
Вы можете закрепить диаграмму или таблицу на одной из общих панелей мониторинга Azure. Для этого просто щелкните значок закрепления.

![Закрепить на панели мониторинга](media/get-started-analytics-portal/pin-dashboard.png)

При закреплении на панели мониторинга к диаграмме применяются определенные упрощения.

- Столбцы и строки таблицы. Чтобы закрепить таблицу на панели мониторинга, она должна содержать четыре или меньше столбцов. Отображаются только семь верхних строк.
- Ограничение времени. Автоматически отображаются запросы только за последние 14 дней.
- Ограничение количества ячеек. Если отображается диаграмма, содержащая много отдельных ячеек, менее заполненные ячейки автоматически группируются в одну ячейку под названием _Другие_.

## <a name="save-queries"></a>Сохранение запросов
После создания удобного запроса вы можете сохранить его или поделиться им с другими. Значок **Сохранить** находится на верхней панели.

Вы можете сохранить либо всю страницу запроса, либо один запрос как функцию. Функции — это запросы, на которые также могут ссылаться другие запросы. Чтобы сохранить запрос как функцию, вы должны указать псевдоним функции, который является именем, используемым для вызова этого запроса, когда на него ссылаются другие запросы.

![Сохранение функции](media/get-started-analytics-portal/save-function.png)

Запросы Log Analytics всегда сохраняются в выбранную рабочую область и используются другими пользователями этой рабочей области.

## <a name="load-queries"></a>Загрузка запросов
Значок обозревателя запросов находится в верхней правой области. Здесь содержится список всех сохраненных запросов по категориям. Он также позволяет отмечать определенные запросы как избранные, чтобы быстро найти их в будущем. Дважды щелкните сохраненный запрос, чтобы добавить его в текущее окно.

![Обозреватель запросов](media/get-started-analytics-portal/query-explorer.png)

## <a name="export-and-share-as-link"></a>Экспорт и создание общей ссылки на запрос
Страница Log Analytics поддерживает несколько методов экспорта:

- Excel: сохраните результаты как CSV-файл.
- Power BI: экспортируете результаты в Power BI. Дополнительные сведения см.в статье [Импорт данных Log Analytics Azure в Power BI](../log-analytics-powerbi.md).
- Общий доступ к ссылке: на сам запрос можно создать общую ссылку, которую затем можно отправить для выполнения другими пользователями, у которых есть доступ к той же рабочей области.

## <a name="next-steps"></a>Дополнительная информация

- Узнайте больше о [написании запросов Log Analytics](get-started-queries.md).
