---
title: Создание правил события и управление ими в приложении Azure IoT Central | Документация Майкрософт
description: Правила события Azure IoT Central позволяют отслеживать устройства практически в реальном времени и автоматически вызывать действия (например, отправлять сообщение электронной почты) при срабатывании правила.
author: ankitgupta
ms.author: ankitgup
ms.date: 08/14/2018
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: 40c7b2865795f8c6a5cfbabe4d59aea1715d4a57
ms.sourcegitcommit: 8ebcecb837bbfb989728e4667d74e42f7a3a9352
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2018
ms.locfileid: "42146059"
---
# <a name="create-an-eevent-rule-and-set-up-notifications-in-your-azure-iot-central-application"></a>Создание правила события и настройка уведомлений в приложении Azure IoT Central

Вы можете использовать Azure IoT Central для удаленного мониторинга подключенных устройств. Правила Azure IoT Central позволяют вам отслеживать устройства практически в реальном времени и автоматически вызывать действия, например, отправлять сообщение электронной почты или активировать Microsoft Flow. Всего в несколько щелчков вы можете определить условие для отслеживания данных устройства и настроить соответствующее действие. В этой статье объясняется, как создать правила для отслеживания событий, отправляемых устройством.

Устройства могут использовать измерение событий для отправки важных или информационных событий. Правило события активируется, когда с устройства передается выбранное событие

## <a name="create-an-event-rule"></a>Создание правила события

Чтобы создать правило события, шаблон устройства должен иметь по крайней мере одно определенное измерение события. В этом примере используется устройство охлаждаемого торгового автомата, сообщающее о событии сбоя в работе мотора вентилятора. Правило отслеживает передаваемые устройством данные события и отправляет сообщение при каждой передаче события.

1. Используя Device Explorer, откройте шаблон устройства, для которого вы добавляете правило.

1. В выбранном шаблоне щелкните существующее устройство. 

    >[!TIP] 
    >Если в шаблоне нет каких-либо устройств, сначала добавьте новое устройство.

1. Если вы еще не создали правило, появится следующий экран:

    ![Правила отсутствуют](media\howto-create-event-rules\Rules_Landing_Page.png)


1. На вкладке **Правила** щелкните **+ Новое правило**, чтобы просмотреть доступные для создания типы правил.


1. Щелкните плитку **Событие**, чтобы создать правило.

    ![Типы правил](media\howto-create-event-rules\Rule_Types.png)

    
1. Введите имя, определяющее правило в этом шаблоне устройства.

1. Чтобы немедленно включить правило для всех устройств, созданных на основе этого шаблона, переведите переключатель **Включить правило** в положение "Вкл." для всех устройств в этом шаблоне.

    ![Сведения о правиле](media\howto-create-event-rules\Rule_Detail.png)

    Правило автоматически применяется ко всем устройствам в шаблоне устройств.

### <a name="configure-the-rule-conditions"></a>Настройка условий правила

Условие определяет критерии, которые отслеживаются этим правилом.

1. Выберите **+** рядом с полем **Условия** для добавления нового условия.

1. Из раскрывающегося списка выберите измерение события, которое требуется отслеживать. В этом примере выбрано событие **Fan Motor Error** (Ошибка мотора вентилятора).

   ![Условие](media\howto-create-event-rules\Condition_Filled_Out.png) 


1. При желании вы также можете установить для параметра **Агрегирование** значение **Счетчик** и предоставить соответствующий порог.

    - Без агрегирования правило запускается для каждой точки данных события, которая соответствует условию. Например, если вы настроите условие для запуска правила при возникновении события Fan Motor Error (Ошибка двигателя вентилятора), правило сработает почти сразу, когда устройство сообщит об этом событии.
    - Если счетчик используется как агрегированная функция, вам необходимо предоставить **порог** и **окно времени агрегирования**, в которым необходимо оценить условие. В этом случае количество событий агрегируется, и правило запускается только в том случае, если агрегированное количество событий соответствует порогу.
 
    Например, если вы хотите оповещать о наличии более трех событий устройства в течение 5 минут, выберите событие и установите агрегатную функцию "счетчик", оператор "больше чем" и "порог" равный 3. Установите для периода времени агрегирования значение "5 минут". Правило срабатывает, когда устройство отправляет более трех событий в течение 5 минут. Частота оценки правила такая же, как и **период времени агрегирования**. Это означает, что в этом примере правило оценивается один раз каждые 5 минут. 

    ![Добавление условия события](media\howto-create-event-rules\Aggregate_Condition_Filled_Out.png)

    >[!NOTE] 
    >В поле **Условие** можно добавить несколько измерений события. Если задано несколько условий, для срабатывания правила необходимо, чтобы были соблюдены все условия. Каждое условие неявно присоединяется с использованием предложения AND. При использовании агрегирования каждое измерение должно быть агрегировано.

### <a name="configure-actions"></a>Настройка действий

В этом разделе показано, как настроить действия, предпринимаемые при запуске правила. Действия вызываются в том случае, если соблюдаются все условия, указанные в правиле.

1. Выберите **+** рядом с разделом **Действия**. Здесь отобразится список доступных действий. 

    ![Добавление действия](media\howto-create-event-rules\Add_Action.png)

1. Выберите действие **Электронное письмо**, введите допустимый адрес электронной почты в поле **Кому** и укажите примечание, отображаемое в тексте сообщения при срабатывании правила.

    > [!NOTE]
    > Письма отправляются только пользователям, которые были добавлены в приложение и входили в систему минимум один раз. Узнайте больше об [управлении пользователями](howto-administer.md) в Azure IoT Central.

   ![Настройка действия](media\howto-create-event-rules\Configure_Action.png)

1. Чтобы сохранить правило, нажмите кнопку **Сохранить**. Правило станет активным в течение нескольких минут и начнет выполнять мониторинг событий, отправляемых в приложение. Если условие, указанное в правиле, соответствует требованиям, правило активирует настроенное действие отправки сообщения электронной почты.

Вы можете добавить другие действия в правило, например действия Microsoft Flow и веб-перехватчики. Для каждого правила можно добавить до 5 действий.

- [действие Microsoft Flow](howto-add-microsoft-flow.md) для запуска рабочего процесса в Microsoft Flow при срабатывании правила; 
- [действие веб-перехватчика](howto-create-webhooks.md) для уведомления других служб при срабатывании правила.

## <a name="parameterize-the-rule"></a>Параметризация правила

Действия также можно настроить, используя **свойство устройства** в качестве параметра. Если адрес электронной почты хранится в виде свойства устройства, его можно использовать при определении адреса **Кому**.

## <a name="delete-a-rule"></a>Удаление правила

Если вам больше не нужно правило, удалите его. Для этого откройте правило и щелкните **Удалить**. Удаление правила приводит к его удалению из шаблона устройства и всех связанных устройств.

## <a name="enable-or-disable-a-rule-for-a-device-template"></a>Включение или отключение правила для шаблона устройства

Перейдите к устройству и выберите правило, которое требуется включить или отключить. Переведите переключатель **Enable rule for all devices of this template** (Включить правило для всех устройств в шаблоне), чтобы включить или отключить правило для всех устройств, связанных с определенным шаблоном.

## <a name="enable-or-disable-a-rule-for-a-device"></a>Включение или отключение правила для устройства

Перейдите к устройству и выберите правило, которое требуется включить или отключить. Переведите переключатель **Enable rule for this device** (Включить правило для этого устройства), чтобы включить или отключить правило для этого устройства.

## <a name="next-steps"></a>Дополнительная информация

Вы узнали, как создавать правила в приложении Azure IoT Central, а значит вы готовы к следующему шагу:

- [Добавление действия Microsoft Flow в правилах](howto-add-microsoft-flow.md)
- [Добавление действия веб-перехватчика в правилах](howto-create-webhooks.md)
- [Управление устройствами](howto-manage-devices.md)
