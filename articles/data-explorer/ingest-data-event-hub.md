---
title: Краткое руководство. Прием данных из концентратора событий в обозреватель данных Azure
description: В этом кратком руководстве описывается, как выполняется прием данных (загрузка) в обозреватель данных Azure из концентратора событий.
services: data-explorer
author: mgblythe
ms.author: mblythe
ms.reviewer: mblythe
ms.service: data-explorer
ms.topic: quickstart
ms.date: 09/24/2018
ms.openlocfilehash: acc18b6414e62a1f8239562158b4b80219c5d7c1
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46976828"
---
# <a name="quickstart-ingest-data-from-event-hub-into-azure-data-explorer"></a>Краткое руководство. Прием данных из концентратора событий в обозреватель данных Azure

Обозреватель данных Azure — это быстрая и высокомасштабируемая служба для изучения данных журналов и телеметрии. Обозреватель данных Azure позволяет выполнять прием (загрузку) данных из концентраторов событий, платформы потоковой передачи больших данных и службы приема данных событий. Концентраторы событий могут обрабатывать миллионы событий в секунду практически в режиме реального времени. В этом кратком курсе вы научитесь создавать концентратор событий, подключиться к нему из обозревателя данных Azure и просматривать поток данных, проходящих через систему.

Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись](https://azure.microsoft.com/free/) Azure, прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

Кроме подписки Azure, для прохождения этого краткого курса необходимо следующее:

* [Тестовый кластер и база данных](create-cluster-database-portal.md)

* [Пример приложения](https://github.com/Azure-Samples/event-hubs-dotnet-ingest), создающего данные

* [Visual Studio 2017 версии 15.3.2 или более поздней](https://www.visualstudio.com/vs/) для выполнения примера приложения

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портале Azure](https://portal.azure.com/).

## <a name="create-an-event-hub"></a>Создание концентратора событий

В этом кратком курсе создаются демонстрационные данные, которые передаются в концентратор событий. Первым шагом является создание концентратора событий. Это делается с помощью шаблона Azure Resource Manager (ARM) на портале Azure.

1. Выберите следующую кнопку, чтобы начать развертывание.

    [![Развертывание в Azure](media/ingest-data-event-hub/deploybutton.png)](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2F201-event-hubs-create-event-hub-and-consumer-group%2Fazuredeploy.json)

    Кнопка **Развернуть в Azure** выполняет переход на портал Azure для заполнения формы развертывания.

    ![Развернуть в Azure](media/ingest-data-event-hub/deploy-to-azure.png)

1. Выберите подписку, в которой нужно создать концентратор событий, и создайте группу ресурсов с именем *test-hub-rg*.

    ![Создание группы ресурсов](media/ingest-data-event-hub/create-resource-group.png)

1. Заполните форму, указав следующую информацию.

    ![Форма развертывания](media/ingest-data-event-hub/deployment-form.png)

    Используйте значения по умолчанию для всех параметров, отсутствующих в следующей таблице.

    **Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Подписка | Ваша подписка | Выберите подписку Azure, которую нужно использовать для своего концентратора событий.|
    | Группа ресурсов | *test-hub-rg* | Создайте новую группу ресурсов. |
    | Расположение | *Западная часть США* | Выберите *Западная часть США* для этого краткого руководства. Для производственной системы выберите регион, лучше всего соответствующий вашим потребностям.
    | Имя пространства имен | Уникальное имя пространства имен | Выберите уникальное имя, идентифицирующее пространство имен. Например, *mytestnamespace*. К введенному имени добавляется имя домена *servicebus.windows.net*. Имя может содержать только буквы, цифры и дефисы. Имя должно начинаться с буквы или цифры и заканчиваться буквой или цифрой. Длина значения в символах должна быть от 6 до 50.
    | Имя концентратора событий | *test-hub* | Концентратор событий находится в пространстве имен, предоставляющем уникальный контейнер области. Имя концентратора событий должно быть уникальным в пределах пространства имен. |
    | Имя группы потребителей | *test-group* | Группы получателей событий позволяют каждому из нескольких получающих события приложений иметь отдельное представление потока событий. |
    | | |

1. Выберите **Купить**, что подтверждает создание ресурсов в вашей подписке.

1. На панели инструментов щелкните **Уведомления** (значок колокольчика), чтобы отслеживать процесс подготовки. Успешное выполнение развертывания может занять несколько минут, но теперь можно перейти к следующему шагу.

## <a name="create-a-target-table-in-azure-data-explorer"></a>Создание целевой таблицы в обозревателе данных Azure

Теперь создадим таблицу в обозревателе данных Azure, в которые концентраторы событий будут отправлять данные. Таблица создается в кластере и базе данных, представленных в разделе **Необходимые компоненты**.

1. На портале Azure, в своем кластере, выберите **Запрос**.

    ![Ссылка приложения запроса](media/ingest-data-event-hub/query-explorer-link.png)

1. Скопируйте следующую команду в окно и выберите **Выполнить**.

    ```Kusto
    .create table TestTable (TimeStamp: datetime, Name: string, Metric: int, Source:string)
    ```

    ![Выполнение создания запроса](media/ingest-data-event-hub/run-create-query.png)

1. Скопируйте следующую команду в окно и выберите **Выполнить**.

    ```Kusto
    .create table TestTable ingestion json mapping 'TestMapping' '[{"column":"TimeStamp","path":"$.timeStamp","datatype":"datetime"},{"column":"Name","path":"$.name","datatype":"string"},{"column":"Metric","path":"$.metric","datatype":"int"},{"column":"Source","path":"$.source","datatype":"string"}]'
    ```
    Эта команда сопоставляет входящие данные JSON с именами и типами данных столбцов, используемыми при создании таблицы.

## <a name="connect-to-the-event-hub"></a>Подключение к концентратору событий

Теперь подключимся к концентратору событий с помощью обозревателя данных Azure, так чтобы данные, поступающие в концентратор событий, потоком передавались в тестовую таблицу.

1. Выберите **уведомления** на панели инструментов, чтобы убедиться в успешном развертывании концентратора событий.

1. В созданном кластере выберите **Базы данных**, затем **TestDatabase**.

    ![Выбор тестовой базы данных](media/ingest-data-event-hub/select-test-database.png)

1. Выберите **Прием данных**, затем **Добавить подключение к данным**.

    ![Прием данных](media/ingest-data-event-hub/data-ingestion-create.png)

1. Заполните форму, указав следующую информацию, затем нажмите кнопку **Создать**.

    ![Подключение концентратора событий](media/ingest-data-event-hub/event-hub-connection.png)

    **Параметр** | **Рекомендуемое значение** | **Описание поля**
    |---|---|---|
    | Имя подключения к данным | *test-hub-connection* | Имя создаваемого подключения к обозревателю данных Azure.|
    | Пространство имен концентратора событий | Уникальное имя пространства имен | Имя, выбранное ранее и определяющее пространство имен. |
    | концентратор событий; | *test-hub* | Созданный концентратор событий. |
    | Группа потребителей | *test-group* | Группа получателей событий, определенная в созданном концентраторе событий. |
    | Таблица | *TestTable* | Таблица, созданная в базе данных **TestDatabase**. |
    | Формат данных | *JSON* | Поддерживаются форматы JSON и CSV. |
    | Сопоставление столбцов | *TestMapping* | Сопоставление, созданное в базе данных **TestDatabase**. |

    В этом кратком руководстве используется *статическая маршрутизация* из концентратора событий, в которой можно указать имя таблицы, формат файла и сопоставление. Можно также использовать динамическую маршрутизацию, при которой эти свойства устанавливаются приложением.

## <a name="copy-the-connection-string"></a>Копирование строки подключения

При запуске приложения с целью создания демонстрационных данных потребуется строка подключения для пространства имен концентратора событий.

1. В созданном пространстве имен концентратора событий выберите **Политики общего доступа**, затем **RootManageSharedAccessKey**.

    ![Политики общего доступа](media/ingest-data-event-hub/shared-access-policies.png)

1. Скопируйте значение в поле **Строка подключения — первичный ключ**.

    ![Строка подключения](media/ingest-data-event-hub/connection-string.png)

## <a name="generate-sample-data"></a>Создание примера данных

Теперь, когда обозреватель данных Azure и концентратор событий соединены, используйте загруженное приложение для создания данных.

1. Откройте решение для примера приложения в Visual Studio.

1. В файле *program.cs* обновите константу `connectionString`, указав строку подключения, скопированную из пространства имен концентратора событий.

    ```csharp
    const string eventHubName = "test-hub";
    // Copy the connection string ("Connection string-primary key") from your Event Hub namespace.
    const string connectionString = @"<YourConnectionString>";
    ```

1. Выполните сборку и запустите приложение. Приложение отправляет сообщения в концентратор событий, и он печатает состояние каждые десять секунд.

1. После отправки приложением нескольких сообщений перейдите к следующему шагу: просмотрите поток данных, поступающий в концентратор событий центра и тестовую таблицу.

## <a name="review-the-data-flow"></a>Просмотр потока данных

1. На портале Azure, в разделе своего концентратора событий, во время работы приложения появится пик активности.

    ![График концентратора событий](media/ingest-data-event-hub/event-hub-graph.png)

1. Вернитесь в приложение и остановите его, когда оно достигнет сообщения 99.

1. Выполните следующий запрос в тестовой базе данных, чтобы проверить, сколько сообщений поступило в базу данных к этому моменту.

    ```Kusto
    TestTable
    | count
    ```

1. Выполните следующий запрос, чтобы увидеть содержимое сообщений.

    ```Kusto
    TestTable
    ```

    Результат должен быть похож на следующее.

    ![Набор результатов для сообщений](media/ingest-data-event-hub/message-result-set.png)

## <a name="clean-up-resources"></a>Очистка ресурсов

Если не планируется повторно использовать концентратор событий, очистите **test-hub-rg**, чтобы избежать взимания оплаты.

1. На портале Azure выберите **Группа ресурсов** слева, а затем выберите созданную группу ресурсов.  

    Если левое меню свернуто, нажмите ![кнопку "Развернуть",](media/ingest-data-event-hub/expand.png) чтобы развернуть его.

   ![Выбор удаляемой группы ресурсов](media/ingest-data-event-hub/delete-resources-select.png)

1. В разделе **test-resource-group** выберите **Удалить группу ресурсов**.

1. В новом окне введите имя удаляемой группы ресурсов (*test-hub-rg*) и нажмите кнопку **Удалить**.

## <a name="next-steps"></a>Дополнительная информация

> [!div class="nextstepaction"]
> [Краткое руководство. Запрос данных в обозревателе данных Azure](web-query-data.md)
