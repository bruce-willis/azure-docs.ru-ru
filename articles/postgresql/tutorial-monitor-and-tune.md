---
title: Руководство по мониторингу и настройке базы данных Azure для PostgreSQL
description: В этом руководстве описывается мониторинг и настройка базы данных Azure для PostgreSQL.
services: postgresql
author: rachel-msft
ms.author: raagyema
ms.service: postgresql
ms.topic: tutorial
ms.date: 09/24/2018
ms.openlocfilehash: c21236026af960af0697978e49a0075fc9cf77ef
ms.sourcegitcommit: 32d218f5bd74f1cd106f4248115985df631d0a8c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2018
ms.locfileid: "46960300"
---
# <a name="tutorial-monitor-and-tune-azure-database-for-postgresql"></a>Руководство. Мониторинг и настройка базы данных Azure для PostgreSQL

База данных Azure для PostgreSQL включает компоненты, которые помогут вам понять и улучшить производительность сервера. Из этого учебного курса вы узнаете следующее:
> [!div class="checklist"]
> * Включение сбора статистики по запросам ожиданию
> * Получение и использование собранных данных
> * Просмотр производительности запросов и статистики ожидания за период
> * Анализ базы данных для получения рекомендаций по производительности
> * Применение рекомендаций по повышению производительности

## <a name="before-you-begin"></a>Перед началом работы
Вам нужна база данных Azure для сервера PostgreSQL с PostgreSQL версии 9.6 или 10. Для создания сервера выполните действия, описанные в [этом руководстве](tutorial-design-database-using-azure-portal.md).

> [!IMPORTANT]
> **Хранилище запросов**, **анализ производительности запросов** и **рекомендации по производительности** сейчас находятся на этапе общедоступной предварительной версии.

## <a name="enabling-data-collection"></a>Включение сбора данных
[Хранилище запросов](concepts-query-store.md) записывает историю запросов, а также собирает статистику по серверу и сохраняет ее в базу данных **azure_sys** на вашем сервере. Это подключаемая возможность. Чтобы ее включить, выполните следующие действия:

1. Перейдите на портал Azure.

2. Выберите сервер базы данных Azure для PostgreSQL.

3. Выберите **Параметры сервера**, которые находятся в разделе **Параметры** в меню в левой части экрана.

4. Присвойте параметру **pg_qs.query_capture_mode** значение **TOP**, чтобы запустить сбор данных по производительности запросов. Присвойте параметру **pgms_wait_sampling.query_capture_mode** значение **ALL**, чтобы запустить сбор статистики ожидания. Щелкните Save (Сохранить).
   
   ![Параметры сервера хранилища запросов](./media/tutorial-performance-intelligence/query-store-parameters.png)

5. Подождите около 20 минут, пока первый набор данных не сохранится в базе данных **azure_sys**.


## <a name="performance-insights"></a>Анализ производительности
Представление [анализа производительности запросов](concepts-query-performance-insight.md) на портале Azure содержит визуализации ключевых данных из хранилища запросов. 

1. На странице портала в базе данных Azure для сервера PostgreSQL выберите **анализ производительности запросов** в разделе **Поддержка и устранение неполадок** в меню в левой части экрана.

2. На вкладке **Длительные запросы** отображаются 5 наиболее частых запросов, упорядоченных по средней продолжительности выполнения и объединенных в 15-минутные интервалы. 
   
   ![Целевая страница анализа производительности запросов](./media/tutorial-performance-intelligence/query-performance-insight-landing-page.png)

   Дополнительные запросы можно выбрать в раскрывающемся списке **Количество запросов**. При этом цвета, соответствующие тому или иному идентификатору запроса на графике, могут изменяться.

3. Чтобы уменьшить временной интервал графика, перетащите его границу.

4. Для просмотра более коротких или более длинных периодов используйте соответственно значки увеличения и уменьшения масштаба.

5. Дополнительные сведения о длительных запросах за выбранный временной интервал см. в таблице под графиком.

6. Откройте вкладку **Статистика ожидания**, чтобы посмотреть визуализации ожидания на сервере.
   
   ![Статистика ожидания в анализе производительности запросов](./media/tutorial-performance-intelligence/query-performance-insight-wait-statistics.png)

### <a name="permissions"></a>Разрешения
Чтобы просматривать текст запросов в анализе производительности запросов, требуются разрешения **Владельца** или **Участника**. **Модуль чтения** может просматривать графики и таблицы, но не текст запросов.


## <a name="performance-recommendations"></a>Рекомендации по производительности
Функция [рекомендаций по повышению производительности](concepts-performance-recommendations.md) анализирует рабочие нагрузки на сервере и определяет, какие индексы могут помочь в повышении производительности.

1. Откройте **рекомендации по повышению производительности** из раздела **Поддержка и устранение неполадок** в строке меню на странице портала Azure для сервера PostgreSQL.
   
   ![Целевая страница рекомендаций по повышению производительности](./media/tutorial-performance-intelligence/performance-recommendations-landing-page.png)

2. Выберите **Анализ** и базу данных. После этого начнется анализ.

3. В зависимости от рабочей нагрузки выполнение этой операции может занять несколько минут. По окончании анализа на портале появится уведомление.

4. В окне **Рекомендации по повышению производительности** появится список рекомендаций, если таковые имеются. 

5. Рекомендации будут содержать сведения о соответствующей **базе данных**, **таблице**, **столбце** и **размере индекса**.

   ![Результат рекомендаций по производительности](./media/tutorial-performance-intelligence/performance-recommendations-result.png)

6. Чтобы применить рекомендацию, скопируйте текст запроса и выполните его в клиенте по своему выбору.

### <a name="permissions"></a>Разрешения
Для выполнения анализа с помощью функции рекомендаций по повышению производительности требуются разрешения **владельца** или **участника**.

## <a name="next-steps"></a>Дополнительная информация
- Дополнительные сведения о [мониторинге и настройке](concepts-monitoring.md) см. в базе данных Azure для PostgreSQL.